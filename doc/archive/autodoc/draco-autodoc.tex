%%---------------------------------------------------------------------------%%
%% draco-autodoc.tex
%% John McGhee
%% $Id$
%%---------------------------------------------------------------------------%%
\documentclass[11pt]{ResearchNote}
\usepackage[centertags]{amsmath}
\usepackage{amssymb,amsthm,graphicx}
\usepackage[mathcal]{euscript}
\usepackage{tmadd,tmath}
\usepackage{c++}
\usepackage{cite}

%%---------------------------------------------------------------------------%%
%% DEFINE SPECIFIC ENVIRONMENTS HERE
%%---------------------------------------------------------------------------%%
%\newcommand{\elfit}{\ensuremath{\operatorname{Im}(-1/\epsilon(\vq,\omega)}}
%\msection{}-->section commands
%\tradem{}  -->add TM subscript to entry
%\ucatm{}   -->add trademark footnote about entry

\newcommand{\draco}{{\normalfont\sffamily Draco}}
\newcommand{\solon}{{\normalfont\sffamily Solon}}
\newcommand{\milagro}{{\normalfont\sffamily Milagro}}
\newcommand{\xemacs}{{\normalfont\bfseries XEmacs}}
\newcommand{\gnats}{{\normalfont\bfseries GNATS}}
\newcommand{\doxy}{{\normalfont\bfseries Doxygen}}
\newcommand{\imc}{{\normalfont\sffamily imc}}
\newcommand{\dsxx}{{\normalfont\sffamily ds++}}
\newcommand{\cfour}{{\normalfont\sffamily c4}}
\newcommand{\rng}{{\normalfont\sffamily rng}}
\newcommand{\timestep}{{\normalfont\sffamily timestep}}

%%---------------------------------------------------------------------------%%
%% BEGIN DOCUMENT
%%---------------------------------------------------------------------------%%

\begin{document}

%%---------------------------------------------------------------------------%%
%% OPTIONS FOR NOTE
%%---------------------------------------------------------------------------%%

\toms{Distribution}
%\toms{Joe Sixpak/X--TM, MS D409}
\refno{XTM:JMM-99-57 (U)}
\subject{\doxy\ \C++ Automatic Documentation Utility}

%-------NO CHANGES
\divisionname{Applied Theoretical \& Computational Physics Div.}
\groupname{X--TM:Transport Methods Group}
\fromms{John M. McGhee/X--TM, MS D409\\
  Tom M. Evans/X--TM, MS D409}
\phone{(505)667--9552}
\originator{jmm}
\typist{jmm}
\date{\today}
%-------NO CHANGES

%-------OPTIONS
%\reference{NPB Star Reimbursable Project}
%\thru{P. D. Soran, XTM, MS B226}
%\enc{list}      
%\attachments{list}
%\cy{list}
%\encas
%\attachmentas
%\attachmentsas 
%-------OPTIONS

%%---------------------------------------------------------------------------%%
%% DISTRIBUTION LIST
%%---------------------------------------------------------------------------%%

\distribution {
  J.E. Morel, XTM MS D409\\
  J.M. McGhee, XTM MS D409\\
  H.G. Hughes, XTM MS D409\\
  T.M. Evans, XTM MS D409\\
  M.G. Gray, XTM MS D409\\
  S.D. Pautz, XTM MS D409\\
  R.M. Roberts, XTM MS D409\\
  T.J. Urbatsch, XTM MS D409\\
  T.A. Wareing, XTM MS D409\\
  J.S. Warsa, XTM MS D409\\
  C.J. Gesh, XTM MS D409\\
  W.D. Hawkins, XTM MS D409\\
  B.T. Adams, XTM MS D409 \\
  M.L. Alme, XTM MS D409\\
  J.C. Gulick, XTM D409\\
  K.G. Thompson, XCI, MS F663\\
  R.B. Lowrie, XHM MS D413 
  }

%%---------------------------------------------------------------------------%%
%% BEGIN NOTE
%%---------------------------------------------------------------------------%%

\opening

The GNU Public License \C++ automatic code documentation system \doxy\ 
has been installed for use by the \draco\ team. This memo describes
how to set up and use \doxy\ .  Also, some suggestions are made as to
minimal documentation standards.

%%---------------------------------------------------------------------------%%

\section{Introduction}

\doxy\ is an automatic \C++ code documentation system available under
the GNU Public License.  A user's manual and other information is
available on-line at:
\begin{verbatim} 
     http://www.stack.nl/~dimitri/doxygen/ 
\end{verbatim}

Good documentation is critical to any code development effort.  The
advantages of automatic documentation systems are many.  For example,
the documentation and the code are much more likely to be conformal;
the documentation is conveniently located with the code, code
developers are encouraged to include liberal explanations in their
comments, and updates and corrections are easily handled.  \draco\ has
been considering adopting such a system for some time.


Recently, Tom Evans has evaluated several automatic documentation
systems including DOC++, PERCEPS, KDOC, and \doxy\ .  For \draco\ 
automatic documentation purposes, \doxy\ is deemed to be the
package of choice. There are several reasons for this. Among these are
ease of use and installation, a plethora of clever and useful
features, good documentation (the package documented itself!), active
development and support from a responsive author, and minimal overhead
requirements on the code developer.


This evaluation is based on direct experience using \doxy\ to document
two existing \draco\ packages.  Tom Evans has documented the \rng\ package and
John McGhee has documented the \timestep\ package.  

%%---------------------------------------------------------------------------%%

\section{How to Use \doxy\ }
 
\doxy\ parses any valid \C++ source code and extracts considerable 
information from the *.hh
and *.cc files without any active intervention on the part of the developer.
Thus, \doxy\ can be used on any \C++ source file
without any modifications to the source at all. 
Both \texttt{html} (with links)
and \LaTeX\ output is automatically produced directly from the source code.
With some additional effort, example code, specific comment blocks, \texttt{html}
 tags and \LaTeX\
formulas can also be extracted directly from the source
and included in the documentation.  The following
sub-sections provide a brief primer on \doxy. We encourage everyone to peruse
the \doxy\ manual for more details.

\subsection{Special Comment Blocks}
\label{sec:spcom}

In addition to the information extracted by default,
the developer may also flag specific
comment blocks for inclusion in the documentation.
The fundamental key that \doxy\ uses to flag source code comments for
extraction is the C-style comment character followed by an exclamation
point. For example:
\begin{verbatim}
     /*!
      *
      * This text (without the asterisks) will appear in the documentation!
      *
      */
\end{verbatim}
\doxy\ automatically associates
the special comment block with the class/member that immediately follows the 
comment block in the source. Alternatively, you can put the comment block
anywhere in any file and mark it with a special keyword to associate it
with the appropriate class/member. Blank lines are recognized as paragraph
breaks. Code comments in other legal \C++ comment formats are ignored.

\subsection{A Few Major Keywords}

Inside a \doxy\ comment block, there are currently approximately 60
special keywords that \doxy\ recognizes. If desired, these keywords
can be used to control and produce additional features in the
documentation.  The interested reader is referred to the \doxy\ manual
for details on these keywords.  We will briefly describe a few of the major
keywords that we have found to be most useful.
\begin{itemize}
\item \verb+\file+ The file name.
\item \verb+\author+ The author.
\item \verb+\date+ The date.
\item \verb+\version+ A version number.
\item \verb+\brief+ A pithy ``one line'' description.
\item \verb+\param+ An input parameter.
\item \verb+\return+ The return value.
\item \verb+\sa+ ``See Also'', a list of related items.
\item \verb+\example+ {\em filename} Includes {\em filename} as a code
  example.
\item \verb+\include+ {\em filename} Includes {\em filename} verbatim at the
  point of reference.
\item \verb+\ref+ {\em reference} Makes a link or reference 
  to the argument {\em reference}.
\item \verb+\page+ {\em reference title} Places the comment block in which
  it appears in the documentation as a separate page with title {\em
    title}. You can refer to and create a link to the page using {\em
    reference} as an argument to the \doxy\ ``\verb+\ref+'' keyword.
\end{itemize}

\subsection{Other Fancy Stuff}

If found within a special comment block 
as defined in section \S~\ref{sec:spcom} above, \doxy\ 
recognizes a multitude of \texttt{html} commands. These
commands are used directly in the \texttt{html} document and are converted 
appropriately for the \LaTeX\ output. 
For example, if the phrase: 
\begin{verbatim}
<H1> My Header <\H1>
\end{verbatim} appears in the special comment
block \doxy\ will format the phrase ``My Header'' as the start of an
un-numbered section in the documentation. 
Also, \LaTeX\ formulas can be used inside a special
comment block if they are delimited using the syntax ``\verb+\f$ ... \f$+''.
For example, the phrase 
\begin{verbatim}
\f$ \sqrt{(x_2-x_1)^2+(y_2-y_1)^2} \f$ 
\end{verbatim}  will appear in the
documentation as $\sqrt{(x_2-x_1)^2+(y_2-y_1)^2}$.
These two
features make it possible to create a fairly sophisticated document, if desired.
Again, see the manual for more details.


%%---------------------------------------------------------------------------%%

\section{\draco\ Installation Strategy}
\label{sec:draco}

We elect to include documentation
production as part of the \draco\ build. This assures that the
documentation is consistent with whatever version of \draco\ is
checked out. It also minimizes the amount of data that is stored on
the CVS repository. However, this approach requires
\doxy\ to be installed on all platforms on which we expect to build
\draco\ documentation.  We do not feel that this is overly restrictive.
Most of the platforms in question will be in the X-TM LAN and will have ready 
access to \doxy. Moreover, for anyone who does not
have access, \doxy\ is freeware and is easily downloaded and
installed directly from the \doxy\ web-site.
Finally, exported versions of Draco can have the documentation
built locally and included in the tarball with the source code. 

\subsection{New Files, Scripts, Directories and Templates}
We will create a \texttt{draco/autodoc} directory. Under this directory
will be a \doxy\ configuration file (\texttt{doxygen\_config.in)} and
 \texttt{html} header and footer files. Also we will install 
a \texttt{draco/autodoc/html} directory to store \doxy\ \texttt{html}
output and a \texttt{draco/autodoc/latex}
directory to hold \doxy\ \LaTeX\ output. There will be a \draco\ logo gif
stored in the \texttt{draco/autodoc/html} directory. 
Tom Evans is installing new *.cc and *.hh templates in the \draco\ 
templates directory to support \doxy\ requirements. These templates
will be available in the usual manner as described in Ref~\cite{xtm:9909}.
A link will be added to the \draco\ WWW home page to point to on-line
documentation (See section \S~\ref{sec:www})

\subsection{Changes to \draco\ Build System}

Ultimately, we desire to make the necessary changes to the \draco\
build system to support \doxy\ documentation dependencies,
builds, installs, cleans,
etc. in a general way. For the present, 
only build and clean targets will be supported.
Currently \doxy\
can only be executed from a SGI platform. These details may
change in the future. 

\subsection{Building the Documentation}

To produce documentation, first checkout a working copy of \draco\ 
and configure normally as described in  Ref~\cite{draco-build}.
Then execute the following commands in your build directory:
\begin{verbatim} 
     cd draco/autodoc
     gmake 
\end{verbatim}
or,
\begin{verbatim} 
     cd draco
     gmake autodoc
\end{verbatim}
The documentation will be produced and stored in the
\texttt{html} and \LaTeX\ directories in the install location.
The resulting \texttt{html} files can be viewed with any browser. The
file \texttt{index.html} provides a default starting point. The \LaTeX\
directory will contain a makefile. Typing gmake therein will produce 
a \texttt{refman.dvi} file which can be viewed directly with \texttt{xdvi},
or converted to postscript with \texttt{dvips}. At present there
is no dependency checking for the documentation.
If the source code is subsequently changed for some reason,
\doxy\ should be run again, thus assuring that the documentation 
remains in sync with the source code.

Note that documentation is not automatically produced as part of 
a standard \draco\ build operation from the top level \texttt{draco} 
directory. Documentation is produced only on the direct request 
of the developer using the procedure described above. This prevents
the production of unwanted documentation, thus saving time and disk 
space.


\subsection{\doxy\ Configuration File}
\label{sec:config}

Under normal use the \doxy\ configuration file will not require
modification by package developers. However, if new packages or
new directories under existing packages are added,
the \doxy\ configuration file \texttt{draco/autodoc/doxygen\_config.in}
may require modification.
The configuration options available to users are well
documented in the \doxy\ manual. Some of the configuration file 
variables which may be of interest are briefly discussed below:
\begin{description}
\item[\ttfamily INPUT] Defines which files and/or
  directories should be  examined by \doxy\ for documentation.  
\item [\ttfamily FILE\_PATTERNS] One or more wildcard patterns to be
  used as filters for files found in the INPUT directories. 
\item [\ttfamily EXCLUDE] Specifies files and/or directories to be
   excluded from the INPUT source files.
\item [\ttfamily EXCLUDE\_PATTERNS] One or more wildcard patterns to be
  excluded from the INPUT directories.
\item [\ttfamily EXAMPLE\_PATH] Defines one or more files and/or
  directories that contain the files to be referenced using
  the \verb+\example+ keyword.
\item [\ttfamily INCLUDE\_PATH] Defines one or more 
  directories that contain the files to be referenced using the
 \verb+\include+ keyword.
\end{description}

Developers can use the current \texttt{doxygen\_config.in} as a template for
any changes that are required. In most cases, this will consist of
simply adding a new path or file to the INPUT, EXAMPLE\_PATH and/or 
INCLUDE\_PATH definitions.

\subsection{Name Collisions}
Since all packages in \draco\ will be documented in the same
files, the potential exists for name collisions. Fortunately,
since all \draco\ packages are in their own namespace, this problem
should be minimized. Nevertheless, 
    it is considered good practice  to preface any labels which are to be
used with the \doxy\ \verb+\ref+ keyword with the
    package name to prevent potential conflicts.
Also, we recommend that any file names used
with the \doxy\ \verb+\example+ and \verb+\include+ keywords
should include the path to the file starting with the package name.


\subsection{Tagging and Release Procedures}
\label{sec:reltag}
Prior to tagging and release of a package as described in Ref~\cite{xtm:9936},
 it is 
the responsibility of the package developer is to make sure that any \doxy\
comments that are present in the source are in fact consistent with the
source code. \doxy\ is not magic. If incorrect comments are provided with
the source, then the documentation produced from those comments will also
be incorrect.

As described in section \S~\ref{sec:std} below, 
the developer should provide 
the appropriate package version number in the standard \doxy\ comments in the 
package \texttt{Release.hh} file.
Note that the date which appears in the footer of the \doxy\ 
\texttt{html} and \LaTeX\ pages
simply refers to the date/time that the documentation was produced by \doxy, 
and has nothing to do with the version of the documentation.

\subsection{\draco\ WWW Site}
\label{sec:www}

At some point in the future, we may make \draco\ source code available
directly from the \draco\ web site. At that time the web site code
documentation will be consistent with the web site source code.
For the present, 
we will make available a reasonably current copy of the \draco\ \texttt{html}
documentation on the \draco\ web site. This will be updated periodically
at intervals to be determined by the \draco\ team. 
We emphasize that at present, the web-site documentation should be 
considered to be of an informational nature only. To be assured of
consistency between the documentation and the code, each
user should refer to the documentation available with 
his current working copy.


%%---------------------------------------------------------------------------%%

\section{Documentation Standards}
\label{sec:std}

We believe that each developer should be free to document source code
in the style and manner most agreeable to the individual. As a result,
only minimal documentation standards are required.  We propose the
following standards for consideration:

\begin{itemize}
 \item Using the \doxy\
  \verb+\page+ keyword, each package should provide a version number and
  a brief overview of the package purpose, design and contents in the package
  \texttt{Release.hh} file. This page should be titled ``{\em package} Overview''
  for easy identification. The version number should be documented using
  the \doxy\ \verb+\version+ keyword.
 \item Each file should have the author, date and brief description
  information completed as provided for in the *.cc and *.hh \draco\ 
  file templates.
 \item Each namespace, class, and associated public members
  should have at least a brief description.
 \item Using the \doxy\ \verb+\param+ and \verb+\return+ keywords,
  each public member should at least have descriptions of its input
  parameters and return value.
\end{itemize}

We feel that these guidelines, together with the information that
\doxy\ will automatically extract, will produce documentation that is
adequate for our purposes. Of course, all developers are 
encouraged to provide more than the absolute minimum.

%%---------------------------------------------------------------------------%%

\section{Using \doxy\ with Other Systems}

The \draco\ \doxy\ documentation system can be used as a model for
the setup of automatic documentation of other software systems. 
Alterations of 
the \doxy\ \texttt{config} file, and
the \texttt{html} header and footer files will be required to meet
the particular requirements of each system.


\subsection{Linking to \draco\ HTML Documentation from Other Systems}

It is possible to link to \draco\ \texttt{html} documentation from other
software systems documentation.
Tag files are the  optional \doxy\ feature used to refer to other software systems. 
For example, the \milagro\
package uses the \draco\ package.  The documentation for \milagro\
may therefore provide links to the documentation for \draco.  If such is 
desired, it is  accomplished
by the \doxy\ tagging machinery.  To use \doxy\ tags the following
config options are used:
\begin{description}

\item[\ttfamily TAGFILES] A list of all tag files needed to resolve
  links in the package.  For instance, the \milagro\ package
  \texttt{autodoc/doxygen\_config.in} file would contain the following entry:
\begin{verbatim}
     TAGFILES = ./html/draco.tag
\end{verbatim}
  This is  the tag file used by \milagro\ to resolve documented
  dependencies. It should be copied into the \milagro\ \texttt{autodoc/html}
  directory from the \texttt{draco/autodoc/html} directory.

\item[\ttfamily GENERATE\_TAGFILE] forces the generation of
  a tag file in the \texttt{autodoc} subdirectory with the name 
  \texttt{<system>.tag}.
For instance, the \milagro\ package
  \texttt{autodoc/doxygen\_config.in} file would contain the following entry:
\begin{verbatim}
     GENERATE_TAGFILES = ./html/milagro.tag
\end{verbatim}

\end{description}
When \doxy\ is run with these configuration options, link information
is generated automatically to the \draco\ dependencies.  Additionally, 
\milagro\ creates its own tag file that can be used by its client
systems, if any.

When the \texttt{TAGFILES} option is set, \doxy\ creates a customized
PERL script called \texttt{installdox} in the \texttt{html}
subdirectory.  This script is used to ``activate'' the links to real
locations.  In order to use this script, copies of each tag file must
exist in the \texttt{html} subdirectory.  The \texttt{installdox}
script is then executed to modify the links to their proper locations.
At this point an example is warranted.  Consider the \milagro\ 
documentation set.  \milagro\ depends on \draco.  After running
\doxy\ in both \draco\ and \milagro\ the following
steps are required to activate the tags in the \milagro\ documentation
that point to the \draco\ documentation:
\begin{verbatim}
     cd milagro/autodoc/html
     cp PATH/draco/autodoc/html/draco.tag .
     ./installdox -l draco.tag@LOCATION
\end{verbatim}
where ``PATH'' is the path to the appropriate \texttt{draco} directory
and ``LOCATION'' is the
directory or URL containing the \draco\ \texttt{html} files.
The \texttt{installdox} script will modify all of the \milagro\ \texttt{.html}
files so that the links point to the correct locations.    The dates of the
copied tag files
can be used to determine the currency of the references to other code systems.
Of course, the \draco\ \texttt{.html} files must actually exist at the stated location
for the links created by \texttt{installdox} to actually work.

We emphasize that the use of tag files is optional. It is somewhat complicated,
but provides a useful enhancement of the \texttt{html} output. It has no
affect on the \LaTeX\ output. For any who find tag files confusing or
intimidating, we recommend that you document your system without them. They
can easily be added at a later date if desired.


\subsection{Currency Considerations}
Note that the documentation for 
any system ``A'' that uses system ``B's'' B.tag file will have to be
updated when B.tag is changed. This update consists of getting the updated
tag file and running \doxy\ and \texttt{installdox} again. 
Ideally, there should be some way to detect that documentation
or tag files are out of date, and to automatically rebuild the
documentation if required.  For the present at least, no such automatic
feature is in place, and we elect to rely
on the diligence and dedication of the individual system developers to 
assure that their \texttt{html} documentation links are kept up to date. 


%%---------------------------------------------------------------------------%%

\section{Example}

A good example is always instructive, so here is a copy of
one of the \doxy\ documented header files from the \timestep\ utility.
Of course, this example represents only one of an infinite number of ways
to document this file, but it should provide some idea of how \doxy\
can be used.
For additional examples, both the \rng\ and \timestep\ packages have been
autodocumented and are available through the usual CVS checkout procedures.

\begin{verbatim}
//----------------------------------*-C++-*----------------------------------//
/*! 
 * \file   timestep/fixed_ts_advisor.hh
 * \author <a href="http://www.lanl.gov/home/mcghee">John McGhee</a>
 * \date   Thu Apr  2 14:06:18 1998
 * \brief  Header file for the fixed time-step advisor class.
 */
//---------------------------------------------------------------------------//
// $Id$
//---------------------------------------------------------------------------//

#ifndef __timestep_fixed_ts_advisor_hh__
#define __timestep_fixed_ts_advisor_hh__

#include "ts_advisor.hh"

namespace rtt_timestep {

//===========================================================================//
/*!
 * \brief Introduces a user defined fixed value 
 *        into the time-step calculation.
 *
 * \sa The ts_manager class provides a means to manage this advisor.
 * The \ref timestep_overview page gives a summary of the Draco time 
 * step control utilities. 
 *
 * This is useful to set min and max timesteps, or to force a
 * timestep, etc. The recommendation for the new timestep is
 * simply the user input value. 
 */ 
//===========================================================================//
class fixed_ts_advisor : public ts_advisor {

  // DATA

  private:
    /*!
     * \brief Value used to oompute a fixed advisor recommended timestep.
     */
    double fixed_value; 
   
// CREATORS

  public:

    /*!
     * \brief Constructs a fixed time-step advisor.
     * \param name_ A unique name for the advisor.
     * \param usage_ How the advisor is to be used.
     * \param const_value_ The desired value for the timestep.
     * \param active_ Turns the advisor on/off.
     */
    fixed_ts_advisor( 
        const std::string &name_  = std::string("Unlabeled"),
        const usage_flag usage_ = max, 
        const double const_value_ = large(),
        const bool active_ = true);

    /*!
     * \brief Destroys a fixed time-step advisor.
     */
    ~fixed_ts_advisor();

// MANIPULATORS
    
    /*!
     * \brief Sets the fixed value.
     * \param value_ The fixed value.
     */
    void set_fixed_value(const double value_ = large())
    { 
        fixed_value = value_;
    }

// ACCESSORS

    /*!
     * \brief Returns the time-step recommended by a fixed  advisor.
     * \param tsm The time step manager in which the advisor resides.
     * \return The recommended timestep.
     */
    double get_dt_rec(const ts_manager &tsm) const;
    
    /*! 
      \brief Prints the state of a fixed advisor.
      \return Prints the internal state of the advisor to std out.
     */
    void print_state() const;
    
    /*! 
      \brief Fixed advisor invariant function.
      \return True if the invariant is satisfied.
     */
    bool invariant_satisfied() const;

};

} // end of rtt_timestep namespace

#endif                          // __timestep_fixed_ts_advisor_hh__

//---------------------------------------------------------------------------//
//                              end of fixed_ts_advisor.hh
//---------------------------------------------------------------------------//
\end{verbatim}

%%---------------------------------------------------------------------------%%

\section{Possible Future Improvements}

Several improvements may be implemented in the future. 
Ultimately, it may be desirable  to make changes to the \draco\
build system to support  \doxy\ documentation dependencies, and
to support separate \doxy\ build and install operations.
Also, it may be desirable to create a ``pkgcommit'' srcipt to manage
version numbers and automatically update the package Release.hh version
number information. 

%%---------------------------------------------------------------------------%%

\section{Closing}

In closing, we would like to emphasize that \doxy\ is
a relatively easy and painless way to document your code. Tom and I have
both found the process addictive, the more comments you put in, the more
you want to put in. \doxy\ can be used on any \C++ source file without
any modifications to the source at all. However, we would encourage
all \draco\ developers to take the small amount of time required to
retrofit their existing code to take advantage of the special features
that \doxy\ offers.  Also, we recommend that all new code developed in
\draco\ make use of \doxy\ capabilites, and that the documentation 
standards presented in section \S~\ref{sec:std} above be adopoted.

\bibliographystyle{rnote}
\bibliography{../../environment/bibfiles/draco}

\closing
\end{document}

%%---------------------------------------------------------------------------%%
%% end of draco-autodoc.tex
%%---------------------------------------------------------------------------%%
