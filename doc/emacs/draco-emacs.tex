%%---------------------------------------------------------------------------%%
%% draco-emacs.tex
%% Thomas M. Evans
%% $Id$
%%---------------------------------------------------------------------------%%
\documentclass[11pt]{nmemo}
\usepackage[centertags]{amsmath}
\usepackage{amssymb,amsthm,graphicx}
\usepackage[mathcal]{euscript}       
\usepackage{tabularx}
\usepackage{tmadd,tmath}
\usepackage{cite}
\usepackage{c++}
\usepackage{fancycodes}

%%---------------------------------------------------------------------------%%
%% DEFINE SPECIFIC ENVIRONMENTS HERE
%%---------------------------------------------------------------------------%%
%\newcommand{\elfit}{\ensuremath{\operatorname{Im}(-1/\epsilon(\vq,\omega)}}
%\msection{}-->section commands
%\tradem{}  -->add TM subscript to entry
%\ucatm{}   -->add trademark footnote about entry

\newcommand{\comp}[1]{{\normalfont\texttt#1}}
\newcommand{\draco}{{\normalfont\sffamily Draco}}
\newcommand{\xemacs}{{\normalfont\bfseries XEmacs}}
\newcolumntype{Y}{>{\centering\arraybackslash}X}
\newcolumntype{L}{>{\ttfamily}X}

%%---------------------------------------------------------------------------%%
%% BEGIN DOCUMENT
%%---------------------------------------------------------------------------%%
\begin{document}

%%---------------------------------------------------------------------------%%
%% OPTIONS FOR NOTE
%%---------------------------------------------------------------------------%%

\toms{Distribution}
%\toms{Joe Sixpak/XTM, MS B226}
\refno{XTM:99--09 (U), rev. 1}
\subject{XEmacs Development Environment for Draco}

%-------NO CHANGES
\divisionname{Applied Theoretical \& Computational Physics Div.}
\groupname{X-TM:Transport Methods Group}
\fromms{Thomas M. Evans/XTM D409}
\phone{(505)665--3677}
\originator{tme}
\typist{tme}
\date{\today}
%-------NO CHANGES

%-------OPTIONS
%\reference{NPB Star Reimbursable Project}
%\thru{P. D. Soran, XTM, MS B226}
%\enc{list}      
%\attachments{list}
%\cy{list}
%\encas
%\attachmentas
%\attachmentsas 
%-------OPTIONS

%%---------------------------------------------------------------------------%%
%% DISTRIBUTION LIST
%%---------------------------------------------------------------------------%%

\distribution {
  XTM MS D409:\\ 
  J.E. Morel, XTM MS D409\\ 
  G.L. Olson, XTM MS D409\\ 
  J.M. McGhee, XTM MS D409\\ 
  H.G. Hughes, XTM MS D409\\ 
  T.M. Evans, XTM MS D409\\ 
  M.G. Gray, XTM MS D409\\ 
  M.L. Hall, XTM MS D409\\ 
  S. Pautz, XTM MS D409\\ 
  R.M. Roberts, XTM MS D409\\ 
  S.A. Turner, XTM MS D409\\ 
  T.J. Urbatsch, XTM MS D409\\ 
  J.S. Warsa, XTM MS D409\\
  }

%%---------------------------------------------------------------------------%%
%% BEGIN NOTE
%%---------------------------------------------------------------------------%%

\opening

\section{Introduction}

\draco~\cite{rn98046} has been built using an informal \xemacs-based
design environment.  As part of the \draco\ reorganization
project~\cite{draco-build} we have sorted through the existing Elisp
functions and macros that have defined this informal \draco\ 
environment.  These files have been cleaned up and released as
RTT-ELISP V1.1, the \draco\ development environment.  With this
release we have a formal development environment for \draco.

Our goal is for all files in \draco\ to have the same ``look and
feel.''  To accomplish this we employ the \xemacs\ editor with a
defined set of modes and functions that both expedite and homogenize
code and document development in \draco.  Additionally, templates are
provided that contain header information and formats.  Thus, all
source code files in \draco\ will obtain the same ``look'' simply by
using this environment.

The \draco\ development environment consists of a series of Elisp
(\comp{.el}) files that need to be loaded from the user's
\comp{.emacs} file.  The \xemacs\ \draco\ development environment
provides the following features:
\begin{itemize}
\item A set of templates providing standard headers and footers for
  \draco\ source code.
\item A \draco\ \C++ indentation style for \xemacs.
\item Functions to expedite editing of source code (including \LaTeX)
  and package creation in \draco.
\end{itemize}
We will show how to load the \draco\ development environment and
analyze these features in the following sections.

%%---------------------------------------------------------------------------%%

\section{Draco Elisp Files}

The files that constitute the \xemacs\ \draco\ development environment
are listed in Table~\ref{tab:elisp}.  These files can be obtained
\begin{table}
  \caption{Files that are part of the \draco\ development environment
    distribution, RTT-ELISP V1.1.}
  \label{tab:elisp}
  \begin{center}
    \begin{tabularx}{\linewidth}{
        >{\setlength{\hsize}{.8\hsize}}L %
        >{\setlength{\hsize}{.4\hsize}}Y %
        >{\setlength{\hsize}{1.8\hsize}}X}
      \hline\hline
      \multicolumn{1}{Y}{File} & Required &
      \multicolumn{1}{Y}{Description} \\ \hline
      Config-key.el & no & describes some key-bindings \\
      Config-pkg.el & yes & does package configurations for
      environments used in (and outside) of \draco \\
      draco-hacks.el & yes & \draco-specific function definitions \\
      draco-rtt.el & yes & loads the \draco\ environment and other
      packages \\
      fl-keywords.el & yes & font-lock keywords used throughout the
      \draco\ package \\
      infer-cc-style.el & yes & functionality for inferring
      \comp{c\--indentation\--styles} \\
      infer-mode.el & yes & functionality for inferring the \xemacs\
      mode from strings in file headers \\
      nml-mode.el & yes & \comp{nml} mode definition \\
      pooma-hacks.el & yes & c-style used by the POOMA team \\
      rtt-hacks.el & yes & defines the \comp{rtt-c-style} \\
      tme-hacks.el & yes & contains functions used by the \draco\
      environment \\
      xemacs-setup.el & no & key-bindings that may be useful to \draco\ 
      developers \\ 
      \hline\hline
    \end{tabularx}
  \end{center}
\end{table}
through CVS export:
\begin{verbatim}
     $ cvs export -r rtt-elisp_v11 elisp
\end{verbatim} % $
Note that not all files are required by the \draco\ development
environment.  These additional Elisp components are included because
they may be useful for general work in XTM.  In addition to the
\comp{elisp/} directory, a \comp{elisp/templates} directory is
generated from the CVS export.  These templates are used by functions
in \comp{tme-hacks} and are not part of the official \draco\ 
development environment.  However, these templates are useful when
writing code and documents outside of \draco.

The \comp{elisp/} directory that results from CVS export should be
placed in a suitable location.  In general, oen of the following two
locations are recommended:
\begin{verbatim}
     $HOME/elisp
     $HOME/lib/elisp
\end{verbatim}
Note that if the general templates (non-\draco) from \comp{tme-hacks}
are desired then the \comp{elisp/} directory should be placed in
\comp{\$HOME/lib/elisp}.  However, the placement of the elisp
directory will not affect the \draco\ development environment
functionality.

\subsection{\comp{.emacs} File}
\label{sec:.emacs}

The \draco\ environment is loaded from the \comp{.emacs} file.
Appendix~\ref{.emacs} lists a model \comp{.emacs} file that loads the
complete \draco\ development environment.  This file also loads
additional packages such as \comp{xemacs-setup} and \comp{tme-keys}
that are primarily key-bindings.  Each user should add an Elisp file
in \comp{elisp/} that describes the key bindings and Elisp
\comp{mode-hooks} that he/she wants.  An example of such a file is
\comp{tme-keys} that may be viewed in
\begin{verbatim}
     /home/tme/lib/elisp/tme-keys.el
\end{verbatim}
For convenience, this file is reproduced in \S~\ref{tme-keys}.
Additional functionality can be added by users to suit additional
needs outside of \draco\ by simply making their own Elisp files in
this manner.

We will use the \comp{.emacs} file in \S~\ref{.emacs} as a template
for what follows.  The following code determines where the
user-installed \comp{elisp/} directory is located:
\begin{verbatim}
     (setq my-home-dir (getenv "HOME"))
     (setq my-elisp-dir (concat my-home-dir "/lib/elisp"))
     (setq load-path (cons my-elisp-dir load-path))
\end{verbatim}
To load the packages in the \draco\ environment include the following:
\begin{verbatim}
     (load "draco-rtt")
\end{verbatim}
To enable language support for the following modes, we use the
following code:
\begin{verbatim}
     (setq config-pkg-verbose t)

     (setq want-mppl-mode t)
     (setq want-tcl-mode t)
     (setq want-python-mode t)
     (setq want-nml-mode t)
     (setq want-makefile-mode t)
     (setq want-cc-mode t)
     (setq want-auctex-pkg t)
     (setq want-f90-mode t)
     (setq want-fortran-mode t)

     (load "Config-pkg")
\end{verbatim}
\comp{Auctex} is a useful mode for editing \TeX\ and \LaTeX\ source
files.  See \comp{Config-pkg.el} for descriptions of the rest of
language modes.  Additional packages can be loaded using the Elisp
function \comp{load}, ie. 
\begin{verbatim}
     (load "Config-key")
\end{verbatim}
loads the \comp{Config-key.el} file.  For additional descriptions of
commands in the sample \comp{.emacs} file see the \xemacs\ help menu.

%%---------------------------------------------------------------------------%%

\section{Draco Templates}

A set of templates used by \draco\ resides in the
\comp{draco/templates/} directory.  These templates are used by the
functions described in \S~\ref{sec:func} to make \comp{.cc},
\comp{.tex}, and a host of other files.  Additional templates are
provided to help setup \draco\ packages quickly and easily.  \draco\ 
functions must be called under the \comp{draco/} (or \draco-like, ie.
\comp{solon/}) directory in order to use the \draco\ templates.  This
functionality is explained in \S~\ref{sec:func}.  The template
functions in \comp{tme-hacks} can be used for work outside of \draco.

%%---------------------------------------------------------------------------%%

\section{Draco \C++ Indentation Style}

We have developed a \C++ indentation style for use in \draco.  The
style is called RTT and can be confirmed by querying the value of the
\comp{c-indentation-style} variable.  Figure~\ref{Test} gives an
example of the RTT indentation style.  \cdFramedFigure{Test}{Example
  of the RTT \C++-indentation style.}  By loading \comp{draco-rtt} in
the \comp{.emacs} file this indentation style is set automatically.

We note that there still exists a small bug in the \xemacs\ 
implementation of the \comp{namespace} keyword.  This will nominally
occur in definitions of functions within a \comp{namespace}.  To avoid
this error, we set the namespace indentation to zero.  Thus, the user
will not encounter this \xemacs\ \C++-mode bug when using the RTT
style.

%%---------------------------------------------------------------------------%%

\section{Draco Functions}
\label{sec:func}

This section describes two families of functions.  The first set,
\S~\ref{sec:dfunc}, is provided for use when developing in \draco\ 
only.  These functions must be used under a viable \draco-like system
directory such as \comp{draco/}, \comp{solon/}, or \comp{milagro/}.
The second set, \S~\ref{sec:gfunc} are general functions that may be
useful to \draco\ developers on projects outside of \draco.  These
function lists are highlights.  There exists additional functions that 
have limited, but useful, utility to various users.  See the packages
listed in Table~\ref{tab:elisp} for complete lists and descriptions of 
all functions.  

\subsection{Draco Functions}
\label{sec:dfunc}

The following is a list of functions used exclusively in \draco:
\begin{description}
\item[\comp{draco-package}:] Sets up the required files for a \draco\ 
  package including \comp{configure.in}, \comp{config.h.in},
  \comp{Version.hh}, and \comp{Version.cc}.
\item[\comp{draco-class}:] Sets up a \C++ class in \draco; makes a
  \textsl{class}\comp{.hh}, \textsl{class}\comp{.cc}, and a
  \textsl{class}\comp{.t.hh} file.
\item[\comp{draco-cc-head}:] Sets up a \C++ header file in \draco;
  makes a \textsl{header}\comp{.hh} file.
\item[\comp{draco-cc-headin}:] Sets up a \C++ header file in \draco\ 
  that is modified during configuration (see Ref.~\cite{draco-build});
  makes a \textsl{header}\comp{.hh.in} file.
\item[\comp{draco-c-head}:] Sets up a C header file in \draco; makes a 
  \textsl{header}\comp{.h} file.
\item[\comp{draco-c-headin}:] Sets up a C header file in \draco\ that
  is modified during configuration (see Ref.~\cite{draco-build});
  makes a \textsl{header}\comp{.h.in} file.
\item[\comp{draco-cc-imp}:] Sets up a \C++ implementation file unit;
  makes a \textsl{base}\comp{.cc} and \textsl{base}\comp{.t.hh} file.
\item[\comp{draco-python}:] Sets up a Python file; makes a
  \textsl{base}\comp{.py} file.
\item[\comp{draco-memo}:] Sets up a LANL-style memo using \LaTeX;
  makes a \textsl{name}\comp{.tex} file.
\item[\comp{draco-note}:] Sets up a LANL-style research note using
  \LaTeX; makes a \textsl{name}\comp{.tex} file.
\item[\comp{draco-article}:] Sets up a RTT-style article using \LaTeX;
  makes a \textsl{name}\comp{.tex} file.
\item[\comp{draco-report}:] Sets up a RTT-style report using \LaTeX;
  makes a \textsl{name}\comp{.tex} file.
\item[\comp{draco-bib}:] Sets up a \LaTeX\ BiB-\TeX\ file in RTT
  format; makes a \textsl{name}\comp{.bib} file.
\end{description}

Remember, these functions must be launched from a directory that is
located under \comp{draco/} or a \draco-like directory.  This is
required because the Elisp functions search up the directory-tree for
a \textsl{dir}\comp{/templates/} directory where templates are stored.
Thus, if a user is working in \comp{draco/src/c4/} and calls a \draco\ 
Elisp function then the directory will be searched upwards until
\comp{draco/templates/} is found.  Therefore, any system
directory-tree that uses the \draco\ model will accept the \draco\ 
Elisp functionality.

The user always has the option of making key-bindings for these
functions.  Key-bindings should be placed in the user's \comp{.emacs}
file or in a file in the \comp{elisp/} directory that is loaded from
\comp{.emacs}.  See \S~\ref{sec:.emacs} for examples.

\subsection{General Functions}
\label{sec:gfunc}

The following is a list of Elisp functions that are useful in
environments that supercede \draco.  This is a highlighted list of
functions that exist in the Elisp distribution described in
Table~\ref{tab:elisp}.  The easiest way to see the functions is to use
the \xemacs\ \comp{help-for-help A} function.  Query the strings
\comp{gmf}, \comp{rtt}, and \comp{tme} to see an almost complete list
of the functions defined in the \comp{elisp/} directory\footnote{Many
  of the interactive \comp{rtt-} prefixed functions are deprecated in
  the new build system.  These have been kept in the Elisp directory
  for reference and for working on previously tagged version of
  \draco.}.  Many of the functions that are prefixed by \comp{tme-}
use the \comp{\$HOME/lib/elisp/templates} directory as the default
location for templates.
\begin{description}
\item[\comp{rtt-find-companion-file}:] Finds the companion to a
  \comp{.hh} or \comp{.cc} file.
\item[\comp{rtt-insert-class-doc}:] Inserts a \C++-style class comment 
  block.
\item[\comp{rtt-insert-comment-divider}:] Inserts a \C++-style comment 
  divider.
\item[\comp{rtt-insert-function-doc}:] Inserts a \C++-style comment
  block divider.
\item[\comp{tme-latex-comment-divider}:] Inserts a \LaTeX-style comment
  divider.
\item[\comp{tme-latex-divider}:] Inserts a \LaTeX-style comment block 
  divider.
\item[\comp{tme-latex-radtran-dist}:] Inserts the distribution list of 
  the RTT (\draco) team for LANL memos and research notes.
\item[\comp{tme-latex-xtm-dist}:] Inserts the distribution list of XTM 
  for LANL memos and research notes.
\item[\comp{tme-c-comment-divider}:] Inserts a C-style comment
  divider.
\item[\comp{tme-c-divider}:] Inserts a C-style comment block divider.
\item[\comp{tme-m4-comment-divider}:] Inserts a M4-style comment
  divider.
\item[\comp{tme-m4-divider}:] Inserts a M4-style comment block
  divider.
\item[\comp{tme-makefile-comment-divider}:] Inserts a makefile-style
  (\comp{\#}) comment divider.  This is also useful in \comp{sh-mode},
  \comp{autoconf-mode}, and \comp{python-mode}.
\item[\comp{tme-makefile-divider}:] Inserts a makefile-style
  (\comp{\#}) comment block divider. This is also useful in
  \comp{sh-mode}, \comp{autoconf-mode}, and \comp{python-mode}.
\item[\comp{tme-\textsl{type}-file}:] Makes a template for the
  language \textsl{type}.  These are very similar to the \draco\ 
  functions described in \S~\ref{sec:dfunc}; however, these functions
  can be used anywhere, not just under \comp{draco/}.  Additionally,
  the template default location is \comp{\$HOME/lib/elisp/templates}.
\item[\comp{gmf-save-and-kill}:]  Saves a buffer and then kills it.
\end{description}  
A good example of how to incorporate these functions into Elisp
\comp{mode-hooks} is given in the file \comp{tme-keys}; see
\S~\ref{tme-keys}.

%%---------------------------------------------------------------------------%%

\appendix

\section{Sample \comp{.emacs} File}
\label{.emacs}

This is a sample \comp{.emacs} file that loads the \draco\ development 
environment.  Additionally, this file loads user-defined options that
are stored in the \comp{.xemacs-options} and \comp{.xemacs-std}
files.  The \comp{.xemacs-options} file is written by the \comp{Save
  Options} command in the \xemacs\ \comp{Options} menu.  The
\comp{.xemacs-std} file is for preferences that the user does not want 
overwritten.  These options could easily be placed directly in the
\comp{.emacs} file if desired.  See the \xemacs\ \comp{Info} pages for 
more help.

\input{emacs}

\section{Sample User Key-Bindings and Mode-Hooks}
\label{tme-keys}

This is a sample key-bindings and \comp{mode-hooks} file.  There are
many ways to achieve this type of functionality in \xemacs.  This file 
is one example.  See the \xemacs\ \comp{Info} pages for more help.

\input{tme-keys}

\bibliographystyle{rnote}
\bibliography{../bib/draco}

\closing
\end{document}

%%---------------------------------------------------------------------------%%
%% end of draco-emacs.tex
%%---------------------------------------------------------------------------%%
