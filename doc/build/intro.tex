%%---------------------------------------------------------------------------%%
%% intro.tex
%% introduction of Draco build system manual
%%---------------------------------------------------------------------------%%

\chapter{Introduction}

In this chapter we will examine the %purpose for redesigning the
design contraints of the \draco\ build system (DBS).  We will
introduce some definitions of terms and typographical conventions that
will be employed throughout the text.  Additionally, the organization
of the manual will be described.  For those who wish to get started
right away, \S~\ref{sec:quick} tells how to get up and moving without
working through the manual.  A detailed developer manual is processed
with \soft{Doxygen}~\cite{doxygen} and is maintained with the
\draco\ source code.

%%---------------------------------------------------------------------------%%

\section{Purpose}
\label{sec:purpose}

The purpose of this document is to describe the \draco\ build system.
Specifically, we will show both \draco\ users and \draco\ developers how to: 
\begin{itemize}
\item configure \draco\ for different platforms, build types and options; \index{configure}
\item compile \draco\ components; \index{compile}
\item compile and link programs that use \draco;
\item add components to \draco;
\item add new support options to \draco;
\item generate developer documentation via \soft{Doxygen}.
\end{itemize}
Thus, this manual is an invaluable reference to those who work in, or
with, \draco.

As a review, we restate the \draco\ mission statement~\cite{rn98046}:
\begin{quote}
  \slshape \draco\ is a comprehensive, radiation transport framework
  that provides key, reusable components for serial and parallel % and heterogeneous architecture platforms
  computational physics codes.
\end{quote} \index{reuse}\index{serial}\index{parallel}\index{computational physics} \index{radiation transport}
To meet these requirements \draco\ uses modern software engineering
concepts including object-oriented, generic design~\cite{ooadid}, multi-environment
build systems, and service libraries based on levelized component
designs~\cite{la96}.  The build system described in this manual allows \draco\ to
satisfy its mission statement and enforces the concept of levelized
component design.\index{object-oriented}\index{levelized}

The \draco\ build system has been carefully designed.  In particular,
we had several requirements that the build system should satisfy.
These requirements are:
\begin{itemize}
  \item support for simultaneous, multiple configurations (Release, Debug, etc);
  \item support for multiple languages, but the recommended languages are \lang{C} and \cpp.
  \item support for \cpp\ on all current ASC platforms;
  \item \lang{C} and \cpp\ coding must conform strictly to issued ISO standards. \index{ISO standards}
\begin{enumerate}
\item \cpp 03, also known as the ISO/IEC 14882:1998 standard amended by the 2003 technical corrigendum, ISO/IEC 14882:2003. \index{ISO standards!v14882:1998} \index{ISO standards!v14882:2003}
\item \lang{C99}, also known as the ANSI C ISO/IEC 9899:1999 standard \index{ISO standards!v9899:1999}
\end{enumerate}
  \item support for multiple build project types (\soft{Makefiles}, \soft{XCode}, \soft{Eclipse}, etc.)
\item on-demand and automated unit and regression testing;
\item the ability to support multiple code projects;
\item support for external vendors;
  \item support for explicit template instantiation;
\item extensibility;
\item low-cost on developers to add new packages, code, and tests; 
\item  adoption of selected sections of the GNU coding standard~\cite{gnu} \index{GNU
    Coding Standard}.
\end{itemize}
This last requirement has evolved a somewhat as the supported
platforms and build systems scope has grown to include \soft{XCode} \index{XCode} and
\soft{Eclipse} \index{Eclipse} on non-Linux platforms.  The use of the \cmake \index{CMake} suite of tools
preculdes the use of GNU autotools \index{GNU autotools},
\autoconf\ and \automake~\cite{autoconf}.  
It also precludes the use of \make~\cite{gmake} for non-Makefile based
build projects (e.g.: \soft{XCode}, \soft{Eclipse CDT}). More detail will be given in
Chap.~\ref{chap:model}. 

%%---------------------------------------------------------------------------%%

\section{Definitions and Conventions}
\index{conventions} \index{definitions}

 Before continuing we shall clarify the terminology and typeface
conventions that will be employed throughout the remainder of this
manual.  The definitions that we use here are for convenience.  They
are not to be interpreted as an ``universal standard.''  They are
simply used to make sure that the concepts illucidated within this
manual have a common point of reference.

A \latin{product} \index{product} is anything that is produced from a source code
tree~\cite{ja94}.  A \latin{system} \index{system} is a code, or a group of codes,
that persist over time~\cite{tn98}.  A \latin{project} \index{project} is an
undertaking that has a definite beginning and ending date, and it
produces a product.  A \latin{package} \index{package} is one component \index{component}of a system
(package and components are used interchangeably).  Packages normally
reside in a single directory in the source code tree; although, that
directory may have subdirectories.  However, packages are sometimes
used to refer to larger units.  For example, a code package may be a
system that contains many components.  In this case, package has macro
(system level) and micro (system-component level) connotations.

Table ~\ref{tab:tfaces} show the typefaces that we will employ
\begin{table}
  \begin{center}
    \caption{Typefaces used throughout the text.}
    \label{tab:tfaces}
    \begin{tabular}{c}\hline\hline
      \sys{code systems} (\draco) \\
      \pkg{packages} (\dsxx) \\
      \comp{files} (\comp{Makefile}) \\
      \vble{variables} (\comp{draco/src/\vble{pkg}/}) \\
      \soft{software programs} (\gmake) \\
      \lang{languages} (\cpp) \\ \hline\hline
    \end{tabular}
  \end{center}
\end{table}
throughout the text to better distinguish certain elements.  In
general, anything that exists on a computer screen (directory trees,
files, etc) is typefaced using \comp{typewriter} font.  Files are
distinguished in the standard UNIX way by appending the following
symbols after the name, \comp{*} for executables, \comp{/} for
directories, and @ for links.  Computer screen prompts are represented
by the \comp{\$} symbol.

%%---------------------------------------------------------------------------%%
\section{Draco Build System Support and Procurement}
\label{sec:procurement}
\index{Build System!Procurement} \index{Build System!Support}

Questions about procuring a copy of the DBS or its use can be
directed to:
\begin{center}
  \begin{tabular}{llcl}\hline\hline
    \multicolumn{1}{c}{Name} & \multicolumn{1}{c}{Email} &
    Group & Team \\ \hline
    Kelly Thompson & kgt@lanl.gov     & CCS--2 & Jayenne \\
    Jae Chang      & jhchang@lanl.gov & CCS--2 & Capsaicin \\ \hline\hline
  \end{tabular}
\end{center} \index{Jayenne} \index{Capsaicin}
Additional information is available on the \draco\ \soft{TeamForge} \index{TeamForge}
site, \href{https://tf.lanl.gov/draco}{https://tf.lanl.gov/draco}.  Also note that the \draco\ team 
maintains a a \sys{UNIX} file sharing group, \index{Unix file sharing group} \comp{draco}.  
Developers wishing to access \draco\ source code or development environment files must be members of this file sharing group. 
Membership is controlled by the current super-users of the group as listed on \href{https://register.lanl.gov}{https://register.lanl.gov} 
which should correspond to the individuals listed in the table above.


%%---------------------------------------------------------------------------%%

\section{Manual Organization}

This manual is written for three basic groups: (a)~\draco\ users, (b)~\draco\ component developers, and (c)~\draco\ system developers. The
manual is organized around these three groups. There is an additional
group consisting of developers who plan to use \draco\ as a model for
their own code systems.  For this group the entire \draco\ Build
System Manual is of interest.

The \draco\ users group consists of clients who use \draco\ components
in some form.  The primary interest of this group is configuring \index{configure} and
compiling \index{compile} \draco\ so that it meets their product's needs.  The
relationship between this group and \draco\ can be very close (CCS--2
code teams) or very distant (XCP-1 code teams).

The \draco\ components developers group contains people who write
packages in \draco.  The primary interest of this group is
configuring, compiling, and adding new packages to \draco.  The final
group, the \draco\ system developers group, are those who maintain the
\draco\ infrastructure, including the build system.  This group is
concerned with maintaining the integrity and stability of \draco\ as a
whole unit. Tables~\ref{tab:draco_package} and \ref{tab:draco_system}
%%% GROUP ROSTERS
\begin{table}
  \begin{center}
    \caption{Roster of the \draco\ package developer group.}
    \label{tab:draco_package}
    \begin{tabular}{llc}\hline\hline
      \multicolumn{1}{c}{Name} & \multicolumn{1}{c}{Email} &
      Group \\ \hline
      Kelly Thompson$^{\ast}$ & kgt@lanl.gov & CCS--2 \\
      Jae Chang & jhchang@lanl.gov & CCS--2 \\
      Allan Wollaber & wollaber@lanl.gov & CCS--2 \\
      Gabe Rockefeller& gaber@lanl.gov & CCS--2 \\
      Jeff Densmore & jdd@lanl.gov & CCS--2 \\
      Kent Budge & kgbudge@lanl.gov & CCS--2 \\
      Jim Warsa & warsa@lanl.gov, & CCS--2 \\
%      John McGhee$^{\ast}$ & mcghee@lanl.gov & XTM \\
%      Tom Evans & tme@lanl.gov & XTM \\
%      Mark Gray & gray@lanl.gov & XTM \\
      Rob Lowrie & lowrie@lanl.gov & CCS--2 \\
%      Shawn Pautz & pautz@lanl.gov & XTM \\ 
%      Randy Roberts & rsqrd@lanl.gov & XTM \\
      Todd Urbatsch & tmonster@lanl.gov &  CCS--2 \\ \hline\hline
      \multicolumn{3}{l}{$^{\ast}$\draco\ project leader.} \\
    \end{tabular}
  \end{center}
\end{table}
\begin{table}
  \begin{center}
    \caption{Roster of the \draco\ systems developer group.}
    \label{tab:draco_system}
    \begin{tabular}{llc}\hline\hline
      \multicolumn{1}{c}{Name} & \multicolumn{1}{c}{Email} &
      Group \\ \hline
      Kelly Thompson & kgt@lanl.gov & CCS--2 \\
      Allan Wollaber & wollaber@lanl.gov & CCS--2 \\
      Jae Chang & jhchang@lanl.gov & CCS--2 \\
%      Tom Evans & tme@lanl.gov & XTM \\
  %    Randy Roberts & rsqrd@lanl.gov & XTM \\ 
\hline\hline
    \end{tabular}
  \end{center}
\end{table}
%%% END GROUP ROSTERS
gives a current list of the \draco\ package and system developers.

Table~\ref{tab:layout} lists the recommended chapters for review by each \draco\ developer group.
\begin{table}
  \begin{center}
    \caption{Chapters targeted for each group of \draco\ developers.}
    \label{tab:layout}
    \begin{tabular}{lll}\hline\hline
          Group                             & Recommended  & Optional \\ \hline
	Users                             & Chap. \ref{chap:model}, \ref{chap:compile}, \ref{chap:extern} and \ref{chap:quickstart} &    \\
	Component Developers & Chap. \ref{chap:model}, \ref{chap:compile}, \ref{chap:adding} and \ref{chap:quickstart} & Chap. \ref{chap:extern} and \ref{chap:extend}  \\
	System Developers        & Chap. \ref{chap:model}, \ref{chap:adding},  \ref{chap:extend} and \ref{chap:quickstart} & Chap. \ref{chap:compile} \\  \hline \hline

    \end{tabular}
  \end{center}
\end{table}
Chapter~\ref{chap:model} gives an overview of the \draco\ source tree
and build system. A complete listing of the \draco\ source tree is
included in this chapter. This chapter is useful for all three groups
that are associated with \draco.

Chapter~\ref{chap:compile} describes how to configure and compile the
\draco\ system.  Included in this chapter are detailed descriptions of
all the \draco\ configure options. Chapter~\ref{chap:extern} shows how
to emulate the \draco\ build model and functionality in external code
systems that use \draco.  This chapter is geared to code teams that
heavily use \draco, and, thus, they may gain advantages by using the
\draco\ build model. These chapters target the \draco\ users and
\draco\ package developers groups.

Chapter~\ref{chap:adding} shows how to add new component packages to
\draco.  In this chapter detailed instructions are given that show how
to add a new package directory, test directory, and, to a lesser
extent, build options.  The intended audience for this chapter is the
\draco\ package developers, and, to a lesser extent, \draco\ system
developers will use this material.

Finally, Chap.~\ref{chap:extend} shows how to extend the \draco\ build 
system.  This chapter focuses on adding new configure options and new
language support.  %In general, this chapter shows how the \gmake\ and
%\autoconf\ files are used and work. 
In general, this chapter shows how the \cmake\ files are used and work.
 This chapter is primarily intended
for \draco\ system developers; however, some content in this chapter
is necessary for \draco\ package developers.

%%---------------------------------------------------------------------------%%
\section{Adminstration}
\label{sec:admin}

\subsection{Important locations}
\draco\ makes use of NFS-based and web-based tools.  Locations of \draco\ related files and services are provided in Table~\ref{tab:important-locations}.
\begin{table}
  \begin{center}
    \caption{File and Internet locations used by \draco}
    \label{tab:important-locations}
    \begin{tabular}{lp{4in}}\hline\hline
          Item                             & Location \\ 
          \hline
          Repository & \url{svn+ssh://ccscs8.lanl.gov/ccs/codes/radtran/svn/} \\
          Archival storage & \url{HPSS://hpss/jayenne/} \\
          Wiki$^a$ & \href{http://tf.lanl.gov}{http://tf.lanl.gov} \\
          Bug Tracker$^a$ &  \href{http://tf.lanl.gov}{http://tf.lanl.gov} \\
          Regression files & \url{ccscs8://home/regress/cmake_draco} and \url{hpc://usr/projects/jayenne/regress} \\
          Regression Dashboard & \href{http://coder.lanl.gov/cdash}{http://coder.lanl.gov/cdash} \\
  	\hline \hline
      \multicolumn{2}{p{0.85\linewidth}}{$^a$The \draco\ team is considering adoption of Redmine for Wiki and Tracker support.  The location of this tool is \url{http://hydra.lanl.gov/redmine} } \\
    \end{tabular}
  \end{center}
\end{table} \index{Repository} \index{archival storage} \index{wiki} \index{bug tracker} \index{regression files} \index{regression dashboard} \index{Redmine}

\subsection{Mailing list and commit notifications} \index{mailing list} \index{commit notification}
The \draco\ team maintains a mailing list used for announcements and general \draco\ discussion. To subscribe to this list, send an email to \url{listmanager@listserv.lanl.gov} 
with the body \comp{'subscribe draco'}. For
more information about mailing lists at LANL you can send an email to the same address with the message
\comp{'help'}. Some list management functions can also be completed by visiting \url{https://register.lanl.gov}.
If you are not sure if you are subscribed or not you can send the command \comp{'which'} to \url{listmanger@listserv.lanl.gov} to see what LANL lists you are subscribed to.
Table~\ref{tab:email-lists} lists a few other mailing lists that may be useful for \draco\ developers to subscribe to.
\begin{table}
  \begin{center}
    \caption{Suggested email lists for \draco\ developers}
    \label{tab:email-lists}
    \begin{tabular}{lp{4.5in}}
    \hline\hline

          List Name                             & Purpose \\ 
          \hline
          \comp{draco} & General \draco\ related discussion, including \svn\ commit messages. \\
          \comp{jayenne} & General \sys{Jayenne} related discussion, including \svn\ commit messages for \sys{ClubIMC}, \sys{Wedgehog} and \sys{Milagro}. \\
          \comp{capsaicin} & General \capsaicin\ related discussion, including \svn\ commit messages. \\
  
	\hline \hline

    \end{tabular}
  \end{center}
\end{table}

\subsection{Regression Dashboard}
\draco\ maintains a regression dashboard at \href{http://coder.lanl.gov/cdash}{http://coder.lanl.gov/cdash}. \draco\ developers are encouraged to visit the dashboard regularly to view the nightly reports.  You may need to contact one of the \draco\ group super-users (see Sec.~\ref{sec:procurement}) to gain access to the the dashboard.  You can configure the dashboard to send email for various situations like failing unit tests. \index{regression dashboard}

\subsection{Issue Tracking}
\draco\ uses the LANL \soft{Team Forge} bug tracking system to manage issue, bug and feature tracking. \soft{Team Forge} can be accessed by opening a web browser from the Yellow network (i.e.: inside the LANL firewall) to \url{https://tf.lanl.gov}. You are encouraged to browse the list of known bugs/issues of the project you are working on.

%%---------------------------------------------------------------------------%%

\section{Quick Start}
\label{sec:quick}

Many \draco\ users will undoubtedly be familiar with \cmake\ and \make. These users can progress directly to Chapter~\ref{chap:quickstart} and \S~\ref{sec:examples} for 
examples on configuring and building \draco. 

