\documentclass[12pt]{article}
%\usepackage{amstex}
\usepackage{amsmath}

\headheight 0pt  \headsep 0pt
\topmargin 0pt  
\oddsidemargin 0pt  
\textheight 9 in \textwidth 6.5in

\newcommand{\partl}[2]{\ensuremath{\frac{\partial{#1}}{\partial{#2}}}}\newcommand{\del}{\ensuremath{\vec{\nabla}}}
\newcommand{\dt}{\ensuremath{\Delta t}}
\newcommand{\cviOdt}{\ensuremath{\frac{C_{vi}}{\dt}}}
\newcommand{\cveOdt}{\ensuremath{\frac{C_{ve}}{\dt}}}
\newcommand{\Cvs}{\ensuremath{C_{v}^{*}}}
\newcommand{\cvsOdt}{\ensuremath{\frac{\Cvs}{\dt}}}
\newcommand{\Bg}{\ensuremath{\hat{B}_{g}}}
\newcommand{\Bnphlf}{\ensuremath{\hat{B}^{n+\frac{1}{2}}}}
\newcommand{\pBnphlfdT}{\ensuremath{\frac{\partial\hat{B}}{\partial T}^{n+\frac{1}{2}}}}
\newcommand{\Bgnphlf}{\ensuremath{\hat{B}_{g}^{n+\frac{1}{2}}}}
\newcommand{\pBgnphlfdT}{\ensuremath{\frac{\partial\hat{B}_{g}}{\partial T}^{n+\frac{1}{2}}}}
\newcommand{\Bknphlf}{\ensuremath{\hat{B}_{k}^{n+\frac{1}{2}}}}
\newcommand{\pBknphlfdT}{\ensuremath{\frac{\partial\hat{B}_{k}}{\partial T}^{n+\frac{1}{2}}}}
\newcommand{\units}[1]{\ensuremath{[\mbox{#1}]}}
\newcommand{\bfunc}{\ensuremath{f_{b}}}
\newcommand{\tensor}[1]{\ensuremath{\stackrel{\leftrightarrow}{#1}}}
\newcommand{\bracket}[3]{%
  \ensuremath{%
       \left\langle {#1} \rule{0mm}{4ex} \right|%
       {#2} \left| {#3}  \rule{0mm}{4ex} \right\rangle%
  }%
}

\begin{document}

\title{3-T Diffusion with Material Motion Corrections}
\author{R. M. Roberts}
\date{\today}

\maketitle

\newpage

\section{Ion Temperature Equation}

The differential equation governing the ion temperature is
\begin{equation}
        C_{vi} \partl{T_{i}}{t} = \del \cdot \kappa_{i} \del T_{i}
                                        + \gamma (T_{e}-T_{i}) + Q_{i}
\end{equation}
This equation will be solved using time-splitting, into two equations,
\begin{equation}
        C_{vi} \partl{T_{i}}{t} = \del \cdot \kappa_{i} \del T_{i}
\label{eq:conduction_Ti}
\end{equation}
and
\begin{equation}
        C_{vi} \partl{T_{i}}{t} = \gamma (T_{e}-T_{i}) + Q_{i}
\label{eq:couple_Ti}
\end{equation}
that will be solved separately.
The first of these equations will be solved along with a corresponding
electron temperature equation, and the radiation equations.
The second equation will be solved after these equations.

\subsection{Conduction Equation}

Implicitly differencing equation~(\ref{eq:conduction_Ti})
we obtain
\begin{equation}
  \boxed{
     - \del \cdot \kappa_{i} \del T_{i}^{n+\frac{1}{2}}
     + \frac{C_{vi}}{\Delta t} T_{i}^{n+\frac{1}{2}}
           = \frac{C_{vi}}{\Delta t} T_{i}^{n}
  }
\label{eq:conduction_Ti_tdiff}  
\end{equation}
In the above equation the time split is indicated by solving at the
intermediate $n+\frac{1}{2}$ time from the $n$ time solution.

\subsection{Coupled Electron Equation}

Implicitly time-differencing equation~(\ref{eq:couple_Ti}) we obtain
\begin{equation}
        \cviOdt ( T_{i}^{n+1}-T_{i}^{n+\frac{1}{2}}) =
                 \gamma (T_{e}^{n+1}-T_{i}^{n+1}) + Q_{i}
\end{equation}
We will be arranging this equation to obtain the time difference of
the ion temperature, $\Delta T_{i}^{n+1}$,
where $\Delta T^{n+1}$ is defined for both ions and electrons by:
\begin{equation}
   \boxed{
        \Delta T^{n+1} \equiv T^{n+1} - T^{n+\frac{1}{2}}
   }
\end{equation}

\begin{equation}
        T_{i}^{n+1}\left\{ \cviOdt + \gamma \right\} =
                \cviOdt T_{i}^{n+\frac{1}{2}} + \gamma T_{e}^{n+1} + Q_{i}
\end{equation}
\begin{equation}
        \Delta T_{i}^{n+1} = \frac{ \left( \cviOdt - \cviOdt - \gamma 
                                        \right) T_{i}^{n+\frac{1}{2}}
                         + \gamma T_{e}^{n+1} + Q_{i} }
                {(\cviOdt + \gamma)}
\end{equation}
\begin{equation}
   \boxed{
        \Delta T_{i}^{n+1} = \frac{ \gamma ( T_{e}^{n+\frac{1}{2}} - T_{i}^{n+\frac{1}{2}} )
                                + \gamma \Delta T_{e}^{n+1} + Q_{i} }
                {(\cviOdt + \gamma)}
         }
\label{eq:Tinp1}
\end{equation}
We will be using the above equation to determine new ion temperatures,
given the change in electron temperatures, $\Delta T_{e}^{n+1}$.

We now will rearrange the equation in order that we may substitute the
ion temperature equation into the electron temperature equation.
\begin{eqnarray}
        \Delta T_{i}^{n+1} &=& \frac{ \gamma ( T_{e}^{n+1} - T_{i}^{n+\frac{1}{2}} )
                                + Q_{i} }{(\cviOdt + \gamma)} 
                \\
                           &=& \frac{ \dt \gamma
                                         ( T_{e}^{n+1} - T_{i}^{n+\frac{1}{2}} )
                                + \dt Q_{i} }{(C_{vi} + \dt \gamma)}
\end{eqnarray}
\begin{equation}
        \gamma (T_{i}^{n+1}-T_{e}^{n+1}) =
                \gamma \left\{ \frac{\cviOdt T_{i}^{n+\frac{1}{2}} + \gamma T_{e}^{n+1}
                                + Q_{i} - (\cviOdt + \gamma) T_{e}^{n+1}}
                                {(\cviOdt + \gamma)} \right\}
\end{equation}
\begin{equation}
   \boxed{
   \begin{split}
        \gamma (T_{i}^{n+1}-T_{e}^{n+1}) =
                \left(\frac{\gamma\dt}{C_{vi} + \gamma \dt} \right)
                &  \left\{\cviOdt(T_{i}^{n+\frac{1}{2}} - T_{e}^{n+\frac{1}{2}}) \right.
        \\
                & \left.
                        - \cviOdt \Delta T_{e}^{n+1}
                        + Q_{i} \right\}
   \end{split}
   }
\label{eq:Ti}
\end{equation}

\section{Electron Temperature Equation}

The differential equation for the electron temperature is
\begin{equation}
  \begin{split}
        C_{ve} \partl{T_{e}}{t} = 
                \del \cdot \kappa_{e} \del T_{e} & +
                \sum_{g} \left(
                        \sigma_{g}^{a} \phi_{g} - \tilde{\xi}_{g}
                        - \sigma_{g}^{e} \Bg(T_{e}) \right) \\
                        & + \gamma (T_{i} - T_{e}) + Q_{e}
  \end{split}
\end{equation}
where the Planck function $B_{g}(T)$ has been replaced by
\begin{equation}
        \Bg(T) \equiv 4\pi B_{g}(T)
\end{equation}

As for the ion equation we split the electron temperature into two
equations,
\begin{equation}
        C_{ve} \partl{T_{e}}{t} = 
                \del \cdot \kappa_{e} \del T_{e}
\label{eq:conduction_Te}
\end{equation}
and
\begin{equation}
        C_{ve} \partl{T_{e}}{t} = 
                \sum_{g} \left(
                        \sigma_{g}^{a} \phi_{g} - \tilde{\xi}_{g}
                        - \sigma_{g}^{e} \Bg(T_{e}) \right)
                        + \gamma (T_{i} - T_{e}) + Q_{e}
\label{eq:couple_Te}
\end{equation}
that will be solved separately.
The first of these equations will be solved along with a radiation
equations and corresponding
ion temperature equation.
The second equation will be solved after these equations.

\subsection{Conduction Equation}

Implicitly differencing equation~(\ref{eq:conduction_Te})
we obtain
\begin{equation}
  \boxed{
     - \del \cdot \kappa_{e} \del T_{e}^{n+\frac{1}{2}}
     + \frac{C_{ve}}{\Delta t} T_{e}^{n+\frac{1}{2}}
           = \frac{C_{ve}}{\Delta t} T_{e}^{n}
   }
\label{eq:conduction_Te_tdiff}  
\end{equation}
In the above equation the time split is indicated by solving at the
intermediate $n+\frac{1}{2}$ time from the $n$ time solution.

\subsection{Coupled Ion and Radiation Equation}

We implicitly time-difference equation~(\ref{eq:couple_Te}),
expanding the Planck function,
$\Bg(T_{e})$ in a Taylor expansion
\begin{equation}
        \Bg(T_{e}^{n+1}) \approx \Bg(T_{e}^{n+\frac{1}{2}})
                 + \Delta T_{e}^{n+1} \partl{\Bg}{T}(T_{e}^{n+\frac{1}{2}})
\end{equation}
\begin{eqnarray}
        \cveOdt \Delta T_{e}^{n+1} &=&
                \sum_{g} \left(
                        \sigma_{g}^{a} \phi_{g}^{n+1} - \tilde{\xi}_{g}^{n}
                        - \sigma_{g}^{e} \Bgnphlf
                        - \sigma_{g}^{e} \Delta T_{e}^{n+1} \pBgnphlfdT 
                        \right) \nonumber \\
                & & \mbox{} + \gamma (T_{i}^{n+1} - T_{e}^{n+1}) + Q_{e}
\label{eq:Te}
\end{eqnarray}
where the material motion correction terms are
\begin{equation}
        \tilde{\xi}_{g}^{n} = 2 \sigma_{g}^{a} \vec{F}_{g}^{(0)} \cdot
                                \frac{\vec{v}^{n}}{c}, 
\label{eq:tilde_xi}
\end{equation}
and
\begin{equation}
        \vec{F}_{g}^{(0)} = \vec{F}_{g}^{n} - \frac{4}{3} \phi_{g}^{n}
                                                \frac{\vec{v}^{n}}{c}
\end{equation}
These have been calculated at the previous timestep.

We will need to find an expression for $\Delta T_{e}^{n+1}$ to be
substituted into the radiation equation.
By substituting from (\ref{eq:Ti}) into (\ref{eq:Te}), we get
\begin{multline}
        \cveOdt \Delta T_{e}^{n+1} =
                \sum_{g} \left(
                        \sigma_{g}^{a} \phi_{g}^{n+1} - \tilde{\xi}_{g}^{n}
                        - \sigma_{g}^{e} \Bgnphlf
                        - \sigma_{g}^{e} \Delta T_{e}^{n+1} \pBgnphlfdT 
                        \right)
        \\
                         + \left(\frac{\gamma\dt}{C_{vi} + 
                                        \gamma \dt} \right)
                        \left\{\cviOdt(T_{i}^{n+\frac{1}{2}}-T_{e}^{n+\frac{1}{2}})
                                 - \cviOdt \Delta T_{e}^{n+1}
                        + Q_{i} \right\}
                        + Q_{e}
\end{multline}
\begin{multline}
        \Delta T_{e}^{n+1} \left\{ \cveOdt +
                \frac{\gamma C_{vi}}{C_{vi} + \gamma \dt } +
                \sum_{g} \sigma_{g}^{e} \pBgnphlfdT \right\} =
                   \sum_{g} \left( \sigma_{g}^{a} \phi_{g}^{n+1} - 
                        \tilde{\xi}_{g}^{n} - \sigma_{g}^{e} \Bgnphlf \right)
        \\
                  +  \left(\frac{\gamma\dt}{C_{vi} + 
                                        \gamma \dt} \right)
                        \left\{\cviOdt(T_{i}^{n+\frac{1}{2}}-T_{e}^{n+\frac{1}{2}}) + Q_{i} \right\}
                         + Q_{e}
\end{multline}

\begin{equation}
   \boxed{
        \Delta T_{e}^{n+1} =
                \frac{\sum_{g} \left( \sigma_{g}^{a} \phi_{g}^{n+1} 
                         - \sigma_{g}^{e} \Bgnphlf \right)
                         + Q_{e}^{*}}
                {\cvsOdt + \sum_{g} \sigma_{g}^{e} \pBgnphlfdT}
         }
\label{eq:Tenp1}
\end{equation}
where,
\begin{equation}
        \Cvs = C_{ve} + C_{vi} \left(\frac{\gamma\dt}{C_{vi}+\gamma\dt}\right)
\end{equation}
\begin{equation}
        Q_{e}^{*} = Q_{e} + \left\{ \cviOdt (T_{i}^{n+\frac{1}{2}} - T_{e}^{n+\frac{1}{2}}) +
                                Q_{i} \right\}
                \left(\frac{\gamma\dt}{C_{vi}+\gamma\dt}\right) -
                \sum_{g} \tilde{\xi}_{g}^{n}
\end{equation}

\section{The Radiation Transport Equation}

The multi-group equation for the radiation field in a material
with isotropic scattering is
\begin{equation}
        \frac{1}{c} \partl{\psi_{g}}{t}
        + \hat{\Omega} \cdot \del \psi_{g}
        + \sigma^{t}_{g} \psi_{g}
        = \frac{1}{4 \pi}
         \left( \sigma^{s}_{g} \phi_{g}
                + \xi_{g}
                + \sigma^{e}_{g} \Bg(T_{e})
                + Q_{r}
         \right)
\label{eq:psi}
\end{equation}
This equation contains the material motion correction
\begin{equation}
        \xi_{g} = \left[ (\sigma^{a}_{g} - \sigma^{s}_{g}) \vec{F}^{(0)}_{g}
                + 4 \sigma^{t}_{g} \phi_{g} \hat{\Omega} \right]
                        \cdot \frac{\vec{v}}{c}
\label{eq:xi}
\end{equation}

Implicitly time-differencing this equation we obtain
\begin{eqnarray}
\hat{\Omega} \cdot \del \psi^{n+1}_{g} + (\sigma^{t}_{g} + \tau) \psi^{n+1}_{g}
        &=&  \tau \psi_{g}^{n}
         + \frac{1}{4\pi} \left( \sigma^{s}_{g} \phi^{n+1}_{g}
        + \xi_{g}^{n} + Q_{r} \right)
  \nonumber \\
    & & \mbox{}
        + \frac{1}{4\pi} \sigma^{e}_{g} 
                \left(\Bgnphlf + \Delta T_{e}^{n+1} \pBgnphlfdT \right)
\label{eq:RadEq1}
\end{eqnarray}
We have introduced $\tau$,
\begin{equation}
        \tau = \frac{1}{c\dt}
\end{equation}
In the above time-differencing
we have calculated the material motion corrections at the previous timestep.

Substituting (\ref{eq:Tenp1}) into (\ref{eq:RadEq1}) we get,
\begin{multline}
\hat{\Omega} \cdot \del \psi^{n+1}_{g} + (\sigma^{t}_{g} + \tau) \psi^{n+1}_{g}
        =
         \tau \psi_{g}^{n}
        + \frac{1}{4\pi} \left(
                \sigma^{s}_{g} \phi^{n+1}_{g}
                + \xi_{g}^{n}
                + \sigma^{e}_{g} \Bgnphlf + Q_{r}\right)
        \\
        + \frac{1}{4\pi} \sigma^{e}_{g} \pBgnphlfdT
                \left\{ \frac{\sum_{k} (\sigma_{k}^{a}\phi_{k}^{n+1} 
                                        - \sigma_{k}^{e}\Bknphlf) + Q_{e}^{*}}
                             {\frac{\Cvs}{\dt} + \sum_{k} \sigma_{k}^{e}\pBknphlfdT}
                \right\}
\label{eq:RadEqMG}
\end{multline}

At this point we can go in one of two directions.  We could form the
multigroup transport equations, and show that they contain fission-like terms.
Alternatively we could assume a one-group equation
with grey coefficients, and strive to derive the
one-group diffusion equation.  We will derive the one-group diffusion equation.

\subsection{Grey Transport Equation}

First we assume that the $\sigma$'s are independent of group, then
we define non-subscripted quantities as sums over groups, e.g.
\begin{equation}
        \psi^{n} = \sum_{g} \psi_{g}^{n}
\end{equation}
We then sum (\ref{eq:RadEqMG}) over groups to obtain:
\begin{eqnarray}
\hat{\Omega} \cdot \del \psi^{n+1} + (\sigma^{t} + \tau) \psi^{n+1}
        &=& \tau \psi^{n}
        + \frac{1}{4\pi} \left( \sigma^{s} \phi^{n+1}
                        + \xi^{n}
                        + \sigma^{e} \Bnphlf + Q_{r} \right)
        \nonumber \\
        & & \mbox{}
        + \frac{1}{4\pi} \nu \left( \sigma^{a}\phi^{n+1}
                                        - \sigma^{e}\Bnphlf + Q_{e}^{*}\right)
\label{eq:RadEqGrey}
\end{eqnarray}
where
\begin{equation}
        \nu = \frac{\sigma^{e} \pBnphlfdT } {\frac{\Cvs}{\dt}
                                             + \sigma^{e}\pBnphlfdT}
\end{equation}

\subsection{Grey Diffusion Equation}

We will now assume that $\psi$ contains only zero and first Legendre moments,
i.e.\ 
\begin{equation}
        \psi^{n} = \frac{1}{4\pi} \left(
                        \phi^{n} + 3 \vec{F}^{n} \cdot \hat{\Omega}
                   \right)
\end{equation}
Integrating (\ref{eq:RadEqGrey}) over all angles
we obtain:
\begin{eqnarray}
\del \cdot \vec{F}^{n+1} + (\sigma^{t} + \tau) \phi^{n+1}
        &=& \sigma^{s}\phi^{n+1} + \tau \phi^{n}
        + \langle \xi^{n} \rangle
        + \sigma^{e} \Bnphlf  + Q_{r}
        \nonumber \\
        & & \mbox{}
        + \nu (\sigma^{a}\phi^{n+1} - \sigma^{e}\Bnphlf + Q_{e}^{*})
\end{eqnarray}
From (\ref{eq:xi}) we can determine $\langle \xi^{n} \rangle$
\begin{eqnarray}
        \langle \xi^{n} \rangle &=&
                \frac{1}{4\pi} \int d\Omega \; \xi^{n}
                \\
                &=& \frac{1}{4\pi} \int d\Omega \;
                    \left[ (\sigma^{a} - \sigma^{s}) \vec{F}^{(0)}
                        + 4 \sigma^{t} \phi^{n} \hat{\Omega} \right]
                                \cdot \frac{\vec{v}^{n}}{c}
                \\
                 &=& (\sigma^{a} - \sigma^{s}) \vec{F}^{(0)}
                        \cdot \frac{\vec{v}^{n}}{c}
\label{eq:l_xi_r}
\end{eqnarray}
Rearranging terms:
\begin{eqnarray}
\del \cdot \vec{F}^{n+1} + [(1 - \nu) \sigma^{a} + \tau ] \phi^{n+1}
        &=& \tau \phi^{n}
        + \langle \xi^{n} \rangle
        + (1 - \nu) \sigma^{e} \Bnphlf  
        \nonumber \\
        & & \mbox{}
        + \nu Q_{e}^{*} + Q_{r}
\label{eq:phiEq}
\end{eqnarray}
where we have used
\begin{equation}
        \sigma^{t} = \sigma^{a} + \sigma^{s}
\end{equation}

To obtain the flux equation we
multiply (\ref{eq:RadEqGrey}) by $\hat{\Omega}$ and 
integrate over all angles:
\begin{equation}
\frac{1}{3} \del \phi^{n+1} + (\sigma^{t} + \tau) \vec{F}^{n+1}
        = \tau \vec{F}^{n}
        + \langle \hat{\Omega} \xi^{n} \rangle
\end{equation}
From (\ref{eq:xi}) we can determine $\langle \hat{\Omega} \xi^{n} \rangle$
\begin{eqnarray}
        \langle \hat{\Omega} \xi^{n} \rangle &=&
                    \frac{1}{4\pi} \int d\Omega \; \hat{\Omega} \; \xi^{n}
                \\
                &=& \frac{1}{4\pi} \int d\Omega \; \hat{\Omega}
                    \left[ (\sigma^{a} - \sigma^{s}) \vec{F}^{(0)}
                        + 4 \sigma^{t} \phi^{n} \hat{\Omega} \right]
                                \cdot \frac{\vec{v}^{n}}{c}
                \\
                &=& \frac{4}{3} \sigma^{t} \phi^{n} \frac{\vec{v}^{n}}{c}
\end{eqnarray}
Rearranging terms we obtain:
\begin{equation}
\vec{F}^{n+1}
        = - \frac{1}{3(\sigma^{t} + \tau) } \del \phi^{n+1} 
        + \frac{\tau \vec{F}^{n}
                        + \langle \hat{\Omega} \xi^{n} \rangle}
               {(\sigma^{t} + \tau)} 
\label{eq:Flux}
\end{equation}

Substituting (\ref{eq:Flux}) into (\ref{eq:phiEq}) we obtain
the second order equation:
\begin{equation}
   \boxed{
         - \del \cdot D \del \phi^{n+1} +  \bar{\sigma}^{a} \phi^{n+1}
                = \bar{Q}_{r} - \del \cdot \vec{F}'
         }
\label{eq:Diffusion}
\end{equation}
where
\begin{gather}
        D = \frac{1}{3(\sigma^{t} + \tau) } 
  \label{eq:quant_i}
  \\
        \bar{\sigma}^{a} = (1 - \nu) \sigma^{a} + \tau 
  \\
        \bar{Q}_{r} =\tau \phi^{n}
                + \langle \xi^{n} \rangle
                + (1 - \nu) \sigma^{e} \Bnphlf  + \nu Q_{e}^{*} + Q_{r}
  \\
        \vec{F}' = \frac{\tau \vec{F}^{n}
                        + \langle \hat{\Omega} \xi^{n} \rangle}
               {(\sigma^{t} + \tau)}
  \\
        \tau = \frac{1}{c\dt}
  \\
        \hat{B}(T_{e}) = 4\pi B(T_{e})
  \\
        \nu = \frac{\sigma^{e} \pBnphlfdT } {\frac{\Cvs}{\dt} + \sigma^{e}\pBnphlfdT}
  \\
        \Cvs = C_{ve} + C_{vi} \left(\frac{\gamma\dt}{C_{vi}+\gamma\dt}\right)
  \\
        Q_{e}^{*} = Q_{e} + \left\{ \cviOdt (T_{i}^{n+\frac{1}{2}} - T_{e}^{n+\frac{1}{2}}) +
                                Q_{i} \right\}
                \left(\frac{\gamma\dt}{C_{vi}+\gamma\dt}\right) -
                \tilde{\xi}^{n}
%  \\
\end{gather}
and
\begin{gather}
        \langle \xi^{n} \rangle =
                        (\sigma^{a} - \sigma^{s}) \vec{F}^{(0)}
                        \cdot \frac{\vec{v}^{n}}{c}
  \\
        \langle \hat{\Omega} \xi^{n} \rangle =
                \frac{4}{3} \sigma^{t} \phi^{n} \frac{\vec{v}^{n}}{c}
  \\
        \tilde{\xi}^{n} = 2 \sigma^{a} \vec{F}^{(0)} \cdot
                                \frac{\vec{v}^{n}}{c}
  \\
        \vec{F}^{(0)} = \vec{F}^{n} - \frac{4}{3} \phi^{n}
                                                \frac{\vec{v}^{n}}{c}
  \label{eq:quant_f}
\end{gather}

Equation (\ref{eq:Diffusion}) can be solved as is,
or as two coupled first order equations,
by rewriting equations (\ref{eq:phiEq}) and (\ref{eq:Flux}) with the above
definitions:
\begin{equation}
   \boxed{
        \del \cdot \vec{F}^{n+1} + \bar{\sigma}^{a} \phi^{n+1}
                = \bar{Q}_{r}
         }
\label{eq:phi2}
\end{equation}
and
\begin{equation}
   \boxed{
        \vec{F}^{n+1} + D \del \phi^{n+1} =  \vec{F}'
         }
\label{eq:Flux2}
\end{equation}

\section{Solution Sequence}

We begin the solution sequence with radiation intensities,
radiation fluxes, velocities,
material properties, and timestep specified at time, $n$.
We then solve the conduction
equations,~(\ref{eq:conduction_Ti_tdiff})~and~(\ref{eq:conduction_Te_tdiff}),
for the ion and electron temperatures at time $n+\frac{1}{2}$.

With the radiation intensities,
radiation fluxes, velocities,
material properties, and timestep specified at time, $n$,
and the temperatures calculated at time $n+\frac{1}{2}$
all of the quantities specified in
equations~(\ref{eq:quant_i})~--~(\ref{eq:quant_f}) may be calculated.
Then either equation~(\ref{eq:Diffusion}) is
solved or equations~(\ref{eq:phi2})~and~(\ref{eq:Flux2}) are solved for
$\phi^{n+1}$ and $\vec{F}^{n+1}$.
In the case of solving equation~(\ref{eq:Diffusion}) we would use
equation~(\ref{eq:Flux2}) to obtain $\vec{F}^{n+1}$.

Having solved for $\phi^{n+1}$ we can substitute this
value into equation~(\ref{eq:Tenp1}) to solve for $T_{e}^{n+1}$.
In this case the sum over groups may be ignored.

Having solved
for $T_{e}^{n+1}$ we are able to
solve equation~(\ref{eq:Tinp1}) for $T_{i}^{n+1}$.

Crucial outputs from these calculations are
the new temperatures, with which the ion and electron
energy density depositions,
c.f.~(\ref{eq:hydrointernalenergy}),
\begin{eqnarray}
        \Delta E_{i}^{n+1} &=& C_{vi} ( T_{i}^{n+1} - T_{i}^{n})
  \\
        \Delta E_{e}^{n+1} &=& C_{ve} ( T_{e}^{n+1} - T_{e}^{n})
\end{eqnarray}
and the rate of momentum density
deposited into the material by the radiation,
c.f.~(\ref{eq:hydromomentum}),
\begin{equation}
   {\frac{d\vec{p}}{dt}}^{n+1} = \frac{\sigma^{t}}{c} \vec{F}^{(0)}
\end{equation}
may be calculated.
In the above calculation
the Lagrangian flux, $\vec{F}^{(0)}$, has been recalculated at the
new time, $n+1$,
\begin{equation}
   \vec{F}^{(0)} = \vec{F}^{n+1} - \frac{4}{3} \phi^{n+1}
                                                \frac{\vec{v}^{n}}{c}
\end{equation}

This solution sequence ensures that the coupling of the electron and ion
temperatures are handled last; therefore, in a highly coupled system,
even though the conduction equations may relax the coupling of the temperatures,
the subsequent calculation of the coupled equations reinforces this coupling.


\appendix

\section{Definitions and Units}

It is important to realize that we are using radiative transport terminology
for the description of the radiation field.

The radiation field, angular intensity, integrated over 
a photon energy/frequency range determined by $g$ is defined by $\psi_{g}$
\begin{eqnarray}
     [\psi_{g}] &=& \frac{\units{energy} \units{velocity}}
                         {\units{solid angle} \units{volume}} \\
                &=& \frac{\units{energy}}
                         {\units{solid angle} \units{area} \units{time}}
\end{eqnarray}
The scalar intensity of the radiation field integrated over 
a photon energy/frequency range determined by $g$ is defined by
\begin{equation}
        \phi_{g} = \int \psi_{g} \; d\Omega
\end{equation}
with units
\begin{equation}
        [\phi_{g}] = \frac{\units{energy}}
                          {\units{area} \units{time}}
\end{equation}
The radiation flux is defined such that the net energy flow across
a surface with unit normal $\hat{n}$ is $\hat{n} \cdot \vec{F}$
where
\begin{equation}
        \vec{F}_{g} = \int \hat{\Omega} \psi_{g} \; d\Omega
\end{equation}
with units
\begin{equation}
        [\vec{F}_{g}] = \frac{\units{energy}}
                         {\units{area}\units{time}}
\end{equation}

The timestep in the solver is $\Delta t$
\begin{equation}
        [\Delta t] = \units{time}
\end{equation}
the units of $\tau$ are
\begin{equation}
        [\tau] = \frac{1}{\units{length}}
\end{equation}

The electron and ion temperatures, $T_{e}$ and $T_{i}$, are specified
in units of temperature
\begin{equation}
        [T] = \units{temperature}
\end{equation}

The units for the electron and ion specific heats, $C_{ve}$ and $C_{vi}$, are 
\begin{equation}
        [C_{v}] = \frac{\units{energy}}{\units{volume}\units{temperature}}
\end{equation}

The external energy sources for the electrons and ions are defined by
$Q_{e}$ and $Q_{i}$ with the following units
\begin{equation}
        [Q] = \frac{\units{energy}}{\units{volume}\units{time}}
\end{equation}

The electron-ion coupling constant is defined by $\gamma$, whose units are
\begin{equation}
        [\gamma] = \frac{\units{energy}}{\units{volume}\units{temperature}
                                         \units{time}}
\end{equation}

The Planck function, $B_{g}(T)$, is the angular intensity
of radiated energy emitted from a 
black body into a photon energy/frequency range determined by~$g$
\begin{eqnarray}
        [B_{g}] &=& \frac{\units{energy} \units{velocity}}
                         {\units{solid angle} \units{volume}} \\
                &=& \frac{\units{energy}}
                         {\units{solid angle} \units{area} \units{time}}
\end{eqnarray}
We define
\begin{equation}
   \Bg = 4\pi B_{g}
\end{equation}
 as the Planck function integrated over solid angle
\begin{equation}
        [\Bg] = \frac{\units{energy}}
                     {\units{area} \units{time}}
\end{equation}

Absorption, scattering, emissive, and total cross sections, $\sigma^{a}$,
$\sigma^{s}$, $\sigma^{e}$, and $\sigma^{t} = \sigma^{a} + \sigma^{s}$,
are macroscopic cross sections whose units are
\begin{equation}
        [\sigma] = \frac{1}{\units{length}}
\end{equation}

The units for the material motion correction terms are
\begin{equation}
        [\xi] = \frac{\units{energy}}
                     {\units{volume} \units{time} \units{solid angle}}
\end{equation}
and
\begin{equation}
        [\tilde{\xi}] = \frac{\units{energy}}
                             {\units{volume} \units{time}}
\end{equation}

\section{Material Motion Correction Terms}

The two material motion correction terms, $\tilde{\xi}$ and $\xi$, result
from first order in $v/c$ corrections to the electron temperature equation
and the radiation transport equation, respectively.

The $\tilde{\xi}$ can be seen as by rewriting the electron equation in
the Lagrangian frame
\begin{equation}
        C_{ve} \partl{T_{e}}{t} = 
                \sum_{g} \left(
                        \sigma_{g}^{a} \phi^{(0)}_{g}
                        - \sigma_{g}^{e} \Bg(T_{e}) \right)
                        + \gamma (T_{i} - T_{e}) + Q_{e}
\end{equation}
and applying the Lorentz transformation of $\phi$ from the Lagrangian frame
to the laboratory frame~\cite[page 417]{MihalasMihalas}
\begin{equation}
        \phi^{(0)} = \phi - 2 \vec{F}^{(0)} \cdot \frac{\vec{v}}{c} 
                 + \mathcal{O}(\frac{v^2}{c^2})
\end{equation}
This leads to the additional term, $\tilde{\xi}$,
expressed in~(\ref{eq:tilde_xi}).

The $\xi$ terms come from analysis of equations (2.29) and (2.30)
of~\cite{MihalasKlein}.
The velocity-dependent term in equation (2.29) of~\cite{MihalasKlein}
is equivalent to a term
\begin{equation}
        \langle \xi' \rangle = (\sigma^{a} - \sigma^{s}) \vec{F}
                        \cdot \frac{\vec{v}}{c}
\end{equation}
added to the Lagrangian frame equation for $\phi$,
where the flux, $\vec{F}$, is evaluated in the laboratory frame.
The $\langle \xi \rangle$ in (\ref{eq:phiEq}) is, instead, evaluated in the
Lagrangian frame~(\ref{eq:l_xi_r}).
These expressions differ only in terms of $\mathcal{O}(v^2/c^2)$,
but our expression
leads to conservation of energy between the material and radiation equations
to all orders of $v/c$.

The expression for $\langle \hat{\Omega} \xi \rangle$ can be discovered
if equation (2.30) of~\cite{MihalasKlein} is evaluated in the diffusion limit
for both $\phi$ and the radiation pressure tensor, $P_{r}^{ij}$,
\begin{eqnarray}
        \phi &\rightarrow& \hat{B} \\
        P_{r}^{ij} &\rightarrow& \frac{1}{3c} \phi \; \delta_{ij} 
\end{eqnarray}
one obtains an addition to the Lagrangian frame flux equation of
\begin{equation}
        \langle \hat{\Omega} \xi \rangle = 
                \frac{4}{3} \sigma^{t} \phi \frac{\vec{v}}{c}
\end{equation}
This is the same expression as is used in (\ref{eq:Flux}).

\section{Radiation-Hydrodynamic Coupling}

This section is a brief discussion of how the ion, electron, and radiation
equations are coupled into the hydrodynamic equations.
In the interest of brevity we are only considering a single material equation,
instead of separate ion and electron equations, and we ignore the contributions
from heat conduction and external sources.

The fundamental equations of radiation-hydrodynamics are:
\begin{itemize}
  \item The continuity equation, c.f.\ \cite[Eq.~(16)]{PomraningLAUR}
     \begin{equation}
        \partl{\rho}{t} + \del \cdot (\rho \vec{v}) = 0
     \label{eq:continuity}
     \end{equation}
  \item The conservation of momentum equation, c.f.\ \cite[Eq.~(17)]{PomraningLAUR}
     \begin{equation}
        \partl{}{t}\left( \rho \vec{v} + \frac{1}{c^2} \vec{F} \right)
         + \del \cdot \left( \rho \vec{v} \vec{v} + \tensor{P_{r}} \right)
         + \del P_{m}
         = 0
     \label{eq:momentum}
     \end{equation}
     where $\vec{F}$ is the radiation flux,
     $\tensor{P_{r}}$ is the radiation pressure tensor,
     and $P_{m}$ is the material pressure.
  \item The conservation of energy equation,
          c.f.\ \cite[Eq.~(18)]{PomraningLAUR}
     \begin{equation}
        \partl{}{t}\left( \frac{1}{2} \rho v^2
                          + E_{m} + E_{r} \right)
         + \del \cdot \left[
              \left( \frac{1}{2} \rho v^2 + E_{m} + P_{m} \right) \vec{v}
              + \vec{F} \right]
         = 0
     \label{eq:totalenergy}
     \end{equation}
     where $E_{m}$ is the material energy density, and $E_{r} = \phi / c$
     is the radiation energy density.
\end{itemize}
All of the radiative terms in the above equations are considered summed
over groups.

It is obvious that equations~(\ref{eq:momentum})~and~(\ref{eq:totalenergy})
depend on the solution of the radiation equations.
Since it is the responsibility of the 3-T package to provide a means for
the hydro package to solve these equations, they must be reformulated
in terms of only hydrodynamic variables and radiation ``source terms''.

Beginning with the conservation of momentum equation, (\ref{eq:momentum}),
we move all of the radiation dependent terms to the right hand side of the
equation,
\begin{equation}
   \partl{}{t}\left( \rho \vec{v}\right)
      + \del \cdot \left( \rho \vec{v} \vec{v} \right)
      + \del P_{m}
   =
   - \left[ \frac{1}{c^2} \partl{\vec{F}}{t}
            + \del \cdot \tensor{P_{r}}
     \right]
\label{eq:momentum2}
\end{equation}
By dividing equation~(\ref{eq:psi}) by $c$, multiplying by $\hat{\Omega}$,
integrating over angles, and rearranging terms, we obtain
\begin{eqnarray}
   \frac{1}{c^2} \partl{\vec{F}}{t} + \del \cdot \tensor{P_{r}}
      &=& - \frac{1}{c} \sum_{g} \left( \sigma^{t}_{g} \vec{F}_{g}
                              - \langle \hat{\Omega} \xi_{g} \rangle \right)
         \\
      &=& - \sum_{g} \frac{\sigma^{t}_{g}}{c}
             \left( \vec{F}_{g} - \frac{4}{3} \phi_{g} \frac{\vec{v}}{c} \right)
         \\
      &=& - \sum_{g} \frac{\sigma^{t}_{g}}{c} \vec{F}^{(0)}_{g}
\end{eqnarray}
Combining this result with~(\ref{eq:momentum2}) we obtain the hydrodynamic
momentum equation with a radiation momentum deposition source,
\begin{equation}
 \boxed{
   \partl{}{t}\left( \rho \vec{v}\right)
      + \del \cdot \left( \rho \vec{v} \vec{v} \right)
      + \del P_{m}
   =
    \sum_{g} \frac{\sigma^{t}_{g}}{c} \vec{F}^{(0)}_{g}
 }
\label{eq:hydromomentum}
\end{equation}

We can obtain an equation for the material kinetic energy density by
dotting~(\ref{eq:hydromomentum}) with $\vec{v}$, rearranging terms, and
canceling other terms using the continuity equation,
\begin{equation}
     \partl{}{t} \left(\frac{1}{2} \rho v^2\right)
   + \del \cdot \left(\frac{1}{2} \rho v^2 \vec{v} \right)
   + \vec{v} \cdot \del P_{m}
   = \sum_{g} \sigma^{t}_{g} \vec{F}^{(0)}_{g} \cdot \frac{\vec{v}}{c}
\label{eq:hydrokinetic}
\end{equation}

The total energy equation is treated in the same way as the
momentum equation.
We first move the radiation dependent terms of equation~(\ref{eq:totalenergy})
to the right hand side in order to obtain
\begin{equation}
        \partl{}{t}\left( \frac{1}{2} \rho v^2
                          + E_{m}\right)
         + \del \cdot \left[
              \left( \frac{1}{2} \rho v^2 + E_{m} + P_{m} \right) \vec{v}
                      \right]
    =
        - \left[ \partl{E_{r}}{t} + \del \cdot \vec{F} \right]
\label{eq:totalenergy2}
\end{equation}

Integrating equation~(\ref{eq:psi}) over angles, rearranging terms,
and using~(\ref{eq:couple_Te}) with no ion or external source terms,
we obtain,
\begin{eqnarray}
   \partl{E_{r}}{t} + \del \cdot \vec{F}
  &=&
    - \sum_{g} \left[ \sigma^{a}_{g} \phi_{g} - \sigma^{e}_{g} \Bg
    - \langle \xi_{g} \rangle \right]
  \\
  &=& 
    - \left[ C_{ve} \partl{T_{e}}{t} + \sum_{g} \left( \tilde{\xi}_{g} 
             - \langle \xi_{g} \rangle \right) \right]
  \\
  &=& 
    - \left[ C_{ve} \partl{T_{e}}{t}
             + \sum_{g} \sigma^{t}_{g} \vec{F}^{(0)}_{g} \cdot \frac{\vec{v}}{c}
      \right]
\end{eqnarray}
Substituting this result into~(\ref{eq:totalenergy2}) we obtain an equation
for the material total energy density,
\begin{equation}
        \partl{}{t}\left( \frac{1}{2} \rho v^2
                          + E_{m}\right)
         + \del \cdot \left[
              \left( \frac{1}{2} \rho v^2 + E_{m} + P_{m} \right) \vec{v}
                      \right]
    =
         C_{ve} \partl{T_{e}}{t}
            + \sum_{g} \sigma^{t}_{g} \vec{F}^{(0)}_{g} \cdot \frac{\vec{v}}{c} 
\label{eq:hydrototalenergy}
\end{equation}

Subtracting equation~(\ref{eq:hydrokinetic}) from~(\ref{eq:hydrototalenergy})
we obtain an equation for the hydrodynamic internal energy density with
a radiation energy deposition source,
\begin{equation}
  \boxed{
        \partl{E_{m}}{t}
         + \del \cdot \left( E_{m} \vec{v} \right) 
         + P_{m} \del \cdot \vec{v}
    =
         C_{ve} \partl{T_{e}}{t}
  }
\label{eq:hydrointernalenergy}
\end{equation}


\section{Spatial Differencing on Orthogonal Meshes}
\label{ap:spatial}

In this section we will show on spatial differencing scheme for solving
equation~(\ref{eq:Diffusion}), or equivalently
equations~(\ref{eq:phi2})~and~(\ref{eq:Flux2}).
This same differencing can be used to solve
equations~(\ref{eq:conduction_Ti_tdiff})~and~(\ref{eq:conduction_Te_tdiff}).

Consider a cell in the mesh, $c$, with sides of length, $\Delta x^{c}$,
$\Delta y^{c}$, $\Delta z^{c}$, and face areas,
\begin{gather}
        A^{c}_{x} = \Delta y^{c} \Delta z^{c} \\
        A^{c}_{y} = \Delta z^{c} \Delta x^{c} \\
        A^{c}_{z} = \Delta x^{c} \Delta y^{c}
\end{gather}
We will be using the convention that the width of cell, $c$, in the direction
perpendicular to a particular face, $f$, and the area of that face are
denoted
\begin{gather}
        \Delta l^{c}_{f} \quad \text{is one of} \quad \{ \Delta x^{c}, 
                                \Delta y^{c}, \Delta z^{c} \} \\
        A^{c}_{f} \quad \text{is one of} \quad \{ A^{c}_{x},
                                 A^{c}_{y}, A^{c}_{z} \}
\end{gather}

Integrating (\ref{eq:phi2}) over the volume of cell, $c$,
and using Gauss' theorem we obtain
\begin{equation}
        \sum_{f} A^{c}_{f} F^{c}_{f} + V^{c} \bar{\sigma}^{a} \phi^{c}
                = V^{c} \bar{Q}_{r}
\label{eq:Balance}
\end{equation}
where $V^{c}$ is the volume of the cell, $F^{c}_{f}$ is the outward face normal
component of the flux evaluated at face, $f$, and $\phi^{c}$ is the
scalar intensity evaluated at the center of the cell.
The values of
$\bar{\sigma}^{a}$ and $\bar{Q}_{r}$ are also evaluated at the cell center.

\subsection{Flux Continuity}

For interior cell faces, those faces that separate two cells, we use
equation~(\ref{eq:Flux2}) along with flux continuity to help close
equation~(\ref{eq:Balance}).
We label the cell neighboring, $c$, about face, $f$, as cell $c'$, and its
adjoining face as $f'$.
Flux continuity maintains
\begin{equation}
        F^{c}_{f} = - F^{c'}_{f'}
\end{equation}
Using a discreet form of equation~(\ref{eq:Flux2})
\begin{equation}
        F^{c}_{f} = 
        {F'}^{c}_{f} - D^{c}_{f} \frac{(\phi^{c}_{f} - \phi^{c})}
                                      {\frac{1}{2}\Delta l^{c}_{f}}
\label{eq:Flux3}
\end{equation}
we obtain
\begin{equation}
        {F'}^{c}_{f} - D^{c}_{f} \frac{(\phi^{c}_{f} - \phi^{c})}
                                    {\frac{1}{2}\Delta l^{c}_{f}}
    = - {F'}^{c'}_{f'} + D^{c'}_{f'} \frac{(\phi^{c'}_{f'} - \phi^{c'})}
                                        {\frac{1}{2}\Delta l^{c'}_{f'}}
\end{equation}
In the above equations $\phi^{c}_{f}$ and $D^{c}_{f}$
are the scalar intensity and the diffusion constant evaluated
at the cell face.
We must eliminate $\phi^{c}_{f}$ from the equations in order to have a
cell-centered scheme.
We note that at the cell face
\begin{gather}
        {F'}^{c}_{f} \ne - {F'}^{c'}_{f'} \\
        \phi^{c}_{f} = \phi^{c'}_{f'}
\end{gather}
where the first expression denotes that $F'$ need not be continuous across
the cell face.
We may then obtain, after some manipulation,
an expression for $\phi^{c}_{f}$ in terms of cell-centered
quantities
\begin{equation}
        \phi^{c}_{f} =  \frac{\Delta l^{c}_{f} \Delta l^{c'}_{f'}}{2}
                        \left(
                        \frac
                        {  {F'}^{c}_{f} + {F'}^{c'}_{f'}
                        }
                        { D^{c}_{f} \Delta l^{c'}_{f'}
                            + D^{c'}_{f'} \Delta l^{c}_{f}
                        }
                        \right)
                        +
                        \frac
                        { D^{c}_{f} \Delta l^{c'}_{f'} \; \phi^{c} 
                            + D^{c'}_{f'} \Delta l^{c}_{f} \; \phi^{c'} 
                        }
                        { D^{c}_{f} \Delta l^{c'}_{f'}
                            + D^{c'}_{f'} \Delta l^{c}_{f}
                        }
\label{eq:phicf}
\end{equation}

Substituting this into (\ref{eq:Flux3}) we obtain
\begin{equation}
    \boxed{
        F^{c}_{f} = 
        \tilde{F}^{c}_{f} -  \frac{\tilde{D}^{cc'}_{f}}{\Delta l^{c}_{f}}
                             \left( \phi^{c'} - \phi^{c} \right)
    }
\label{eq:Finterior}
\end{equation}
where
\begin{equation}
        \frac{\tilde{D}^{cc'}_{f}}{\Delta l^{c}_{f}}
                    = \frac{
                         2 D^{c}_{f} D^{c'}_{f'} 
                       }
                       {
                           D^{c}_{f}   \Delta l^{c'}_{f'}
                        +  D^{c'}_{f'} \Delta l^{c}_{f}
                       }
\end{equation}
and
\begin{equation}
    \tilde{F}^{c}_{f} = \frac
                        { D^{c'}_{f'} \Delta l^{c}_{f} {F'}^{c}_{f}
                            - D^{c}_{f} \Delta l^{c'}_{f'} {F'}^{c'}_{f'}
                        }
                        { D^{c}_{f} \Delta l^{c'}_{f'}
                            + D^{c'}_{f'} \Delta l^{c}_{f}
                        }
\end{equation}

\subsection{Boundary Conditions}

For cells with boundary faces we will assume boundary conditions of the
form
\begin{gather}
        \alpha \phi^{c}_{f} + \beta F^{c}_{f} = \bfunc
  \\
        \phi^{c}_{f} = \frac{1}{\alpha} \left( \bfunc - \beta F^{c}_{f} \right)
\label{eq:phicf_bc}
\end{gather}
For Dirichlet boundary conditions we set $\alpha=1$ and $\beta=0$.
For Neumann boundary conditions we set $\alpha=0$ and $\beta=1$,
 with the special
case of reflective boundary conditions, where we set $\bfunc = 0$.
For Marshak boundary conditions we set $\alpha=1/4$, $\beta=-1/2$, and
$\bfunc = F^{\text{in}}$.

By applying the same steps of substituting for $\phi^{c}_{f}$ into
(\ref{eq:Flux3})
we arrive at an expression for the outward normal component of the flux
\begin{equation}
   \boxed{
        F^{c}_{f} = \left( \alpha - \frac{2 \beta D^{c}_{f}}{\Delta l^{c}_{f}}
                    \right)^{-1}
                    \left[ \alpha {F'}^{c}_{f} - \frac{2 D^{c}_{f}}{\Delta l^{c}_{f}}
                                                \left(\bfunc - \alpha \phi^{c}\right)
                    \right]
   }
\label{eq:Fboundary}
\end{equation}

\subsection{Linear System}

We can create a linear system of equations over all of the cells, each of 
which is obtained by substituting (\ref{eq:Finterior}) and (\ref{eq:Fboundary})
into (\ref{eq:Balance})
\begin{multline}
        \sum_{f \in \{\text{interior faces}\}}
        A^{c}_{f} \left[
           \tilde{F}^{c}_{f} -  \frac{\tilde{D}^{cc'}_{f}}{\Delta l^{c}_{f}}
                                \left( \phi^{c'} - \phi^{c} \right)
        \right]
   \\
   +
        \sum_{f \in \{\text{boundary faces}\}}
        A^{c}_{f} \left[
                    \left( \alpha - \frac{2 \beta D^{c}_{f}}{\Delta l^{c}_{f}}
                    \right)^{-1}
                    \left[ \alpha {F'}^{c}_{f} - \frac{2 D^{c}_{f}}{\Delta l^{c}_{f}}
                                                \left(\bfunc - \alpha \phi^{c}\right)
                    \right]
        \right]
   \\
   \mbox{} +
         V^{c} \bar{\sigma}^{a} \phi^{c}
                = V^{c} \bar{Q}_{r}
\end{multline}

This equation may be written more succinctly by defining
\begin{equation}
  \boxed{
        \hat{D}^{c}_{f}
               = \left\{
                     \begin{array}{ll}
                        \tilde{D}^{cc'}_{f}
                        & \text{for interior faces} \\
                        2\alpha D^{c}_{f}
                           \left( \alpha - \frac{2 \beta D^{c}_{f}}{\Delta l^{c}_{f}}
                           \right)^{-1}
                        & \text{for boundary faces}
                     \end{array}
                    \right.
   }
\end{equation}
\begin{equation}
   \boxed{
        \hat{F}^{c}_{f}
             =  \left\{
                     \begin{array}{ll}
                        \tilde{F}^{c}_{f}
                        & \text{for interior faces} \\
                           \left( \alpha - \frac{2 \beta D^{c}_{f}}{\Delta l^{c}_{f}}
                           \right)^{-1}
                        \left[ \alpha {F'}^{c}_{f}
                                 - \frac{2 D^{c}_{f}}{\Delta l^{c}_{f}} \bfunc
                        \right]
                        & \text{for boundary faces}
                     \end{array}
                    \right.
  }
\end{equation}
as
\begin{equation}
        \sum_{f} A^{c}_{f}
             \left[
                 \hat{F}^{c}_{f}
                         + \frac{\hat{D}^{c}_{f}}{\Delta l^{c}_{f}}  \phi^{c}
             \right]
        - \sum_{f \in \{\text{i.\ f.}\}}
                A^{c}_{f} \frac{\hat{D}^{c}_{f}}{\Delta l^{c}_{f}} \phi^{c'}
        + V^{c} \bar{\sigma}^{a} \phi^{c}
                = V^{c} \bar{Q}_{r}
\end{equation}

This may be converted into a matrix equation
\begin{equation}
        \mathcal{A} \boldsymbol{\phi} = \mathbf{b}
\end{equation}
with
\begin{equation}
   \boxed{
        \mathcal{A}_{cc} = V^{c} \bar{\sigma}^{a} \;
                + \sum_{f}
                        \frac{A^{c}_{f} \hat{D}^{c}_{f}}{\Delta l^{c}_{f}}
   }
\end{equation}
\begin{equation}
   \boxed{
        \mathcal{A}_{cc'} =
                 - \frac{A^{c}_{f} \hat{D}^{c}_{f}}{\Delta l^{c}_{f}}
   }
\label{eq:Accp}
\end{equation}
and
\begin{equation}
   \boxed{
        \mathbf{b}_{c} = V^{c} \bar{Q}_{r} \;
                - \sum_{f} A^{c}_{f} \hat{F}^{c}_{f}
   }
\end{equation}

If one closely examines (\ref{eq:Accp}) one notices that the resulting
matrix is symmetric.  Showing that the matrix is positive-definite is
an exercise left up to the reader.

After this matrix equation is solved for the $\phi^{c}$ we may substitute
back into equations~(\ref{eq:Finterior}) and~(\ref{eq:Fboundary})
to obtain the new values for $F^{c}_{f}$.

\section{Spatial Centering of Data}

\subsection{Discretization Scheme-Independent Centering}

This section discusses some of the issues involved with the spatial
centering of field variables.
Since this document is mostly concerned with the spatial differencing of
Appendix~\ref{ap:spatial} we discuss spatial centering of data using
this spatial differencing scheme as a basis.

To facilitate the discussion of centering we shall introduce a distinction
between node-centered data and vertex-centered data.
A vertex of a given cell
is defined as that location assigned to the volume associated with
a node that is contained wholly within that cell.
This vertex may be thought of as co-located with the given node, but
whereas there is one node-centered field
value associated with the location of a node, there are as
many vertex-centered values associated with the same location as
there are cells surrounding that point.
A vertex is designated by both a cell index, $c$, and a designation
for the vertex (node) of the cell, $v$; therefore, a node-centered field value
would be referred to as $a_{n}$, and a vertex-centered field value
would be referred to as $b^{c}_{v}$.

Without the velocity correction terms (and momentum deposition output)
the spatial centering of the data is chosen in a natural fashion.
The temperature and radiation intensity fields are cell-centered,
along with all other material properties, such as cross-sections.
These material properties will be calculated based on the temperature
and densities of the material.
Cell-centered temperatures and densities lead naturally to cell-centered
material properties.
Radiation fluxes are represented by continuous face-centered scalar fields,
where each face value represents the flux dotted into the face's normal
vector.
In this centering the face-centered diffusion coefficients would be constant
within a cell, i.e. cell-centered quantities.
This centering of data is completely consistent with the
corresponding differencing of the diffusion and temperature equations,
in the absence of the velocity correction terms.

Even without considering the velocity correction terms there is a problem
with the centering scheme as just described.
It has been determined through practice that Marshak waves will not propagate
correctly with cell-centered diffusion coefficients.
This can be seen when considering two adjoining cells,
one with a small diffusion
coefficient, and one with a large diffusion coefficient.
If the radiation wave is propagating from the small diffusion coefficient
material to the high diffusion coefficient material it can be shown
that the wave will not propagate into the second material, and the
wave will be stopped.
In order to prevent this behavior a discontinuous face-centered diffusion
coefficient is computed using an average of the temperatures on either
side of the face, along with the cell-centered density value.
In other words the value of the diffusion coefficient is calculated as
\begin{gather}
        T_{f} = \operatorname{avg} ( T^{c}, T^{c'} ) \\
        D^{c}_{f} = D ( T_{f}, \rho^{c} )
\label{eq:faceD}
\end{gather}
where the $\operatorname{avg}$ operator can be as simple as the arithmetic
average, or more likely, an interpolation of the temperature onto the
face.
Other discontinuous face-centered material properties may be calculated,
as needed,
by means similar to~(\ref{eq:faceD}).

As anticipated,
additional complications arise from consideration of the velocity correction
terms, $\tilde{\xi}$, $\langle \xi \rangle$, $\langle \hat{\Omega} \xi \rangle$,
and the momentum deposition output, $\sigma^{t} \vec{F}^{(0)} / c$.
The terms, $\tilde{\xi}$ and $\langle \xi \rangle$, both require
the evaluation of $\sigma \vec{F}^{(0)} \cdot \vec{v} / c$ at the
cell centers.%
\footnote{The $\sigma$ represents any of $\sigma^{a}$, $\sigma^{s}$, or
$\sigma^{t}$.}
The $\langle \hat{\Omega} \xi \rangle$ term requires the evaluation
of $\sigma \vec{F}^{(0)} \cdot \vec{v} / c$ at the cell faces.
The momentum deposition output requires the evaluation of
$\sigma \vec{F}^{(0)} / c$ at the mesh nodes.


These terms all involve the Lagrangian frame radiation flux,
\begin{equation}
        \vec{F}^{(0)} = \vec{F} - \frac{4}{3} \phi \frac{\vec{v}}{c}
\end{equation}
We treat the centering of this variable on the cell faces, wherein the normal
components of $\vec{F}^{(0)}$ are required.
This leads to the following continuous face-centered field%
\footnote{%
   Continuous as well as discontinuous
   face-centered vector field normals require a $c$ superscript
   since the face normal vectors are defined to be outwardly directed from
   cell $c$.
   The $c$ superscript on $\phi^{c}_{f}$ is superfluous, and is used
   for agreement with equations~(\ref{eq:phicf})~and~(\ref{eq:phicf_bc}).
}
\begin{equation}
  \boxed{
        F^{c(0)}_{f} = F^{c}_{f} - \frac{4}{3} \phi^{c}_{f} \frac{v^{c}_{f}}{c}
  }
\end{equation}
where $\phi^{c}_{f}$ must be interpolated to the cell faces
via equations~(\ref{eq:phicf})~and~(\ref{eq:phicf_bc}),
\begin{gather}
   \boxed{
        \phi^{c}_{f} =  \frac
                        { D^{c}_{f} \Delta l^{c'}_{f'} \; \phi^{c} 
                            + D^{c'}_{f'} \Delta l^{c}_{f} \; \phi^{c'} 
                        }
                        { D^{c}_{f} \Delta l^{c'}_{f'}
                            + D^{c'}_{f'} \Delta l^{c}_{f}
                        }
   } \\
   \boxed{
        \phi^{c}_{f} = \frac{1}{\alpha} \left( \bfunc - \beta F^{c}_{f} \right)
   }
\end{gather}
repeated here.

At this point it is evident that the centering of the velocity terms
becomes important.
We are assuming that velocities will be given on the nodes of the mesh.
This also implies that momentum deposition output will be required on
the nodes of the mesh, as well.
With this assumption we can approximate the value of $v^{c}_{f}$
on the cell face as
\begin{equation}
  \boxed{
     v^{c}_{f} = \frac{1}{2^{d-1}} \sum_{n} \vec{v}_{n} \cdot \hat{n}^{c}_{f}
  }
\end{equation}
where $d$ is the number of dimensions of the mesh,
$\hat{n}^{c}_{f}$ is the outward normal of the face,
$\vec{v}_{n}$ is the velocity at node $n$,
and the sum is over all nodes contained by the face.

From conservation of energy we require that
\begin{equation}
  \int \! \left( \tilde{\xi} - \langle \xi \rangle \right) \; dV
        = \int \frac{d\vec{p}}{dt} \cdot \vec{v} \; dV
\end{equation}
where $d\vec{p}/dt$ is the momentum deposition source of
equation~(\ref{eq:hydromomentum}),
and the integral is over the total volume of the problem.
The discreet form of this requirement is
\begin{eqnarray}
  \sum_{\text{cells}}
     \left[ \tilde{\xi} - \langle \xi \rangle \right]_{c} V^{c} 
  &=& \sum_{\text{nodes}}
     \left[ \frac{d\vec{p}}{dt} \cdot \vec{v} \right]_{n} V_{n} \\
   \sum_{\text{cells}}
      \left[ \sigma^{t} \vec{F}^{(0)} \cdot \frac{\vec{v}}{c} \right]_{c} V^{c}
  &=& \sum_{\text{nodes}}
      \left[ \sigma^{t} \vec{F}^{(0)} \cdot \frac{\vec{v}}{c} \right]_{n} V_{n}
\label{eq:discEnergy}
\end{eqnarray}
In the above equations $V^{c}$ is the volume of cell $c$, and
$V_{n}$ is the volume associated with node $n$.

Both the left and right hand side of~(\ref{eq:discEnergy}) may
be specified in terms of vertex-centered dot products.
The cell-centered value from the
left hand side of~(\ref{eq:discEnergy}) is specified as a
volume weighted sum of vertex-centered quantities
\begin{eqnarray}
  \sum_{\text{cells}}
      \left[ \sigma^{t} \vec{F}^{(0)} \cdot \frac{\vec{v}}{c} \right]_{c} V^{c}
  &=& \sum_{\text{cells}} 
      \sum_{\text{vertices} \in c} \! V^{c}_{v}
       \left[ \sigma^{t} \vec{F}^{(0)} \cdot \frac{\vec{v}}{c}
        \right]_{c,v} \\
  &=& \sum_{c} \left( 
      \sum_{v \in c} \! \frac{V^{c}_{v}}{V^{c}}
       \left[ \sigma^{t} \vec{F}^{(0)} \cdot \frac{\vec{v}}{c}
        \right]_{c,v} \right) V^{c} \\
  &=& \sum_{c} \left( \sum_{ v \in c} \frac{V^{c}_{v}}{V^{c}}
        \bracket{\sigma^{t} \vec{F}^{(0)}}
                {\mathcal{S}^{c}_{v}}{\frac{\vec{v}}{c}} \right) V^{c}
\end{eqnarray}
where $V^{c}_{v}$ is the volume associated with the cell's $v$'th vertex,
$\mathcal{S}^{c}_{v}$ is an operator that computes the dot-product
of a face-centered vector field with a node-centered vector field at
a specified vertex.
This leads to an expression for the cell-centered quantities required
by $\tilde{\xi}$ and $\langle \xi \rangle$
\begin{equation}
\boxed{
  \left[ \sigma \vec{F}^{(0)} \cdot \frac{\vec{v}}{c} \right]_{c}
    = \bracket{\sigma \vec{F}^{(0)}}{\mathcal{S}^{c}}{\frac{\vec{v}}{c}}
}
\end{equation}
where $\mathcal{S}^{c}$ is an operator that computes the dot-product
of a face-centered vector field with a node-centered vector field at
a specified cell,
\begin{equation}
 \boxed{
   \mathcal{S}^{c} = \sum_{v \in c} \frac{V^{c}_{v}}{V^{c}}\mathcal{S}^{c}_{v}
 }
\end{equation}
The exact specification of $\mathcal{S}^{c}_{v}$ is dependent on the spatial
differencing scheme, and will be discussed below.

The right hand side of~(\ref{eq:discEnergy}) is specified as 
the same
volume weighted sum of vertex-centered quantities
\begin{eqnarray}
\sum_{\text{nodes}}
      \left[ \sigma^{t} \vec{F}^{(0)} \cdot \frac{\vec{v}}{c} \right]_{n} V_{n}
  &=& \sum_{\text{cells}} 
      \sum_{\text{vertices} \in c} \! V^{c}_{v}
       \left[ \sigma^{t} \vec{F}^{(0)} \cdot \frac{\vec{v}}{c}
        \right]_{c,v} \\
  &=& \sum_{n} 
      \sum_{v,c \;\text{around}\; n} \! V^{c}_{v}
       \left[ \sigma^{t} \vec{F}^{(0)} \cdot \frac{\vec{v}}{c}
        \right]_{c,v} \\
  &=& \sum_{n} \left( 
      \sum_{v,c \in n} \! \frac{V^{c}_{v}}{V^{n}}
       \left[ \sigma^{t} \vec{F}^{(0)} \cdot \frac{\vec{v}}{c}
        \right]_{c,v} \right) V^{n} \\
  &=& \sum_{n} \left( \sum_{ v,c \in n} \frac{V^{c}_{v}}{V^{n}}
        \bracket{\sigma^{t} \vec{F}^{(0)}}
                {\mathcal{S}^{c}_{v}}{\frac{\vec{v}}{c}} \right) V^{n}
\end{eqnarray}
This leads to an expression for the node-centered quantity
\begin{equation}
\boxed{
  \left[ \sigma^{t} \vec{F}^{(0)} \cdot \frac{\vec{v}}{c} \right]_{n}
    = \bracket{\sigma^{t} \vec{F}^{(0)}}{\mathcal{S}^{n}}{\frac{\vec{v}}{c}}
}
\end{equation}
where $\mathcal{S}_{n}$ is an operator that computes the dot-product
of a face-centered vector field with a node-centered vector field at
a specified node,
\begin{equation}
 \boxed{
   \mathcal{S}^{n} = \sum_{ v,c \; \text{around} \; n}
                        \frac{V^{c}_{v}}{V^{n}}\mathcal{S}^{c}_{v}
 }
\label{eq:S_n}
\end{equation}

It is the momentum deposition centering that
is actually required, which in turn requires
the specification of $\sigma^{t} \vec{F}^{(0)} / c$ at the nodes in
a way that
is consistent with~(\ref{eq:S_n}),
\begin{eqnarray}
   \bracket{\sigma^{t} \vec{F}^{(0)}}
                       {\mathcal{S}_{n}}
                       {\frac{\vec{v}}{c}} V^{n}
  &=&  \bracket{\sigma^{t} \vec{F}^{(0)}}
                       {\mathcal{S}_{n}}
                       {\sum_{i=1}^{d} \frac{v_{i}\hat{e}_{i}}{c}} V^{n}
   \\
  &=&  \sum_{i=1}^{d} \bracket{\sigma^{t} \frac{\vec{F}^{(0)}}{c}}
                       {\mathcal{S}_{n}}
                       {\hat{e}_{i}}v_{i} \; V^{n}
   \\
  &=&  \sum_{i=1}^{d} \bracket{\sigma^{t} \frac{\vec{F}^{(0)}}{c}}
                       {\mathcal{S}_{n}}
                       {\hat{e}_{i}} \hat{e}_{i} \cdot \vec{v}_{n}
                         \; V^{n}
\end{eqnarray}
therefore,
\begin{equation}
 \boxed{
\left[ \sigma^{t} \frac{\vec{F}^{(0)}}{c} \right]_{n}
    = \sum_{i=1}^{d} \bracket{\sigma^{t} \frac{\vec{F}^{(0)}}{c}}
                       {\mathcal{S}_{n}}
                       {\hat{e}_{i}} \hat{e}_{i}
}
\end{equation}
is the node-centered momentum deposition.

\subsection{Discretization Scheme-Dependent
            Specification of $\mathcal{S}^{c}_{v}$}

The general expression for $\mathcal{S}^{c}_{v}$ allows for discretization
schemes that use face-centered vector fields, e.g.\ the Morel-Shashkov-Roberts
method\cite{MorelShashkov}
 on non-orthogonal unstructured quadrilaterals and hexahedra.

Since the discretization scheme presented in appendix~\ref{ap:spatial} deals
with orthogonal meshes with face normals along coordinate axes we obtain
a simple expression for the operator $\mathcal{S}^{c}_{v}$ acting between
a face-centered vector field, $\vec{F}$, represented by $F_{f}$ the face normal
components, and a node-center vector field, $\vec{v}$, that is completely
specified at the nodes,
\begin{equation}
 \boxed{
   \bracket{\vec{F}}{\mathcal{S}^{c}_{v}}{\vec{v}} =
       \sum_{\text{faces at vertex}} \!\!\!\!\!\!\!\!\!\! F_{f} v_{f}
 }
\end{equation}
where the $f$ index is synonymous with the axes directions.

\bibliographystyle{plain}
\bibliography{radTransfer}

\end{document}
