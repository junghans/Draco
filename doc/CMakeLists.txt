#-----------------------------*-cmake-*----------------------------------------#
# file   doc/CMakeLists.txt
# author Kelly Thompson <kgt@lanl.gov>
# date   2011 July 20
# brief  Instructions for building doc level Makefile.
# note   Copyright (C) 2011-2012 Los Alamos National Security, LLC.
#        All rights reserved.
#------------------------------------------------------------------------------#
# $Id$
#------------------------------------------------------------------------------#

cmake_minimum_required( VERSION 2.8 FATAL_ERROR )
project( draco_doc_dir )

# helper macros

# if( NOT "${CMAKE_MODULE_PATH}" MATCHES "config" )
#    set( CMAKE_MODULE_PATH ${PROJECT_SOURCE_DIR}/../config )
# endif()
# include( doc_macros )
# set( allpdfs "" CACHE INTERNAL "list of all pdfs to be generated" )

# # Helper macro that only tries to configure a listed package if it
# # exists in the source tree.  For example, when building milagro, the
# # get_draco script only checks out the parts of Draco that are
# # required by milagro.
# macro( add_dir_if_exists package )
#    if( EXISTS ${PROJECT_SOURCE_DIR}/${package} )
#       add_subdirectory( ${package} )
#    endif()
# endmacro()

# # Add directories
# add_dir_if_exists( releases )

# # create target for building all documents
# add_custom_target( docs
#    DEPENDS ${allpdfs} # allpdfs is a list generated by doc_macros::add_latex_doc
#    )

# create a target for installing docs?
# add_custom_target( installdocs
#   DEPENDS docs
#   COMMAND <run a cmake script to find all pdfs and copy them to
#            installdir>
# )

# Process each directory as an independent cmake project.

set( docdirs
   build matprops mesh purify release releases 
   reorganization_VisScope system )
unset( all_doc_targets )

foreach( docdir ${docdirs} )
   file( MAKE_DIRECTORY ${PROJECT_BINARY_DIR}/${docdir} )
   # Configure doc dirs during cmake/configure.
   execute_process(
      COMMAND           ${CMAKE_COMMAND} ${PROJECT_SOURCE_DIR}/${docdir}
      WORKING_DIRECTORY ${PROJECT_BINARY_DIR}/${docdir}
      OUTPUT_QUIET
      ERROR_QUIET
      )
   
   # Create a custom target for the 'doc' directory to generate pdfs
   # for each subdir. (avoid target name conflicts by using prefix)
   add_custom_target( doc-${docdir} 
      # use default target per dir (usually pdf)
      COMMAND           ${CMAKE_MAKE_PROGRAM} 
      WORKING_DIRECTORY ${PROJECT_BINARY_DIR}/${docdir}
      )

   # create a list of targets that can be used for the 'build-all'
   # documents target.
   list(APPEND all_doc_targets doc-${docdir} )
endforeach()

# A 'build-all' documents target
add_custom_target( alldocs DEPENDS ${all_doc_targets} )

##---------------------------------------------------------------------------##
## End of doc/CMakeLists.txt
##---------------------------------------------------------------------------##
