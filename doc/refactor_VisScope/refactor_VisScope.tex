%%---------------------------------------------------------------------------%%
%% refactor_VisScope.tex
%% Mike Buksas
%% Time-stamp: <02/07/29 19:03:54 tmonster>
%%---------------------------------------------------------------------------%%
%%
%% Project Vision Statement
%% ------------------------
%% A vision statement explains the project in terms of an end result.
%% It clarifies where the project is going by answering the questions
%%      -What?
%%      -Why?
%%      -How will we know the project is a success?
%%
%% Project Scope Statement
%% -----------------------
%% A scope statement describes how a project will achieve its end
%% result given limited resources.  It sets a project's boundaries by
%% defining the balance between resources, constraints, and
%% deliverables. 
%%
%% Critical Success Factors
%% ------------------------
%% What has to happen for success?  What cannot happen?
%%
%% Risk Assessment
%% ---------------
%% What is the probability of the occurence of each identified risk?
%% What is the impact if it happens?  
%%
%%
%%      ---used with permission and adapted from David A. Schmaltz's 
%%         ``Mastering Projects Workshop: Participant Guide,'' 
%%         True North pgs, Inc., P.O. Box 1532,  Walla Walla, WA 99362, 
%%         projectcommunity.com, Rev. 6, August 2001, copyright.
%%
%%
%% Project Tracking
%% ----------------
%% Track actual results and performance with plans. 
%% 
%%    -Did you change the vision or scope of your project?
%%    -How well did you identify critical success factors?
%%    -What risks did your project realize? ...
%%    -How well were you able to estimate delivery dates?
%%    -What corrective action was taken?
%%    -What lessons have you learned?
%%  
%% The addition of project tracking to the vision and scope statement
%% makes it a living document that is revisited at the completion of
%% the project and whenever risks are realized or vision and scope
%% change. 
%%
%%      ---project tracking section adapted from a LANL ASC Internal 
%%         Assessment of the Jayenne Code Project (CCS-4) by Vicki
%%         Clark and Barbara Hoffbauer (CCN-12).  July 22, 2003. 
%%
%%
%%---------------------------------------------------------------------------%%
\documentclass[11pt]{nmemo}
\usepackage[centertags]{amsmath}
\usepackage{amssymb,amsthm,graphicx}
\usepackage[mathcal]{euscript}
\usepackage{tmadd,tmath}
\usepackage{cite}
\usepackage{latexmake}

%%---------------------------------------------------------------------------%%
%% DEFINE SPECIFIC ENVIRONMENTS HERE
%%---------------------------------------------------------------------------%%
%\newcommand{\elfit}{\ensuremath{\operatorname{Im}(-1/\epsilon(\vq,\omega)}}
%\msection{}-->section commands
%\tradem{}  -->add TM subscript to entry
%\ucatm{}   -->add trademark footnote about entry

%%---------------------------------------------------------------------------%%
%% BEGIN DOCUMENT
%%---------------------------------------------------------------------------%%
\begin{document}

%%---------------------------------------------------------------------------%%
%% OPTIONS FOR NOTE
%%---------------------------------------------------------------------------%%

\toms{Distribution}
%\toms{Joe Sixpak/XTM, MS B226}
\refno{CCS-4:04-13(U)}
\subject{Vision and Scope Statements for Project Camel Norton}

%-------NO CHANGES
\divisionname{Computer and Computational Sciences}
\groupname{CCS-4:Transport Methods Group}
\fromms{Mike Buksas/CCS-4, MS D409}
\phone{(505)667--7580}
\originator{fml}
\typist{fml}
\date{\today}
%-------NO CHANGES

%-------OPTIONS
%\reference{NPB Star Reimbursable Project}
%\thru{P. D. Soran, XTM, MS B226}
%\enc{list}      
%\attachments{list}
%\cy{list}
%\encas
%\attachmentas
%\attachmentsas 
%-------OPTIONS

%%---------------------------------------------------------------------------%%
%% DISTRIBUTION LIST
%%---------------------------------------------------------------------------%%

\distribution {
  M.W. Buksas, CCS-4, D-409 \\
  J.D. Densmore, CCS-4, D-409 \\
  T.M. Evans, CCS-4, D-409 \\
  T.J. Urbatsch, CCS-4, D-409 \\
  CCS-4 Files.
}

%%---------------------------------------------------------------------------%%
%% BEGIN VISION STATEMENT
%%---------------------------------------------------------------------------%%

\opening

\section*{Vision Statement}

Project Camel Norton\footnote{The name is an anagram of {\em Monte
    Carlo}, if you must know.} will produce improved code in the Draco
{\tt mc} and {\tt imc} components. Time permitting, it will also
extend to the interaface components within Milagro. Within {\tt imc},
we seek to reduce the amount of duplicated code in the Particle class
heirachy and simplify the execution of the transport algorithm. This
is the highest priority of this project. In the {\tt mc} component the
goal is to improve the topology class to reduce the amount of data it
contains and make the extent of it's data more clear.  This is the
second priority of this project.  Within Milagro, we seek to eliminate
the redundancies in the interface code and the global tally. This is
the third priority of this project.

For the remainder of this document, we refer to these as the
particle-transport subproject, the topology subproject and the milagro
interface subproject.

This project is being undertaken to simplify the addition of new
features and ease maintenance of the code. The next area to be
affected by new features is the particle transport algorithm.  This
code is already in a difficult to maintain state because of the recent
addition of new features. The ease by which specific features can be
added after the refactoring is comlete will be our criteria for the
success of this stage of the project. 

Detailed plans for the particle transport phase have been documented
in~\cite{ccs-4:04-14}.

\newpage
\section*{Scope Statement}

%%
%% Include those of the following elements that apply to your project
%%

\subsection*{Product of the Project}

The product of Project Camel Norton will be the replacement of
existing code while preserving functionality. {\em No new capabilities
  will be added as part of this project.}

In this document, we need to make a distinction between the {\em
  particle transport algorithm} and the {\em transport algorithm}.
Particle transport refers to the sequence of actions taken on a single
particle from the point at which it is created until it is
communicated, killed or goes into census at the end of the time step.
This is currently implemented in {\tt draco/imc} by the various
particle classes transport member functions.  

The {\em transport algorithm} (without particle) refers to the
asynchrous parallel implementation of multiple particle transport
processes and their coordination through parallel communication and
the global particle count. This this implemented in {\tt draco/imc} by
the {\tt DD\_Transporter} and {\tt Rep\_Transporter} classes.

For the particle transport algorithm in {\tt draco/imc} the
modifications to the code will likely result in the creation of new
classes and the removal of functionality from the Particle heriachy of
classes. We will use the design in Uncle McFlux as a model, where the
Particle class and the Particle transport algorithm are seperated.

The need for refactored code is be based on the anticipation of
several new features: DDIMC, Three dimensional computations, Material
Motion and Compton Scattering. Our goal is code which will support the
addition of these features with minimum of effort.

The {\tt General\_Topology} class in {\tt draco/mc} supportes a very
general range of cell to domain mappings, including full replication
and fully decomposed meshes. The class, however, does not make a
distinction between topologies which contain information about the
global mesh or which only contain information about cells which are
neighbors of the local mesh. We seek to improve the topology class to
make this distinction more explicit.

While working in the {\tt imc} component, it may also prove benifical
to import classes from Uncle McFlux which provide useful services. For
example the {\tt DD\_Transporter} and {\tt Rep\_Transporter} classes
which implement the asynchrous transport algorithm are also
responsible for the global count of completed particles. In Uncle
McFlux this responsibility is given to a seperate class {\tt
  Asynchrous\_Counter}. 

The Milagro interface has accquired some unusual features which make
it ripe for refactoring. Principal among these are:

\begin{itemize}
\item {\tt Global\_Tally} both {\em is an} interface and {\em uses} an
  interface in its construction. This is awkward and obscures the
  intended useage of the class.

\item The {\tt Global\_Tally} is {\em indiscriminate} in the type of the
interface it will accept via a template argument. This is contrary to
the very purpose of using abstract interfaces.

\item The {\tt Global\_Tally} class is poorly named, since it holds much
more than tallies.

\item The {\tt Interface} and {\tt Global\_Tally} both have large
  interfaces to implement which are the union of interfaces required
  by other objects. This strongly suggests that the data they contain
  cound be better encapsulated. To do this, the interface class could
  inherit from implementations of it's component interfaces, reducing
  the amount of implementation which must be one in one large class.

\end{itemize}

\subsection*{Graphical Representation}

See Figure~\ref{fig:norton}.

\begin{figure}[h]
  \begin{center}
    \includegraphics[width=1in]{figures/camel.eps}
    \caption{Norton}
    \label{fig:norton}
  \end{center}
\end{figure}

\subsection*{Quality of the Product}

The quality of the new code will be measured informally in terms of
the abstract entities known as {\em code smells}. See~\cite[Chapter
3]{fowler00} for the comprehensive list of smells. An examination of
the code of the Particle classes reveals the following bad smells:
{\em Duplicated Code, Long Method}, and {\em Large Class}.  Based on
the anticipation of new features, we also conclude that the Particle
class suffers from {\em Divergent Change}, that is, it has too many
reasons to change with the addition of new features. 

The changes in the topology class should make the purpose of the
resulting classes easier to understand. The classes should have
greater {\em intention} and be more self-documenting.

Based on the experience of integrating the Surface Tracking
functionality into Wedgehog we also accuse the broader draco library
structure of suffering from {\em Shotgun Surgery}, that is, a new
feature prompted changes in multiple, widely seperated, parts of the
code. This feature was perhaps especially difficult in this regard. We
should be on the lookout for ways to minimize the disruptive impact of
similarly cross-cutting features.

\newpage
\section*{Critical Success Factors}

For the particle-transport subproject to be considered a success, we
must be able to recuperate some of the time spent refactoring
(including planning, design and implementation) in time spent adding
new features. Refactoring is strictly a software development issue but
acquires a dilemma-like character becasue it's goal is diffucilt to
quantify and can only be attempted after the project is complete.

To deal with this dilemma, we can consider incorporating the addition
of a selected feature into a broader project, thereby expanding the
scope to include one cycle of ``refactor, then implement''. The
relative ease of the implementation phase can be used to judge the
success of the project.

%\begin{table}[ht]
%  \caption{Critical Success Factor Actions.}
%    \begin{enumerate}
%    \item Resolve it now.
%    \item Factor into Plan.
%    \item Change Vision/Scope.
%    \item Other.
%    \end{enumerate}
%\end{table}

\begin{table}[ht]
  \begin{center}
    \caption{Critical success factors for Project Camel Norton.}
    \label{tab:critical-success}
    \begin{tabular}{|p{4.5cm}|c|c|p{4.5cm}|} 
    \hline
    Factor             &  Character   & Strategy & Comments \\ 
    \hline\hline
    Refactor must pay-off in development time.
    & Dilemma & Factor into Plan 
    & Consider including a feature implementation step. Keep
    refactoring and implemention stages seperate. \\ 
                                %
    \hline
    \end{tabular}
  \end{center}
\end{table}


\newpage
\section*{Risk Assessment}

One risk of refactoring involves keeping the scope of the refactor
limited to areas where the payoff in terms of maintenance is the
greatest. (The author of this document has been known to succumb to
refactor-mania on occasion.)

The topology subproject must be evaluated in a similar fashion. It may
be undertaken as the same time as the particle-transport refactor if
it is deemed useful in implementing new features. If it appears to
remain independent, it will be postponed and evaluated seperately.

The Milagro-interface subproject can also be evaluated by its
facilitation of new features. We can also examine it for code smells,
especially code duplication.

\begin{table}[ht]
  \begin{center}
    \caption{Risk Assessment for Project Camel Norton.}
    \label{tab:risk}
    \begin{tabular}{|p{4.5cm}|c|c|c|p{4.5cm}|} 
    \hline
    Risk & Likelihood & Impact & Importance & Contingency \\ 
    \hline\hline
                                %
    Refactored code is too fragmented or ``clever'' to be easily understood.
    & 5 & 8 & 40 &
    Consider re-consolidation for clairty. Make sure design choices are
    well documented. 
    \\ \hline
                                %
    Too difficult to seperate concerns without a complete redesign
    & 5 & 7 & 35 & Evaluate merit of a redesign with understanding of
    its considerable cost. \\ \hline
                                %
    Refactored code is significantly slower & 3 & 9 & 27 &
    Add an optimization refactor step when new features are
    implemented. 
    \\ \hline
                                %
    Too difficult to tell if refactoring is useful & 6 & 3 & 18 &
    Add an implementation step. Refactor on design sensibilities alone.
    \\ \hline
                                % 
    Refactor planning leads to ``paralysis by analysis'' & 
    3 & 5 & 15 &
    Enforce a strict deadline for stopping planning phase and
    beginning development. Continue planning and design with
    development. 
    \\ \hline
                                % 
    Refactor scope spreads too far & 4 & 3 & 12 &
    Evaluate additional refactoring targets on merits. Adjust or
    enforce scope as needed. 
    \\ \hline
    \end{tabular}
  \end{center}
\end{table}

\newpage
\newpage
\section*{Project Tracking}

\subsection*{Change log:}

\begin{description}
\item[2/27/04] Initial version submitted for review.

\item[3/5/04] Changed some values in the risk analysis as per
  suggestions from Todd. ``Excessively Clever'' code is now the number
  one risk.

  Changed ``Critical Success Factors'' section to make the table more
  succinct. I'm looking for a more consise way to express this
  information than the template supports.
  
  Added a new risk about difficulty of seperating concerns and the
  tempation to redeisgn instead of refactor. This is apropos to the
  apparent diffuculty of seperating random walk into a seperate
  component within the particle transprort algorithm.

\end{description}

%Track actual results and performance with plans.
%
%   Did you change the vision or scope of your project? 
%   
%   How well did you identify critical success factors?  What lessons
%   have you learned?
% 
%   What risks did your project realize?  How well did you estimate the
%   likelihood and impact of the realized risks?  Did you encounter
%   unforseen risks?  What lessons have you learned?
% 
%   How well were you able to estimate delivery dates?  What lessons
%   have you learned?
%
%   What corrective action was taken?
%   
%   How will you improve the vision and scope statements for future
%   projects?

\newpage
\bibliography{cs,jayenne_ref}
\bibliographystyle{plain}

\closing
\end{document}

%%---------------------------------------------------------------------------%%
%% end of refactor_VisScope.tex
%%---------------------------------------------------------------------------%%

