<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<!--Converted with LaTeX2HTML 98.1p1 release (March 2nd, 1998)
originally by Nikos Drakos (nikos@cbl.leeds.ac.uk), CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>The Problem</TITLE>
<META NAME="description" CONTENT="The Problem">
<META NAME="keywords" CONTENT="cip">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<LINK REL="STYLESHEET" HREF="cip.css">
<LINK REL="next" HREF="node3.html">
<LINK REL="previous" HREF="node1.html">
<LINK REL="up" HREF="cip.html">
<LINK REL="next" HREF="node3.html">
</HEAD>
<BODY >

<A NAME="tex2html40"
 HREF="node3.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html38"
 HREF="cip.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html32"
 HREF="node1.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A>   <BR>
<B> Next:</B> <A NAME="tex2html41"
 HREF="node3.html">Modern C++ Culture</A>
<B>Up:</B> <A NAME="tex2html39"
 HREF="cip.html">Container-Free Numerical Algorithms in</A>
<B> Previous:</B> <A NAME="tex2html33"
 HREF="node1.html">Introduction</A>
<BR> <P>

<!--End of Navigation Panel-->

<H1><A NAME="SECTION00020000000000000000">
The Problem</A>
</H1>

<P>
To make the problem clear, let us suppose that you want to solve a
system of linear equations <I>Ax</I> = <I>b</I>, in which the matrix <I>A</I> is lower
triangular.  You have your coefficient matrix data in a class of type
<TT>Mat2&lt;double&gt;</TT>, your column vector data in a class of type <TT>Mat1&lt;double&gt;</TT> and you want to call a routine <TT>ltsolve1</TT> which you
wrote (or perhaps it is part of some scientific library you acquired)
some time previously in ANSI C (see Figure&nbsp;<A HREF="node2.html#ltsolve1">1</A>).  Since
ANSI C is a subset of <TT>C++</TT>, you are confident that you can compile it
with your <TT>C++</TT> compiler and link it into your code.  The real
question, is how do you <EM>use</EM> it?
<BR>
<DIV ALIGN="CENTER"><A NAME="ltsolve1">&#160;</A><A NAME="109">&#160;</A>
<TABLE WIDTH="50%">
<CAPTION><STRONG>Figure 1:</STRONG>
C style function to perform lower triangular solve.</CAPTION>
<TR><TD><IMG
 WIDTH="626" HEIGHT="386"
 SRC="img1.gif"
 ALT="\begin{figure}\begin{tex2html_preform}\begin{verbatim}// ltsolve1.cc
// Implemen...
...[r] = (b[r] - z) / A[r][r];
}
}\end{verbatim}\end{tex2html_preform}\end{figure}"></TD></TR>
</TABLE>
</DIV>
<BR>
<P>
By this point some problems are already evident.  First off, your data
is of <TT>double</TT> precision, whereas the presented routine takes <TT>float</TT> precision arguments.  If you're typing in the source from a
printout, this may not be a big deal since you can perform the
substitution as you key it in.  But if you have the prior
implementation on disk, having to edit it is a task you would surely
like to avoid!  Secondly, even apart from the precision of the
elements, you do not even have your data in the same <EM>type</EM> of
container as required by the subroutine-you have a <TT>Mat2&lt;double&gt;</TT>
and it wants <TT>float **</TT>.

<P>
Let us suppose further that your matrix class is implemented as shown
in Figure&nbsp;<A HREF="node2.html#exmat">2</A>.  Taking another look at <TT>ltsolve1</TT> we see
that it contains loops over the elements of <TT>A</TT>, which are
accessed via double square brackets, as in <TT>A[i][j]</TT>, whereas our
matrix class is designed to be accessed via two argument parenthesis
subscripting, as in <TT>A(i,j)</TT>.  Moreover, there is no conversion
operator to convert a <TT>Mat2&lt;T&gt;</TT> into a <TT>T **</TT>, nor could there
be.  Even were the author of <TT>Mat2&lt;T&gt;</TT> (or you if you are prepared
to modify it just to help you overcome this hurdle) willing to expose the
internal implementation of the <TT>Mat2&lt;T&gt;</TT>, the fact is that it is
not implemented in a way which makes it realistic to convert it to a
<TT>T **</TT>, since the internal representation is as a single array of
data.  If you were to write an <TT>operator T**()</TT> conversion
operator for this class, you would have to allocate and return a C
style array of properly initialized <TT>T*</TT>'s which would result in a
memory leak.  Only if you were prepared to actually modify the <TT>Mat2&lt;T&gt;</TT> class so that the internal representation of its data
actually was a <TT>T**</TT> would you be able to make direct use of <TT>ltsolve1</TT>.
<BR>
<DIV ALIGN="CENTER"><A NAME="exmat">&#160;</A><A NAME="179">&#160;</A>
<TABLE WIDTH="50%">
<CAPTION><STRONG>Figure 2:</STRONG>
Schematic of a 2-d numeric container.</CAPTION>
<TR><TD><IMG
 WIDTH="697" HEIGHT="339"
 SRC="img2.gif"
 ALT="\begin{figure}\begin{tex2html_preform}\begin{verbatim}template<class T>
class Ma...
...// Plus many other methods...
};\end{verbatim}\end{tex2html_preform}\end{figure}"></TD></TR>
</TABLE>
</DIV>
<BR>
<P>
And as a final nail in the coffin for the prospect of directly reusing
<TT>ltsolve1</TT>, we note that it assumes ``one based indexing'',
whereas an inspection of the <TT>Mat2&lt;T&gt;::index</TT> method will reveal
that our matrix class uses ``zero based indexing.''

<P>
Although no single one of these obstacles is insurmountable in and of
itself, there can be no question that the total burden is quite high.
To summarize, here are the steps which would have to be taken to press
<TT>ltsolve1</TT> into service given the postulated circumstances:
<UL>
<P>
<LI>Modify the arguments to eliminate <TT>float **</TT> and replace
with <TT>Mat2&lt;double&gt;</TT>, or perhaps even template the function on <TT>T</TT>
and make it take <TT>Mat2&lt;T&gt;</TT> instead of <TT>T **</TT> parameters.

<P>
<LI>Convert uses of double square bracket indexing to use <TT>Mat2&lt;T&gt;</TT>'s
two argument parenthesis operator.

<P>
<LI>Inspect all indexing and convert from ``one based indexing'' to
``zero based indexing''.  This will certainly affect the loops, but
more generally can impact any statement which selects elements of the
matrix arguments.

<P>
</UL>This is an awful lot of editing to be doing just for the right to
``reuse'' something as utilitarian as a lower triangular matrix
solver.  Note in particular that although adjusting the bounds on the
loops in <TT>ltsolve1</TT> may seem minor, experienced readers will no
doubt have encountered situations where such ``off by one'' indexing
issues were effectively irresolvable.  All in all, this is a pretty
depressing assessment for a job which seems like it ought to be
simple, especially given that this is after all, <TT>C++</TT>--the language
that was supposed to usher in a new era of software reusability!  

<P>
Indeed it seems we need a working definition of ``software
reusability'' in order to even discuss this subject cogently.  For the 
purpose of this article, we will consider a piece of software to be
reusable if it can be called from a client program
<UL>
<P>
<LI>without forcing the user to copy data from an existing data
structure to a new one, 

<P>
<LI>without <EM>any</EM> modification to the user's existing data
structures, and 

<P>
<LI>without <EM>any</EM> modification to the routine itself.

<P>
</UL>In particular, reuse by text editing is <EM>not</EM> reuse, and we
disallow this entirely.  The reasons for such an inflexible stance on
what is meant by reusability of software is simply that one of the
prime goals of reuse is reliability.  If you have to edit a routine in
order to reuse it, then any assessment of its reliability before the
modification is of uncertain relevance to its state afterwards.  In
other words, software testing bolsters assessments of software
reliability, and modifications to software necessarily degrade these
assessments.  We want to reuse software that we already consider
reliable.  We need to keep it reliable in the process of reusing it.

<P>
<HR>
<A NAME="tex2html40"
 HREF="node3.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html38"
 HREF="cip.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html32"
 HREF="node1.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A>   <BR>
<B> Next:</B> <A NAME="tex2html41"
 HREF="node3.html">Modern C++ Culture</A>
<B>Up:</B> <A NAME="tex2html39"
 HREF="cip.html">Container-Free Numerical Algorithms in</A>
<B> Previous:</B> <A NAME="tex2html33"
 HREF="node1.html">Introduction</A>

<!--End of Navigation Panel-->
<ADDRESS>
<I>Mark Gray <BR>
1998-05-20</I>
</ADDRESS>
</BODY>
</HTML>
