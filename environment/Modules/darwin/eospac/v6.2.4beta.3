#%Module
# vi:set filetype=tcl:

# This file is based on the module file for ML's OpenMPI/1.6.3:

# where are we? 
# trim everything after ':'
set module_path $::env(MODULEPATH)
set darwin_module_dir [ lindex [ split "$module_path" ":" ] 0 ]
cd $darwin_module_dir/..
set draco_module_dir [pwd]

source $draco_module_dir/templates/header

# local variables
set name        [moduleName]
set version     [moduleVersion]
set machine     [machineName]

# module whatis
module-whatis   "EOSPAC $version";

conflict eospac

# Determine what compiler we're using

if { $machine == "cielito" } then {
   set compiler       intel
   set compilermajver 13
} else {

if { [info exists ::env(LCOMPILER) ] } {
    set compiler       $::env(LCOMPILER)
    set compilermajver $::env(LCOMPILERMAJVER)
    # special case for darwin.lanl.gov
    if { $compiler == "compilers" } {
       if { [info exists ::env(INTEL) ] } {
           set compiler intel
       }
    }
} else {
    set compiler    gcc
    set compilerver [ exec gcc --version | grep GCC | awk {{print $3}} ]
    set compilermajver [ lindex [ split "$compilerver" "." ] 0 ].[ lindex [ split "$compilerver" "." ] 1 ]
}
}

# For all Intel-13 series compilers, point to 13.0.1
if { $compiler == "intel" } then {
   if { $compilermajver == 13 } { set compilerver 13.0.1 }
}

# local variables
set version     v6.2.4beta.3
set prefix      /projects/opt/draco/vendors/eospac/$version
set platform    x86_64-unknown-linux-gnu/$compiler/$compilerver
set libdir      $prefix/lib/$platform
set incdir      $prefix/include/$platform
set bindir      $prefix/bin/$platform

if { ![file exists $libdir] } {
    puts stderr "\n[module-info name]: $libdir: No such file or directory.\n"
    break
    exit 1
}

# module help
proc ModulesHelp { } {
   global version compiler prefix libdir;
   puts stderr "\tEOSPAC $version\n";
   puts stderr "\tEOSPAC_LIB_DIR\t= $libdir";
   puts stderr "\tEOSPAC_INC_DIR\t= $incdir";
   puts stderr "\tmachine = $machine";
}

setenv EOSPAC_LIB_DIR $libdir
setenv EOSPAC_INC_DIR $incdir

# Data locations
setenv SESAMEPATH /projects/opt/draco/physical_data/eos
