#%Module
# vi:set filetype=tcl:

# This file is based on the module file for ML's OpenMPI/1.6.3:

source /usr/projects/hpcsoft/modulefiles/templates/header

# local variables
set name        [moduleName]
set version     [moduleVersion]
set machine     [machineName]

# puts stderr "\tmachine = $machine"; ### cielito

# module whatis
module-whatis   "EOSPAC $version";

conflict eospac

# Determine what compiler we're using

if { $machine == "cielito" || $machine == "cielo" } then {
   set compiler       intel
   set compilermajver 13
} else {

if { [info exists ::env(LCOMPILER) ] } {
    set compiler    $::env(LCOMPILER)
    set compilermajver $::env(LCOMPILERMAJVER)
} else {
    set compiler    gcc
    set compilerver [ exec gcc --version | grep GCC | awk {{print $3}} ]
    set compilermajver [ lindex [ split "$compilerver" "." ] 0 ].[ lindex [ split "$compilerver" "." ] 1 ]
}
}

# For all Intel-13 series compilers, point to 13.0.1
if { $compiler == "intel" } then {
   if { $compilermajver == 13 } { set compilerver 13.0.1 }
   if { $compilermajver == 14 } { set compilerver 13.0.1 }
}
# For all Intel-12 series compilers, point to 12.1.5
if { $compiler == "intel" } then {
   if { $compilermajver == 12 } { set compilerver 12.1.5 }
}

# local variables
set version     v6.2.4beta.3
set prefix      /usr/projects/data/eos/eospac/$version
set platform    x86_64-unknown-linux-gnu/$compiler/$compilerver
set libdir      $prefix/lib/$platform
set incdir      $prefix/include/$platform
set bindir      $prefix/bin/$platform

if { ![file exists $libdir] } {
    puts stderr "\n[module-info name]: $libdir: No such file or directory.\n"
    break
    exit 1
}

# module help
proc ModulesHelp { } {
   global version compiler prefix libdir;
   puts stderr "\tEOSPAC $version\n";
   puts stderr "\tEOSPAC_LIB_DIR\t= $libdir";
   puts stderr "\tEOSPAC_INC_DIR\t= $incdir";
   puts stderr "\tmachine = $machine";
}

setenv EOSPAC_LIB_DIR $libdir
setenv EOSPAC_INC_DIR $incdir

# Data locations
setenv SESAMEPATH /usr/projects/data/eos


