# Where are we?
_BINDIR=`dirname "$BASH_ARGV"`
DRACO_MODULE_DIR=`(cd $_BINDIR/..;pwd)`

# What is the platform?

if test -d /ccs/codes/radtran; then  # this is a CCS machine
  if test `uname -m` = "x86_64"; then # this is 64-bit
    platform=ccslan64
  else
    platform=ccslan32
  fi
fi

#target="`uname -n | sed -e s/[.].*//`"
if [ "${MODULE_VERSION:-}" = "" ]; then
   case $platform in
   # 32-bit CCS-2 Linux
   ccslan32 ) 
      MODULE_VERSION_STACK="ccs-Linux32"
      MODULE_VERSION="ccs-Linux32"
      ;;

   # 64-bit CCS-2 Linux
   ccslan64)
      MODULE_VERSION_STACK="ccs-Linux64"
      MODULE_VERSION="ccs-Linux64"
      ;;
   esac
   export MODULE_VERSION

else
  MODULE_VERSION_STACK="$MODULE_VERSION"
fi
export MODULE_VERSION_STACK
export MODULESHOME=$DRACO_MODULE_DIR

# Define the module command
module() { eval `$MODULESHOME/bin/modulecmd bash $*`; }
export -f module

if [ "${LOADEDMODULES:-}" = "" ]; then
  LOADEDMODULES=
  export LOADEDMODULES
fi

if [ "${MODULEPATH:-}" = "" ]; then
  export MODULEPATH=$MODULESHOME/modulefiles:$MODULESHOME/$MODULE_VERSION
fi

# Only for interactive shells
if ! test -z "$PS1"; then
  if [ ${BASH_VERSINFO:-0} -ge 3 ] && [ -r ${MODULESHOME}/init/bash_completion ]; then
#    echo "Modules: bash command completion turned on."
    source ${MODULESHOME}/init/bash_completion
  fi
fi
