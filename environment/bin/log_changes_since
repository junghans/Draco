#!/usr/bin/env sh
#
# log_changes_since:
#
# usage:   changes_since date
#
# Parses the output from cvs history to find all files which have been
# modified or added since a given date, and extract the log
# information for these files. (Enteries past the given date only)
#
# Will work only when executed in the top directory of a cvs checkout.
#
# Output is to stdout. 
#
# 'date' is some string that cvs recognizes in date
# arguments. "2008-02-23" and "yesterday" are both valid, for example.

# Read repo name from CVS/Repository
exec 9< CVS/Repository
read -u 9 repo

# Get date argument
if [ -n "$1" ]
then
    date="$1"
else
    echo "I need a date."
    exit 1
fi

cvs history -x MA -D $date -a | \
   awk '$8 ~ /^'$repo'/{printf ("%s/%s\n",$8,$7)}' | sort | uniq | \
   sed 's/^'$repo'\///' | xargs cvs -q log -d ">=${date}" -N -S
