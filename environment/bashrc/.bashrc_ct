##-*- Mode: sh -*-
##---------------------------------------------------------------------------##
## .bashrc_ct - my bash configuration file upon bash login
##---------------------------------------------------------------------------##

if test -n "$verbose"; then
   echo "In draco/environment/bashrc/.bashrc_ct"
fi

##---------------------------------------------------------------------------##
## ENVIRONMENTS
##---------------------------------------------------------------------------##

# unlimit stack and core dump sizes.
ulimit -s unlimited

# Where is the vendor directory
if test "${VENDOR_DIR}x" == "x"; then
   if test -d /usr/projects/draco/vendors; then
      VENDOR_DIR=/usr/projects/draco/vendors
   fi
fi

#
# MODULES
#

target="`uname -n | sed -e s/[.].*//`"
arch=`uname -m`

# Use modules found in the draco directory
module use --append $VENDOR_DIR/Modules/hpc
module load friendly-testing user_contrib

# Move some environment out of the way.
module unload cmake numdiff svn
module unload papi perftools trilinos
module unload PrgEnv-intel PrgEnv-pgi

# load the Intel programming env, but then unload libsci and totalview
module load PrgEnv-intel
module unload xt-libsci xt-totalview

# Cielo doesn't have module hsi yet (2015 Oct).
case ${target} in
  ci-fe* | ci-login* | ci-vizlogin*)
    ;;
  *)
    module load hsi
    ;;
esac

# draco modules start here.
module swap intel intel/15.0.3
module load lapack/3.5.0 ParMetis trilinos SuperLU_DIST
module load gsl/1.15 cmake/3.3.1 numdiff
module load ndi random123 eospac/6.2.4
module load emacs svn

function unload_draco_module_env()
{
  module unload emacs svn
  module unload ndi random123 eospac/6.2.4
  module unload gsl/1.15 cmake/3.3.1 numdiff
  module unload lapack/3.5.0 ParMetis trilinos SuperLU_DIST
  module unload intel

  module unload hsi
  module unload PrgEnv-intel
  module load PrgEnv-pgi
  module list
}

export OMP_NUM_THREADS=8

# Avoid run time messages of the form:
# "OMP: Warning #72: KMP_AFFINITY: affinity only supported for Intel(R) processors."
# Ref: http://software.intel.com/en-us/articles/bogus-openmp-kmp_affinity-warnings-on-non-intel-processor-hosts/
export KMP_AFFINITY=none

##---------------------------------------------------------------------------##
## end of .bashrc_ct
##---------------------------------------------------------------------------##
