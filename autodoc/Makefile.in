###############################################################################
# draco/autodoc Makefile.in
# Thomas M. Evans
# Wed Sep  1 16:14:07 1999
# $Id$
###############################################################################
# @> General Makefile.in for draco/autodoc
###############################################################################

# doxygen executable
DOXYGEN = @DOXYGEN_PATH@

INSTALL = @INSTALL@

top_srcdir = @top_srcdir@
prefix = @prefix@
srcdir = @srcdir@
doxygen_extras = @doxygen_extras@
installdirs = ${prefix}/html ${prefix}/latex

# get the relative directory to the config files (relative to ${top_srcdir}).

rel_config_dir := $(shell ( cd ${top_srcdir} ; \
	tmp="" ; \
	while test ! -d config ; \
	do \
	   cd .. ; \
	   tmp=$$tmp../ ; \
	done ; \
	echo $$tmp ) )config

# get the config directory
config_dir = $(shell cd ${top_srcdir}/${rel_config_dir}; pwd)

imagefiles := $(subst ${srcdir}/html, ${prefix}/html, $(wildcard ${srcdir}/html/*.gif) )\
	$(subst ${srcdir}/html, ${prefix}/html, $(wildcard ${srcdir}/html/*.jpg) )\
	$(subst ${srcdir}/html, ${prefix}/html, $(wildcard ${srcdir}/html/*.png) )

supportfiles := $(subst ${srcdir}/html, ${prefix}/html, $(wildcard ${srcdir}/html/*.css))

##---------------------------------------------------------------------------##

.SUFFIXES : .png .gif .jpg .css
.PHONY : html latex install autodoc configure reconfigure

autodoc: html

html latex: install_graphics install_support
	@if test ${DOXYGEN} = 'null'; then \
		echo Doxygen not available; \
	else \
		${DOXYGEN} doxygen_config; \
		cp ${srcdir}/html/draco.gif ${prefix}/html; \
                cp ${srcdir}/html/doxygen.png ${prefix}/html; \
	        cp ${srcdir}/html/draco.css ${prefix}/html; \
		for dir in ${doxygen_extras}; \
		do \
			files=`ls $${dir}` ; \
			dir_name=`dirname $${dir}` ; \
			base_name=`basename $${dir_name}` ; \
			mkdir -p ${prefix}/html/$${base_name}; \
			for file in $${files} ; \
			do \
				cp -f $${dir}/$${file} \
				  ${prefix}/html/$${base_name}/; \
			done \
		done \
	fi

install:

check:

##---------------------------------------------------------------------------##
## Install support files

install_graphics: ${imagefiles}
install_support: ${supportfiles}

${prefix}/html/%.png: ${srcdir}/html/%.png
	@echo "Installing file: \"$@\""
	${VERBOSE} ${INSTALL} $< $@
${prefix}/html/%.jpg: ${srcdir}/html/%.jpg
	@echo "Installing file: \"$@\""
	${VERBOSE} ${INSTALL} $< $@
${prefix}/html/%.gif: ${srcdir}/html/%.gif
	@echo "Installing file: \"$@\""
	${VERBOSE} ${INSTALL} $< $@
${prefix}/html/%.css:  ${srcdir}/html/%.css
	@echo "Installing file: \"$@\""
	${VERBOSE} ${INSTALL} $< $@

##---------------------------------------------------------------------------##
## Build system targets and rules

configure:
	@echo "Rebuilding ${srcdir}/aclocal.m4"
	@cd ${srcdir} && aclocal -I ../config
	@echo "Rebuilding ${srcdir}/configure"
	@cd ${srcdir} && autoconf
	@./config.status --recheck
	@./config.status

reconfigure: 
	@./config.status --recheck
	@./config.status

##---------------------------------------------------------------------------##
## clean targets

clean: forced-clean

forced-clean:
	-rm -rf ${prefix}/html/*
	-rm -rf ${prefix}/latex/*

mostlyclean: clean

distclean: mostlyclean forced-distclean

forced-distclean:
	-rm -f config.status config.cache config.log
	-rm -f header.html footer.html doxygen_config
	-rm -f Makefile

###############################################################################
#			 end of draco/autodoc Makefile.in
###############################################################################
