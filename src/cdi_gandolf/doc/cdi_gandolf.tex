%%---------------------------------------------------------------------------%%
%% 
%% \file    draco/src/cdi_gandolf/doc/cdi_gandolf.tex
%% \author  Kelly Thompson
%% \date    Thu Mar 8 9:45:15 MST 2001
%% \brief   Using the Gandolf opacity package plugin for CDI.
%%---------------------------------------------------------------------------%%
%% $Id$
%%---------------------------------------------------------------------------%%
\documentclass[11pt]{nmemo}
\usepackage[centertags]{amsmath}
\usepackage{amssymb,amsthm,graphicx}
\usepackage[mathcal]{euscript}
\usepackage{tabularx}
\usepackage{tmadd,tmath}
\usepackage{cite}
%\usepackage{c++}
\usepackage{fancycodes}  % needed to get ``LaTeX'' symbol.
\usepackage{float} % used for C++ example code.
\usepackage{shading}
\usepackage{fancybox}
\usepackage{url}
\usepackage[hang,small]{caption2}

%%---------------------------------------------------------------------------%%
%% DEFINE SPECIFIC ENVIRONMENTS HERE
%%---------------------------------------------------------------------------%%
%\newcommand{\elfit}{\ensuremath{\operatorname{Im}(-1/\epsilon(\vq,\omega)}}
%\msection{}-->section commands
%\tradem{}  -->add TM subscript to entry
%\ucatm{}   -->add trademark footnote about entry

\newcommand{\comp}[1]{\normalfont\normalsize\texttt{#1}}
\newcommand{\draco}{{\normalfont\sffamily Draco}}
\newcommand{\tycho}{{\normalfont\sffamily Tycho}}
\newcommand{\solon}{{\normalfont\sffamily Solon}}
\newcommand{\milagro}{{\normalfont\sffamily Milagro}}
\newcommand{\metis}{{\normalfont\sffamily Metis}}
\newcommand{\pcg}{{\normalfont\sffamily PCG}}
\newcommand{\cvs}{{\normalfont\bfseries CVS}}
\newcommand{\python}{{\normalfont\bfseries Python}}
\newcommand{\doxygen}{{\normalfont\bfseries Doxygen}}
\newcommand{\kcc}{{\normalfont\bfseries KCC}}
\newcommand{\xemacs}{{\normalfont\bfseries XEmacs}}
\newcommand{\bash}{{\normalfont\bfseries Bash}}

\floatstyle{plain}
\newfloat{cxxSampleCode}{!ht}{lom}
\floatname{cxxSampleCode}{Code Example}
\setlength{\belowcaptionskip}{5ex plus 4pt minus 2pt}

\newenvironment{doublequote}
{\begin{quote}\begin{quote}}
    {\end{quote}\end{quote}}

\newenvironment{codeExample}
{\footnotesize 
  \VerbatimEnvironment
  \begin{SaveVerbatim}{\mycode}}%
  {\end{SaveVerbatim}%
  \noindent%
  \parashade[.950]{sharpcorners}{\gdef\outlineboxwidth{.5}%
    \UseVerbatim{\mycode}}\normalsize}

%%---------------------------------------------------------------------------%%
%% BEGIN DOCUMENT
%%---------------------------------------------------------------------------%%
\begin{document}

%%---------------------------------------------------------------------------%%
%% OPTIONS FOR NOTE
%%---------------------------------------------------------------------------%%

\toms{Distribution}
%\toms{Joe Sixpak/XTM, MS B226}
\refno{CCS-4:01-05(U)}
\subject{Gandolf Opacity Package for \draco}

%-------NO CHANGES
\divisionname{Computer and Computational Sciences Division}
\groupname{CCS-4: Transport Methods Group}
\fromms{Kelly Thompson CCS-4 D409}
\phone{(505) 665--3929}
\originator{kt}
\typist{kt}
\date{\today}
%-------NO CHANGES

%-------OPTIONS
%\reference{NPB Star Reimbursable Project}
%\thru{P. D. Soran, XTM, MS B226}
%\enc{list}      
%\attachments{list}
%\cy{list}
%\encas
%\attachmentas
%\attachmentsas 
%-------OPTIONS

%%---------------------------------------------------------------------------%%
%% DISTRIBUTION LIST
%%---------------------------------------------------------------------------%%

\distribution {
  CCS-4 MS D409:\\
  Group Leader:  J.E. Morel, X-6 MS D409\\ 
%  B.T. Adams, X-6 MS D409\\
%  R.E. Alcouffe, X-6 MS D409\\ 
%  M.L. Alme, X-6 MS D409\\
  D.G. Archuleta, X-6 MS D409\\ 
%  R.S. Baker, X-6 MS D409\\ 
%  F.W. Brinkley, Jr., X-6 MS D409\\ 
%  J.A. Dahl, X-6 MS D409\\ 
%  F.H. Dang, X-6 MS D409\\ 
  T.M. Evans, X-6 MS D409\\ 
%  S.A. Gallegos, X-6 MS D409\\ 
%  B.D. Ganapol, X-6 MS D409\\ 
  M.G. Gray, X-6 MS D409\\ 
%  J.C. Gulick, X-6 MS D409\\ 
%  M.L. Hall, X-6 MS D409\\ 
%  W.D. Hawkins, X-6 MS D409\\
  H.G. Hughes, X-6 MS D409\\ 
% M.A. Hunter, X-6 \\
 H. Lichtenstein, X-6 MS D409\\ 
% D.R. Marr, X-6 MS D409\\ 
  J.M. McGhee, X-6 MS D409\\ 
%  D. Mihalas, X-6 MS D409\\ 
%  M.L. Murillo, X-6 MS D409\\ 
  G.L. Olson, X-6 MS D409\\ 
  S. Pautz, X-6 MS D409\\ 
%  A.K. Prinja, X-6\\ 
%  E.W. Qarsen, X-6 MS D409\\ 
  R.M. Roberts, X-6 MS D409\\ 
  K.G. Thompson, X-6 MS D409\\
%  S.A. Turner, X-6 MS D409\\ 
%  W.T. Urban, X-6 MS D409\\ 
  T.J. Urbatsch, X-6 MS D409\\ 
%  T.A. Wareing, X-6 MS D409\\
  J.S. Warsa, X-6 MS D409\\
}

%%---------------------------------------------------------------------------%%
%% BEGIN NOTE
%%---------------------------------------------------------------------------%%

\opening

%%---------------------------------------------------------------------------%%
%%                           Introduction
%%---------------------------------------------------------------------------%%

\section{Introduction}

The \texttt{cdi\_gandolf} package has been introduced into the \draco
project to provide a solution to two issues.  First, it provides a C++
object based interface to IPCRESS (Independent of Platform and Can be
Read by existing Software Subroutines) opacity data.  These data files
are produced by the TOPS~\cite{tops} code via the FORTRAN77 Gandolf
(Get All Needed Data from an Opacity Laden File)
libraries~\cite{gandolf}.  Second, it acts as a plug-in component for
\draco's Common Data Interface (CDI) package.  A list of six
components that make up the \texttt{cdi\_gandolf} package are shown
below in Table~\ref{tab:components}.

% h - here, t - top, p - page
\begin{table}[!ht]
%  \begin{quote}
  \setcaptionwidth{0.9\textwidth}
  \caption{This package consists of five classes and a C++ wrapper for
    the Gandolf vendor library.}
  \label{tab:components}
%  \end{quote}
  \footnotesize
  
    \begin{center}
      \newcolumntype{Y}{>{\raggedleft\setlength{\hsize}{0.4\linewidth}\arraybackslash}X}
      \newcolumntype{Z}{>{\raggedright\setlength{\hsize}{0.6\linewidth}\arraybackslash}X}
                                %    \begin{tabularx}{\linewidth}{YZ}
      \begin{tabularx}{0.9\linewidth}{YZ}
        \multicolumn{1}{c}{\textbf{Class}} & \multicolumn{1}{c}{\textbf{Role}} \\ 
        
        \hline
        \\
      
        \textbf{GandolfWrapper} & Provide C++ style access to the
                                  Gandolf library functions ensuring
                                  correct data type translation. \\
\\
           \textbf{GandolfFile} & Provide access to the fundamental
                                  information about an IPCRESS file.
                                  The two GandolfOpacity objects only
                                  access the data file through this
                                  object. \\
\\
      \textbf{GandolfException} & Provide detailed information about
                                  and handle any exception thrown by
                                  the Gandolf wrapper or library. \\
\\
      \textbf{GandolfDataTable} & Cache the opacity lookup table
                                  provided by the IPCRESS file. This
                                  is a component object of the two
                                  GandolfOpacity objects. \\
\\
    \textbf{GandolfGrayOpacity} & Provide access to gray opacity data
                                  for a single material found in the
                                  IPCRESS file. \\
\\
\textbf{GandolfMultigroupOpacity} & Provide access to multigroup opacity
                                    data for a single material found in
                                    the IPCRESS file. \\

    \end{tabularx}
  \end{center}
  \normalsize
\end{table}

The \texttt{cdi\_gandolf} package may be used as a stand-alone
package, however, it has been designed as a plug-in component for CDI.
Because of this, its design follows the interface defined by the CDI
package.  In particular, \texttt{cdi\_gandolf} offers no mechanism for
mixing materials.  The only mixtures that it can utilize are those
specified by TOPS and stored in the associated IPCRESS data files.
Additionally, this package does not access the IPCRESS data directly.
Instead it provides a wrapper to data access libraries written,
supported and provided by X-division's data team.  The \draco project
keeps a copy of these libraries for revision control purposes.  The
Gandolf libraries are located at
\url{/radtran/vendors/gandolf}.

%%---------------------------------------------------------------------------%%
%%                           GandolfFile
%%---------------------------------------------------------------------------%%

\section{GandolfFile}
\label{gandolffile}
\subsection{Instantiation}

The Gandolf-File object provides Gandolf-Opacity objects a path for
interaction with an IPCRESS opacity data file.  A Gandolf-File object
only requires the name of a valid IPCRESS file for instantiation.  Its
state consists of this filename plus a list of material identifiers
read from the IPCRESS file.  See Code Example
\ref{codeExample:gandolfFileInstantiation} for an example.

\begin{cxxSampleCode}
%\footnotesize
\begin{codeExample}
#include "GandolfFile.hh"
#include "GandolfException.hh"

main()
{
   // Specify the name of the IPCRESS data file.
   const string filename = "data.ipcress";

   // Instantiate the object within a try block.
   try
      {
         spGF = new rtt_cdi_gandolf::GandolfFile( filename );
      }
   catch ( const rtt_cdi_gandolf::GandolfException& GandError )
      {
         // Instantiation failed.
         cout << GandError.errorSummary() << endl;
         return 1;
      }
   return 0;  // Success.
}
\end{codeExample}
%\normalsize
\caption{Example of instantiating a GandolfFile object.}
\label{codeExample:gandolfFileInstantiation}
\end{cxxSampleCode}

%----------------------------------------
% GandolfFile - Access Functions
%----------------------------------------

\subsection{Access Functions}

GanolfFile provides four access functions as shown in Table
\ref{tab:gandolfFileAccess}.  These functions return simple
information about the data found in the IPCRESS file.

%% h - here, t - top, p - page
\begin{table}[!ht]
%%  \begin{quote}
    \caption{Access functions for GandolfFile}
    \label{tab:gandolfFileAccess}
%%  \end{quote}
    \footnotesize
    
    \begin{center}
      \newcolumntype{Y}{>{\raggedleft\setlength{\hsize}{0.4\linewidth}\arraybackslash}X}
      \newcolumntype{Z}{>{\raggedright\setlength{\hsize}{0.6\linewidth}\arraybackslash}X}
      \begin{tabularx}{0.9\linewidth}{YZ}
        \multicolumn{1}{c}{\textbf{Member Function}} & \multicolumn{1}{c}{\textbf{Role}} \\ 
        
        \hline
        \\
        
\texttt{const string\& getDataFilename()} & Returns the name of
                                            the IPCRESS file. \\
\\
\texttt{int getNumMaterials()} & Returns the number of
                                 materials found in the IPCRESS file. \\
\\
\texttt{const vector<int>\& getMatIDs()} & A list of materials found
                                           in the IPCRESS file. \\
\\
\texttt{bool materialFound( int matid )} & Returns true if material
                                           identifier matid exists in
                                           the IPCRESS file. \\ 

      \end{tabularx}
    \end{center}
    \normalsize
  \end{table}

%----------------------------------------
% GandolfFile - Typical Use
%----------------------------------------

\subsection{Typical Use}

Normally, Gandolf-File is only used as a hook to interface a
Gandolf-Opacity object to an IPCRESS file.  The member functions for
Gandolf\-File will not need to be invoked by the user, but
Gandolf\-Opacity (Gray or Multigroup) will use them.  The
Gandolf\-File object must be instantiated prior to the instantiation
of a Gandolf-Opacity object.  Note that there should be a one-to-one
correspondence between the Gandolf-File object and an IPCRESS file.
Multiple Gandolf-Opacity objects will reference the same Gandolf-File
object. 

%%---------------------------------------------------------------------------%%
%%          GandolfException, GandolfWrapper and GandolfDataTable
%%---------------------------------------------------------------------------%%

\section{GandolfException, GandolfWrapper and GandolfDataTable}

There is no requirement for the client code to interact with any of
these classes.  GandolfDataTable is a component of the Gandolf-Opacity
object.  It will be instantiated automatically when needed and while
it interacts with other \texttt{cdi\_gandolf} components the user does
not need to interact directly with the GandolfDataTable object.  There
is always and one-to-one relationship between Gandolf-Opacity and
GandolfDataTable.

The GandolfWrapper routines provide access to the FORTRAN77 Gandolf
libraries.  This set of routines act as the interface between the
FORTRAN library and the C++ objects that make up the
\texttt{cdi\_gandolf} package.  A client code could theoretically use
the functions found in GandolfWrapper to access the FORTRAN Gandolf
libraries directly without using the rest of the package.  However,
the design of this package did not have this approach in mind.

The client code will have some indirect interaction with the
GandolfException object if the client wants to intercept exceptions
thrown by various routines in this package.  The client code should
include a try block similar to the one shown in Code
Example~\ref{codeExample:gandolfFileInstantiation} when instantiating
either a Gandolf-File object or a Gandolf-Opacity object. 


%%---------------------------------------------------------------------------%%
%%          GandolfGrayOpacity and GandolfMultigroupOpacity
%%---------------------------------------------------------------------------%%

\section{GandolfGrayOpacity and GandolfMultigroupOpacity}

These two classes provide very similar interfaces to IPCRESS opacity
data.  The only difference is that while GandolfGrayOpacity considers
an opacity value to be a single double (i.e.: a single gray value),
the GandolfMultigroupOpacity class considers an opacity value to be a
vector of doubles (a value for each energy group).   These objects
inherit their interface from the Opacity interface definitions
declared in the cdi package (see cdi/GrayOpacity.hh and
cdi/MultigroupOpacity.hh). 

%----------------------------------------
%  GandolfGrayOpacity and GandolfMultigroupOpacity - Instantiation
%----------------------------------------

\subsection{Instantiation}

The state of a Gandolf-Opacity (either gray or multigroup) object is
determined by five pieces of information.  All of these options must
be explicitly defined during the instantiation of a Gandolf-Opacity
object.   

\begin{table}[!ht]
    \caption{The five policies that define a GandolfOpacity object.}
    \label{tab:gandolfopacitypolicies}
    \footnotesize
    
    \begin{center}
      \newcolumntype{Y}{>{\raggedleft\setlength{\hsize}{0.4\linewidth}\arraybackslash}X}
      \newcolumntype{Z}{>{\raggedright\setlength{\hsize}{0.6\linewidth}\arraybackslash}X}
      \begin{tabularx}{0.9\linewidth}{YZ}
        \multicolumn{1}{c}{\textbf{Required Information}} & \multicolumn{1}{c}{\textbf{Role}} \\ 
        
        \hline
        \\
Smart pointer to a GandolfFile object & Specifies the associated
                                        IPCRESS data file.  \\
\\
                  Material Identifier & A GandolfOpacity object must
                                        represent a single material
                                        whose identity is 
                                        specified by an integer
                                        value. This material must
                                        be found in the associated
                                        IPCRESS data file.  \\
\\
                        Opacity Model & A GandolfOpacity object must
                                        contain either Rosseland or
                                        Plank data. \\
\\
                      Reaction Model &  A GandolfOpacity object must
                                        represent the total,
                                        absorption-only or
                                        scattering-only opacities. \\
\\
                        Energy Model & This is specified by
                                        instantiating either a
                                        GandolfGrayOpacity or a
                                        GandolfMultigroupOpacity
                                        object. \\
\\
      \end{tabularx}
    \end{center}
    \normalsize
  \end{table}

The Gandolf-File object must already exist (see Section
\S\ref{gandolffile} of this document).  The creator routine expects a
DRACO smart pointer to this object (i.e.: \texttt{rtt\_dsxx::SP<GandolfFile>}).

The material identifier is an integer that matches the material
identifier of one of the materials found in the IPCRESS file.  The
user should be aware of the contents of the IPCRESS file (including
knowing what materials exist in the file and knowing the identifier
for each material).  There is no mechanism built into this package for
querying the IPCRESS file for material information.


\begin{cxxSampleCode}
\begin{codeExample}
#include "GandolfFile.hh"
#include "GandolfException.hh"

main()
{
   // Assume that we have already instantiated a GandolfFile object 
   // named spGF. (see Code Example 1 above for details.)

   // Assign a material identifier
   const int matid = 10001;
        
   // Declare a smart pointer to and GandolfGrayOpacity.  We use the
   // interface defined by rtt_cdi:GrayOpacity.
   rtt_dsxx::SP< rtt_cdi::GrayOpacity > spOpacity_GraRosTot;
        
   // Use a try block when instantiating the GrayOpacity object so that
   // we can catch any errors.
   try
      {
         spOpacity_GraRosTot = new 
            rtt_cdi_gandolf::GandolfGrayOpacity( 
               spGF,   // All data is loaded from this IPCRESS
                       // file.
               matid,  // This object can only return information 
                       // about one material.
               rtt_cdi::Rosseland,     // All opacity values use the Rosseland 
                                       // model.
               rtt_cdi::Total );       // All opacity values are total cross 
                                       // sections.
      }
   catch ( const rtt_cdi_gandolf::GandolfException& GandError )
      {
         // Instantiation failed so print a report and exit.
         cout << GandError.errorSummary();
         return -1;
      }

   // Instantiation was successful.
   return 0;
}
\end{codeExample}
\caption{Example of instantiating a GandolfGrayOpacity object.}
\label{codeExample:gandolfGrayInstantiation}
\end{cxxSampleCode}

The opacity model (``Rosseland'' or ``Plank'') is an enumerated value
defined in \draco's \texttt{cdi} package.  The user must specify what
type of opacity information he/she wants this object to return.

The reaction model is also an enumerated value defined by the
\texttt{cdi} package.  Valid values are ``total'', ``scattering'', or
``absorption''.  A Gandolf-Opacity object can only access a single
type of opacity.  If both "total" and "scattering" opacities are
required by the client code then two distinct Gandolf-Opacity objects
will need to be instantiated.

The energy model will be automatically specified when the client code
chooses to instantiate either a GandolfGrayOpacity object or a
GandolfMultigroupOpacity object.

An example of instantiating a Gandolf-Opacity object is shown in Code
Example~\ref{codeExample:gandolfGrayInstantiation}.

%----------------------------------------
% GandolfGrayOpacity and GandolfMultigroupOpacity - Access Functions
%----------------------------------------

\subsection{Access Functions}

The GandolfOpacity classes have been designed as a mechanism to obtain
logarithmically interpolated opacity data from an IPCRESS file.  As
such the primary access function of GandolfGrayOpacity and
GandolfMultigroupOpacity is the \texttt{getOpacity()} accessor.  Other
functions are also available that allow the user to query the opacity
lookup table and to obtain text descriptions of the data represented
by this object. Examples demonstrating the use of these accessor
functions can be found in the next subsection or in the unit test
``cdi\_gandolf/test/tGandolfOpacity.''

Some of the more commonly used access functions for GandolfGrayOpacity
are listed in Table \ref{tab:graymembers} below.  These access
functions expect temperatures to be given in keV and densities to
given in g/cm$^3$.  The retuned opacity values have units of cm$^2$/g.

\begin{table}[!ht]
    \caption{GrayGandolfOpacity member functions.}
    \label{tab:graymembers}
    \footnotesize
    
    \begin{center}
      \newcolumntype{Y}{>{\raggedright\setlength{\hsize}{0.6\linewidth}\arraybackslash}X}
      \newcolumntype{Z}{>{\raggedright\setlength{\hsize}{0.4\linewidth}\arraybackslash}X}
      \begin{tabularx}{0.9\linewidth}{YZ}
        \multicolumn{1}{c}{\textbf{GandolfGrayOpacity Member Functions}} & \multicolumn{1}{c}{\textbf{Role}} \\ 
        
        \hline
        \\
\texttt{double~getOpacity(}
\texttt{\mbox{ double~temp,}}
\texttt{\mbox{ double~density )}}
& Given the 
  temperature and density information, return a logarithmically
  interpolated opacity value.  \emph{The type of opacity returned will
  correspond to GandolfGrayOpacity's state (e.g.: Rosseland,
  absorption-only)}. \\ 
\\
\texttt{vector<double>~getOpacity(}
\texttt{\mbox{ vector<double>~temp,}} 
\texttt{\mbox{ double~density)}}
& Return a list of opacities corresponding to the
  given density and each of the given temperatures. \\
\\
\texttt{vector<double>~getOpacity(}
\texttt{\mbox{ double~temp,}}
\texttt{\mbox{ vector<double>~density )}}
& Returns a list of opacities corresponding to the given
  temperature and each of the given densities. \\
\\
\texttt{const~vector<double>\&}
\texttt{\mbox{ getTemperatureGrid()}}
& Access the opacity lookup table. \\
\\
\texttt{const~vector<double>\& }
\texttt{\mbox{ getDensityGrid()}} 
& Access the opacity lookup table. \\
\\
      \end{tabularx}
    \end{center}
    \normalsize
\end{table}
  
GandolfMultigroupOpacity has a similar set of functions.  These member
functions are listed in Table \ref{tab:mgmembers}.  The primary
difference is that GandolfMultigroupOpacity returns a list of
multigroup opacity values instead of a single opacity value.  It
should be noted that the functions that access the lookup table return
references to the actual table data.  The opacity accessors return a
copy of the data and not a reference.  Also, the number of groups in
the data table is set by TOPS in the IPCRESS file.

\begin{table}[!ht]
    \caption{MultigroupGandolfOpacity member functions.}
    \label{tab:mgmembers}
    \footnotesize
    
    \begin{center}
      \newcolumntype{Y}{>{\raggedright\setlength{\hsize}{0.6\linewidth}\arraybackslash}X}
      \newcolumntype{Z}{>{\raggedright\setlength{\hsize}{0.4\linewidth}\arraybackslash}X}
      \begin{tabularx}{0.9\linewidth}{YZ}
        \multicolumn{1}{c}{\textbf{GandolfMultigroupOpacity Member Functions}} & \multicolumn{1}{c}{\textbf{Role}} \\ 
        
        \hline
        \\
\texttt{vector<double>~getOpacity( double~temp,}
\texttt{\mbox{ double~density )}}
& Given the temperature and density information, return a
logarithmically interpolated opacity value.  The length of this vector
will be equal to the number of groups in the data set.  \emph{The type of
opacity returned will correspond to GandolfGrayOpacity's state (e.g.:
Rosseland, absorption-only)}. \\
\\
\texttt{vector<vector<double>>~getOpacity(}
\texttt{\mbox{ vector<double>~temp, double~density)}}
& Return a list of multigroup opacities corresponding to the given density
and each of the given temperatures. \\
\\
\texttt{vector<vector<double>>~getOpacity( double~temp,}
\texttt{\mbox{ vector<double>~density )}} 
& Returns a list of multigroup opacities corresponding to the given
temperature and each of the given densities. \\
\\
\texttt{const vector<double>\& getTemperatureGrid()} & Access the
opacity lookup table grid. \\
\\
\texttt{const vector<double>\& getDensityGrid()} & Access the opacity
lookup table grid. \\
\\
\texttt{const vector<double>\& getGroupBoundaries()} & Access the
  opacity lookup table grid. \\
\\
    \end{tabularx}
  \end{center}
  \normalsize
\end{table}
  


\begin{cxxSampleCode}
\begin{codeExample}
#include "GandolfMultigroupOpacity.hh"
#include "GandolfMultigroupOpacity.t.hh"
#include "GandolfFile.hh"
#include "GandolfException.hh"

main()
{
   // Assume that we have already instantiated a GandolfFile object 
   // named spGF. (see Code Example 1 above for details.)

   // Assign a material identifier
   const int matid = 10001;
        
   // Declare a smart pointer to and GandolfMultigroupOpacity.  We use the
   // interface defined by rtt_cdi:MultigroupOpacity.
   rtt_dsxx::SP< rtt_cdi::MultigroupOpacity > spOpacity_mgRosTot;
        
   // Use a try block when instantiating the MultigroupOpacity object so that
   // we can catch any errors.
   try
      {
         spOpacity_mgRosTot = new 
            rtt_cdi_gandolf::GandolfMultigroupOpacity( 
               spGF,    // All data is loaded from this IPCRESS
                        // file.
                matid,  // This object can only return
                        // information about one material.
                rtt_cdi::Rosseland,     // All opacity values use the Rosseland 
                                        // model.
                rtt_cdi::Total );       // All opacity values are total cross 
                                        // sections.
      }
   catch ( const rtt_cdi_gandolf::GandolfException& GandError )
      {
         // Instantiation failed so print a report and exit.
         cout << GandError.errorSummary();
         return -1;
      }

   double temp = 5.0; // keV
   double dens = 27.0; // g/cm^3



   // continued below ...

\end{codeExample}

\caption{Example of using a GandolfMultigroupOpacity object (part 1 of 
  2)}
\label{codeExample:gandolfmguse_part1}
\end{cxxSampleCode}

\begin{cxxSampleCode}
\begin{codeExample}
   // continued from above ...

   // Interpolate and return an opacity value for this material at
   // (temp,dens).  There will be ngroup entries.
   vector<double> mgOpacity = spOpacity_mgRosTot->getOpacity( temp, dens );

   // Interpolate and return an a vector of multigroup opacity values for
   // this material at each of the temperature points and the single
   // density provided.  There will be ngroup*ntemp entries.
   const int ngroups = spOpacity_mgRosTot->getNumGroups();
   const int ntemps = 3;
   vector<double> vtemp( ntemps );
   for ( int it=0; it<ntemps; ++it)
      vtemp[it] = 5.0*(it+1);

   vector< vector< double > > vmgOpacity 
      = spOpacity_mgRosTot->getOpacity( vtemp, dens );

   return 0;
}
\end{codeExample}
\caption{Example of using a GandolfMultigroupOpacity object (part 2 of 
  2).}
\label{codeExample:gandolfmguse_part2}
\end{cxxSampleCode}

In Addition to these \emph{standard} access functions, both
GandolfOpacity objects have STL-like accessor routines.  These
accessors can be used if the desired opacity container is not a
\texttt{vector<double>}.  The opacity container must be a 1-D
container for both GandolfGrayOpacity and GandolfMultigroupOpacity.

\begin{table}[!ht]
    \caption{MultigroupGandolfOpacity member functions.}
    \label{tab:stlmembers}
    \footnotesize
    
    \begin{center}
      \newcolumntype{Y}{>{\raggedright\setlength{\hsize}{0.6\linewidth}\arraybackslash}X}
      \newcolumntype{Z}{>{\raggedright\setlength{\hsize}{0.4\linewidth}\arraybackslash}X}
      \begin{tabularx}{0.9\linewidth}{YZ}
        \multicolumn{1}{c}{\textbf{GandolfOpacity Member Functions}} & \multicolumn{1}{c}{\textbf{Role}} \\ 
        
        \hline
        \\
\texttt{OpacityIterator~getOpacity(}
\texttt{\mbox{ TempIterator~tempFirst, TempIterator~tempLast,}}
\texttt{\mbox{ DensIterator~densFirst, DensIterator~densLast,}}
\texttt{\mbox{ OpacityIterator~opFirst )}}
& The temperature and density containers are considered a tuple of
values.  An opacity value is returned for each pair of temperature and
density values given.  \emph{All containers must be 1D.} 
\\
\texttt{OpacityIterator getOpacity( }
\texttt{\mbox{ TempIterator~tempFirst, TempIterator~tempLast,}}
\texttt{\mbox{ double targetDensity, OpacityIterator opFirst )}}
& The 1D
opacity STL container will be filled with values corresponding to each
of the given temperatures and the single density value. \\
\\
\texttt{OpacityIterator getOpacity( }
\texttt{\mbox{ double~targetTemperature,}}
\texttt{\mbox{ DensIterator~densFirst, DensIterator~densLast,}}
\texttt{\mbox{ OpacityIterator opFirst )}}
& The 1D
opacity STL container will be filled with values corresponding to each
of the given densities and the single temperature value. \\

\\
    \end{tabularx}
  \end{center}
  \normalsize
\end{table}
  
An example using GandolfMultigroupOpacity to obtain opacity values is
shown above in Code Examples \ref{codeExample:gandolfmguse_part1} and
\ref{codeExample:gandolfmguse_part2}.  For more examples please
examine the \texttt{tGandolfOpacity.cc} unit test.

%%---------------------------------------------------------------------------%%
%%                         Gandolf Libraries
%%---------------------------------------------------------------------------%%

\newpage

\section{Gandolf Libraries}

Information about the Gandolf libraries can be found online at
\url{http://laurel.lanl.gov/XCI/PROJECTS/DATA/atomic/gandolf.html}.
This web site contains a \texttt{.tar} file with the most current
libraries and documentation~\cite{gandolf} in a variety of formats.

%%---------------------------------------------------------------------------%%
%%                              TOPS
%%---------------------------------------------------------------------------%%

\section{TOPS}

TOPS is a code that allows users to generate tables of multigroup
opacities using the cross section files generated by Group T-4
(\url{http://www.t4.lanl.gov/}).  Detailed information about TOPS can
be found in the report LA-10454~\cite{tops} (download:
\url{http://laurel.lanl.gov/XCI/PROJECTS/DATA/atomic/pdf/tops.pdf}).
The manual includes details about locating binaries and running the
code to create IPCRESS files.  A list of materials available for
mixing by TOPS is located at
\url{http://www.t4.lanl.gov/opacity/avmat.html}.

The TOPS manual was last printed in 1985 so there are few points in
the text that are out of date.  The binaries are located on Nirvana at
\texttt{/usr/projects/data}.  The subdirectory \texttt{bin} contains
the binary and the data tables are located in the atomic subdirectory.

\flushleft
\begin{enumerate}
\item Log on to Nirvana
\item Connect to a compute note via \texttt{llogin}.
\item Add \texttt{/usr/projects/data/bin} to \texttt{\$PATH}.
\item Load the MIPS libraries.
\item Run \texttt{topsn}.
\item TOPS Session:
  \begin{enumerate}
    \item Create a material (91\% Be, 9\% Cu). \\*
      \texttt{f 0.91 Be 0.09 Cu}
    \item Take only every 5th point in the temperature grid
      (tgrid). \\*
      \texttt{tby 5}
    \item Set the material ID to 10002. \\*
      \texttt{mgid 10002}
    \item Set the density grid to cover the range 0.01\ldots100 with 
      5 data points per decade. \\*
      \texttt{rlog 5 0.01 100.0}
    \item Use multigroup opacities if off density grid. \\*
      \texttt{dl f}
    \item Compute opacities and write output files \\*
      \texttt{go}
    \item exit TOPS
      \texttt{end}      
  \end{enumerate}
\item Note:
  \begin{enumerate}
  \item From within the TOPS program you can use "help" to obtain
    information about all commands. 
  \item t, r, g show current temperature, density and energy group
    grids. 
  \end{enumerate}
\item TOPS creates several files in the current working
  directory (you should probably be working in a scratch directory on
  Nirvana). 
  \begin{enumerate}
  \item bliss - IPCRESS formatted opacity data (approx 1.5 Mbytes).
  \item tape 6 - list of data exceptions.
  \item topslog - log of TOPS session.
  \end{enumerate}
\end{enumerate}

TOPS can also be used to create a table of analytic opacity values
specified by a formula from within the TOPS program.  You may want to
examine the TOPS help for the following commands: source, t, r, g,
stem, sig0, topow, ropow, hnupow, and nbsubg. 

%\begin{cxxSampleCode}
%\begin{codeExample}

%\end{codeExample}
%\caption{Example TOPS session.}
%\label{codeExample:topssession}
%\end{cxxSampleCode}


%%---------------------------------------------------------------------------%%

%\pagebreak
%\appendix

%\section{Sample \comp{.bashrc} File}
%\label{.bashrc}

%This is a sample \comp{.bashrc} file that sets all of the environment
%variables required by \draco.  Additionally, this file leaves room for 
%user-defined options that you may want to modify for your own specific 
%needs.


%%---------------------------------------------------------------------------%%

\pagebreak
\bibliographystyle{rnote}
\bibliography{../../../../../draco/doc/bib/draco}
%\bibliography{../../../doc/bib/draco.bib}

\closing
\end{document}

%%---------------------------------------------------------------------------%%
%% end of GettingStarted.tex
%%---------------------------------------------------------------------------%%
