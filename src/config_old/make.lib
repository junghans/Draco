############################### -*-makefile-*- ################################
# gts/src/config/make.lib
# Geoffrey Furnish
# 14 August 1996
#
# Copyright 1996 The Regents of the University of California. 
# All rights reserved.
###############################################################################
# This makefile provides a standard way to get a package library built
# for GTS components.  Just include it into the middle of your
# makefile to get the library built.
###############################################################################

# Figure out which library is to be built.

ifdef make_shared_lib
default_lib	:= lib$(pkg)_$(env).$(shlib_suffix)
else
default_lib	:= lib$(pkg)_$(env).a
endif

build_lib_$(pkg): $(pretarg) $(default_lib) $(auxtarg)
	@echo " "
	@echo "Library for package $(pkg) has been built."
	@echo " "

# Build up the list of files to go into the library.

ifdef preinstantiate
pt_files = $(wildcard *.pt)
ptcc_files = $(pt_files:%.pt=.pt_%_$(env).cc)
else
libsrcs	+= $(tmplsrcs)
endif

libobjs	:= $(libsrcs:%.cc=$(env)/%.o) \
	   $(ptcc_files:.%_$(env).cc=$(env)/%.o)

# Rule to build an archive library.

ifdef lib_cmd
lib$(pkg)_$(env).a : $(libobjs) $(resolve_libs)
	$(RM) $@
	$(lib_cmd) $@ $(libobjs) $(resolve_libs)
else
lib$(pkg)_$(env).a : $(libobjs)
	-rm -f $@
	$(ar) qc $@ $(libobjs)
	$(ranlib) $@
endif

# Rule to build a shared library.

lib$(pkg)_$(env).$(shlib_suffix) : $(libobjs) $(resolve_libs)
	$(shlib_cmd) $@ $(libobjs) $(resolve_libs)

###############################################################################
#                           End of config/make.lib
###############################################################################
