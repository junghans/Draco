//----------------------------------*-C++-*----------------------------------//
/*!
 * \file   c4/C4_MPI.cc
 * \author Thomas M. Evans
 * \date   Thu Mar 21 16:56:17 2002
 * \brief  C4 MPI implementation.
 */
//---------------------------------------------------------------------------//
// $Id$
//---------------------------------------------------------------------------//

#include <c4/config.h>

#ifdef C4_MPI

#include "C4_MPI.hh"

namespace rtt_c4
{

//---------------------------------------------------------------------------//
// MPI COMMUNICATOR
//---------------------------------------------------------------------------//

MPI_Comm communicator = MPI_COMM_WORLD;

//---------------------------------------------------------------------------//
// SETUP FUNCTIONS
//---------------------------------------------------------------------------//

void initialize(int &argc, char **&argv)
{
    int result = MPI_Init(&argc, &argv);
    Check (result == MPI_SUCCESS);
}

//---------------------------------------------------------------------------//

void finalize()
{
    MPI_Finalize();
}

//---------------------------------------------------------------------------//
// QUERY FUNCTIONS
//---------------------------------------------------------------------------//

int node()
{
    int node = 0; 
    MPI_Comm_rank(communicator, &node);
    Check (node >= 0);
    return node;
}

//---------------------------------------------------------------------------//

int nodes()
{
    int nodes = 0;
    MPI_Comm_size(communicator, &nodes);
    Check (nodes > 0);
    return nodes;
}

//---------------------------------------------------------------------------//
// BARRIER FUNCTIONS
//---------------------------------------------------------------------------//

void global_barrier()
{
    MPI_Barrier(communicator);
}

//---------------------------------------------------------------------------//
// TIMING FUNCTIONS
//---------------------------------------------------------------------------//

double wall_clock_time()
{
    return MPI_Wtime();
}

//---------------------------------------------------------------------------//

double wall_clock_resolution()
{
    return MPI_Wtick();
}

} // end namespace rtt_c4

#endif // C4_MPI

//---------------------------------------------------------------------------//
//                              end of C4_MPI.cc
//---------------------------------------------------------------------------//
