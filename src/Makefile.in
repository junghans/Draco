###############################################################################
# draco/src/ Makefile.in
# Thomas M. Evans
# $Id$
###############################################################################
# @> Makefile for draco/src directory
###############################################################################

top_srcdir = @top_srcdir@
srcdir = @srcdir@
VPATH = @srcdir@  # : this colon is a bug work around.

# The subdirectories to recurs into (if they exist).

subdirs = @subdirs@

# If the make flags include a -k then do not exit on errors.

ifneq (,$(findstring k,${MAKEFLAGS}))
  EXIT = :
else
  EXIT = exit
endif

# Parallel flag

ifndef nj
nj	:= 1
endif
subnj	:= -j $(nj)

##---------------------------------------------------------------------------##
## TARGETS AND RULES
##---------------------------------------------------------------------------##

.PHONY : all install installdirs clean distclean mostlyclean maintainer-clean \
	check uninstall forced-distclean forced-maintainer-clean \
	dvi configure reconfigure autodoc

all: install

install dvi: 
	@for dir in ${subdirs} ; do \
		if test -d "$${dir}" ; then \
			(cd $${dir} && ${MAKE} dependencies $(subnj)) || ${EXIT}; \
			(cd $${dir} && ${MAKE} $@ $(subnj)) || ${EXIT}; \
		fi \
	done

# Make sure that we do not install a subdirectory before it is checked.

check:
	@for dir in ${subdirs} ; do \
		if test -d "$${dir}" ; then \
			(cd $${dir} && ${MAKE} dependencies $(subnj)) || ${EXIT}; \
			(cd $${dir} && ${MAKE} $(subnj)) || ${EXIT}; \
			(cd $${dir} && ${MAKE} $@) || ${EXIT}; \
			(cd $${dir} && ${MAKE} install) || ${EXIT}; \
		fi; \
	done

autodoc:
	@for dir in ${subdirs} ; do \
		if test -d "$${dir}" ; then \
			(cd $${dir} && ${MAKE} $@) || ${EXIT}; \
		fi; \
	done

##---------------------------------------------------------------------------##
## Configure targets

# first we configure in the top-level directory; then we go into each
# subdir and handle things
configure:
	@echo "Rebuilding ${srcdir}/aclocal.m4"
	@cd ${srcdir} && aclocal -I ../config
	@echo "Rebuilding ${top_srcdir}/configure"
	@cd ${srcdir} && autoconf
	@./config.status --recheck
	@./config.status
	@for dir in ${subdirs} ; do \
		if test -d "$${dir}" ; then \
			(cd $${dir} && ${MAKE} $@) || ${EXIT}; \
		fi; \
	done

# first we reconfigure in the top-level directory; then we go into
# each subdir and handle things
reconfigure: 
	@./config.status --recheck
	@./config.status
	@for dir in ${subdirs} ; do \
		if test -d "$${dir}" ; then \
			(cd $${dir} && ${MAKE} $@) || ${EXIT}; \
		fi; \
	done

##---------------------------------------------------------------------------##
## Clean targets

uninstall clean mostlyclean distclean maintainer-clean:
	@for dir in ${subdirs} ; do \
		if test -d "$${dir}" ; then \
			(cd $${dir} && ${MAKE} $@); \
		fi \
	done

distclean: forced-distclean
forced-distclean:
	-rm config.status config.cache config.log config.h stamp-h Makefile

maintainer-clean: forced-maintainer-clean distclean
forced-maintainer-clean:
	@echo 'This command is intended for maintainers to use; it'
	@echo 'deletes files that may need special tools to rebuild.'

###############################################################################
#                       end of draco/src/ Makefile.in
###############################################################################

