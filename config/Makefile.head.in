###############################################################################
# File:  draco/Makefile.in
# Brief: General Makefile for draco
# Note:  Copyright (C) 2010 Los Alamos National Security, LLC.
###############################################################################
# $Id$
###############################################################################

# @configure_input@

top_srcdir = @top_srcdir@
srcdir = @srcdir@

# package top source directory
package_top_srcdir = @package_top_srcdir@

VPATH = @srcdir@  # : this colon is a bug work around.

# The subdirectories to recurse into (if they exist).

subdirs = @subdirs@

# If the make flags include a -k then do not exit on errors.

ifneq (,$(findstring k,${MAKEFLAGS}))
  EXIT = :
else
  EXIT = exit
endif

## get the config directory
config_dir = ${package_top_srcdir}/config

# get the pkg_config directory and include statement
pkg_config_dir  = ${package_top_srcdir}/pkg_config
pkg_config_inc := $(shell if test -d ${pkg_config_dir}; then \
                    echo "-I ${pkg_config_dir}"; fi)

##---------------------------------------------------------------------------##
## TARGETS AND RULES
##---------------------------------------------------------------------------##

.PHONY : all run install installdirs clean distclean mostlyclean \
	maintainer-clean check build_check test uninstall forced-distclean \
	forced-maintainer-clean dvi autodoc configure reconfigure \
	default 

default: install

# These make targets just dispatch to all subdirectories:
all install run dvi: 
	@for dir in ${subdirs} ; do \
		if test -d "$${dir}" ; then \
			(cd $${dir} && ${MAKE} $@) || ${EXIT}; \
		fi \
	done

# Have "make check" at this level also install each subdirectory.
check build_check test:
	@for dir in ${subdirs} ; do \
		if test -d "$${dir}" ; then \
			(cd $${dir} && ${MAKE} $@) || ${EXIT}; \
			(cd $${dir} && ${MAKE} install) || ${EXIT}; \
		fi; \
	done

# autodoc target 
autodoc:
	@if test -d src ; then \
		(cd src && ${MAKE} $@) || ${EXIT}; \
	fi; 
	@if test -d autodoc; then \
		(cd autodoc && ${MAKE} $@) || ${EXIT}; \
	fi

##---------------------------------------------------------------------------##
## Configure targets

# first we configure in the top-level directory; then we go into each
# subdir and handle things
configure:
	@echo "Rebuilding ${srcdir}/aclocal.m4"
	@cd ${srcdir} && aclocal -I ${config_dir} ${pkg_config_inc}
	@echo "Rebuilding ${top_srcdir}/configure"
	@cd ${srcdir} && autoconf
	@./config.status --recheck
	@./config.status
	@for dir in ${subdirs} ; do \
		if test -d "$${dir}" ; then \
			(cd $${dir} && ${MAKE} $@) || ${EXIT}; \
		fi; \
	done

# first we reconfigure in the top-level directory; then we go into
# each subdir and handle things
reconfigure: 
	@./config.status --recheck
	@./config.status
	@for dir in ${subdirs} ; do \
		if test -d "$${dir}" ; then \
			(cd $${dir} && ${MAKE} $@) || ${EXIT}; \
		fi; \
	done

##---------------------------------------------------------------------------##
## Clean targets

uninstall clean mostlyclean distclean maintainer-clean:
	@for dir in ${subdirs} ; do \
		if test -d "$${dir}" ; then \
			(cd $${dir} && ${MAKE} $@); \
		fi \
	done

distclean: forced-distclean
forced-distclean:
	-rm config.status config.cache config.log config.h stamp-h Makefile

maintainer-clean: forced-maintainer-clean distclean
forced-maintainer-clean:
	@echo 'This command is intended for maintainers to use; it'
	@echo 'deletes files that may need special tools to rebuild.'

##---------------------------------------------------------------------------##
## ADDITIONAL RULES AND TARGETS
##---------------------------------------------------------------------------##

# any other hand-coded dependencies or any thing **additional** can
# be put into Makefile.misc in the source directory

-include ${srcdir}/Makefile.misc

###############################################################################
#			 end of draco/ Makefile.in
###############################################################################
